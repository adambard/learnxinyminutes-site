<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="en-us" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="en-us" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="en-us" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-us" class="no-js"> <!--<![endif]-->
    <head>
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-WXC8R75DEN"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-WXC8R75DEN');
      </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Content-Language" content="en-us">
        <!-- Use title if it's in the page YAML frontmatter -->
        <title>Learn tailspin in Y Minutes</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="/css/index.css">

        <link rel="canonical" href="https://learnxinyminutes.com/docs/tailspin/">
        <script>
            var THEME_KEY = "lxiym_theme";
            function set_theme(theme) {
                var el = document.getElementsByTagName("html")[0];
                if (!el) {
                  return;
                }

                if (theme === "dark" ) {
                    el.className = "dark";
                } else {
                    el.className = "light";
                }

                localStorage.setItem(THEME_KEY, theme);
            }

            function load_theme() {
              var theme = localStorage.getItem(THEME_KEY);
              if (theme) {
                set_theme(theme);
              }
            }

            // Attempt immediate application of html style
            load_theme();

            // Backup: do it onload. Will flash, but better than nothing.
            window.addEventListener("load", function(){
              load_theme();
            });
        </script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <div class="container">
            <div class="share">
    <span class="sharemsg">
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flearnxinyminutes.com%2Fdocs%2Ftailspin%2F&text=Learn+X+in+Y+minutes%2C+where+X%3Dtailspin">
        Share this page
      </a></span>

      <span class='st_facebook_large' displayText='Facebook'></span>
      <span class='st_twitter_large' displayText='Tweet'></span>
  </div>
  <div class="theme-choice">
    <label id="theme-label">Select theme:</label>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('light');">light</button>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('dark');">dark</button>
  </div>
  <h1><a href="/">Learn X in Y minutes</a></h1>
  <h2>Where X=tailspin</h2>
    <p class="filelink">
    Get the code:
    <a href="/docs/files/learntailspin.tt">learntailspin.tt</a>
    </p>
  <div id="doc">
    <p><strong>Tailspin</strong> works with streams of values in pipelines. You may often feel
that your program is the machine and that the input data is the program.</p>

<p>While Tailspin is unlikely to become mainstream, or even production-ready,
it will change the way you think about programming in a good way.</p>
<div class="highlight"><pre><span></span><span class="c1">// Comment to end of line</span>

<span class="c1">// Process data in a pipeline with steps separated by -&gt;</span>
<span class="c1">// String literals are delimited by single quotes</span>
<span class="c1">// A bang (!) indicates a sink, or end of the pipe</span>
<span class="c1">// OUT is the standard output object, ::write is the message to write output</span>
<span class="err">&#39;</span><span class="n">Hello</span><span class="p">,</span><span class="w"> </span><span class="n">World</span><span class="o">!</span><span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Output a newline by just entering it in the string (multiline strings)</span>
<span class="err">&#39;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="c1">// Or output the decimal unicode value for newline (10) between $# and ;</span>
<span class="err">&#39;</span><span class="n">$</span><span class="err">#</span><span class="mi">10</span><span class="p">;</span><span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Define an immutable named value. Value syntax is very literal.</span>
<span class="n">def</span><span class="w"> </span><span class="n">names</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="err">&#39;</span><span class="n">Adam</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">George</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Jenny</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Lucy</span><span class="err">&#39;</span><span class="p">];</span>

<span class="c1">// Stream the list to process each name. Note the use of $ to get the value.</span>
<span class="c1">// The current value in the pipeline is always just $</span>
<span class="c1">// String interpolation starts with a $ and ends with ;</span>
<span class="n">$names</span><span class="p">...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Hello</span><span class="w"> </span><span class="n">$</span><span class="p">;</span><span class="o">!</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// You can also stream in the interpolation and nest interpolations</span>
<span class="c1">// Note the list indexing with parentheses and the slice extraction</span>
<span class="c1">// Note the use of ~ to signify an exclusive bound to the range</span>
<span class="c1">// Outputs &#39;Hello Adam, George, Jenny and Lucy!&#39;</span>
<span class="err">&#39;</span><span class="n">Hello</span><span class="w"> </span><span class="n">$names</span><span class="p">(</span><span class="n">first</span><span class="p">);</span><span class="n">$names</span><span class="p">(</span><span class="n">first</span><span class="o">~</span><span class="p">..</span><span class="o">~</span><span class="n">last</span><span class="p">)...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">$</span><span class="p">;</span><span class="err">&#39;</span><span class="p">;</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="nf">$names</span><span class="p">(</span><span class="n">last</span><span class="p">);</span><span class="o">!</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Conditionally say different things to different people</span>
<span class="c1">// Matchers (conditional expressions) are delimited by angle brackets</span>
<span class="c1">// A set of matchers, evaluated top down, must be in templates (a function)</span>
<span class="c1">// Here it is an inline templates delimited by \( to \)</span>
<span class="c1">// Note the doubled &#39;&#39; and $$ to get a literal &#39; and $</span>
<span class="n">$names</span><span class="p">...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="p">(</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;=</span><span class="err">&#39;</span><span class="n">Adam</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">What</span><span class="err">&#39;&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">$</span><span class="p">;</span><span class="o">?</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;=</span><span class="err">&#39;</span><span class="n">George</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">George</span><span class="p">,</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">$$10</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">owe</span><span class="w"> </span><span class="n">me</span><span class="o">?</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">otherwise</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Hello</span><span class="w"> </span><span class="n">$</span><span class="p">;</span><span class="o">!</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="err">\</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="n">$</span><span class="err">#</span><span class="mi">10</span><span class="p">;</span><span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// You can also define templates (functions)</span>
<span class="c1">// A lone ! emits the value into the calling pipeline without returning control</span>
<span class="c1">// The # sends the value to be matched by the matchers </span>
<span class="c1">// Note that templates always take one input value and emit 0 or more outputs</span>
<span class="n">templates</span><span class="w"> </span><span class="n">collatz</span><span class="o">-</span><span class="n">sequence</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="p">.</span><span class="mf">.0</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">The</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">positive</span><span class="w"> </span><span class="n">integer</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;=</span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">$</span><span class="o">!</span>
<span class="c1">// The ?( to ) allows matching a computed value. Can be concatenated as &quot;and&quot;</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;?</span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&lt;=</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">$</span><span class="w"> </span><span class="o">!</span>
<span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">#</span>
<span class="w">  </span><span class="n">otherwise</span>
<span class="w">    </span><span class="n">$</span><span class="w"> </span><span class="o">!</span>
<span class="w">    </span><span class="n">$</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">#</span>
<span class="n">end</span><span class="w"> </span><span class="n">collatz</span><span class="o">-</span><span class="n">sequence</span>

<span class="c1">// Collatz sequence from random start on one line separated by spaces</span>
<span class="mi">1000</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SYS</span><span class="o">::</span><span class="n">randomInt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">collatz</span><span class="o">-</span><span class="n">sequence</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="err">&#39;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Collatz sequence formatted ten per line by an indexed list template</span>
<span class="c1">// Note the square brackets creates a list of the enclosed pipeline results</span>
<span class="c1">// The \[i]( to \) defines a templates to apply to each value of a list,</span>
<span class="c1">// the i (or whatever identifier you choose) holds the index</span>
<span class="p">[</span><span class="mi">1000</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SYS</span><span class="o">::</span><span class="n">randomInt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">collatz</span><span class="o">-</span><span class="n">sequence</span><span class="p">]</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="p">[</span><span class="n">i</span><span class="p">](</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;=</span><span class="mi">1</span><span class="o">|?</span><span class="p">(</span><span class="n">$i</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">&lt;=</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="n">$</span><span class="err">#</span><span class="mi">10</span><span class="p">;</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">otherwise</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="err">\</span><span class="p">)...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// A range can have an optional stride</span>
<span class="n">def</span><span class="w"> </span><span class="n">odd</span><span class="o">-</span><span class="n">numbers</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1..100</span><span class="o">:</span><span class="mi">2</span><span class="p">];</span>

<span class="c1">// Use mutable state locally. One variable per templates, always called @</span>
<span class="n">templates</span><span class="w"> </span><span class="n">product</span>
<span class="w">  </span><span class="err">@</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="n">first</span><span class="p">);</span>
<span class="w">  </span><span class="n">$</span><span class="p">(</span><span class="n">first</span><span class="o">~</span><span class="p">..</span><span class="n">last</span><span class="p">)...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">@</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="err">@</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">$</span><span class="p">;</span>
<span class="w">  </span><span class="n">$</span><span class="err">@</span><span class="w"> </span><span class="o">!</span>
<span class="n">end</span><span class="w"> </span><span class="n">product</span>

<span class="n">$odd</span><span class="o">-</span><span class="n">numbers</span><span class="p">(</span><span class="mf">6..8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="err">&#39;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Use processor objects to hold mutable state.</span>
<span class="c1">// Note that the outer @ must be referred to by name in inner contexts</span>
<span class="c1">// A sink templates gives no output and is called prefixed by !</span>
<span class="c1">// A source templates takes no input and is called prefixed by $</span>
<span class="n">processor</span><span class="w"> </span><span class="n">Product</span>
<span class="w">  </span><span class="err">@</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="n">sink</span><span class="w"> </span><span class="n">accumulate</span>
<span class="w">    </span><span class="err">@</span><span class="n">Product</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="err">@</span><span class="n">Product</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">$</span><span class="p">;</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">accumulate</span>
<span class="w">  </span><span class="n">source</span><span class="w"> </span><span class="n">result</span>
<span class="w">    </span><span class="n">$</span><span class="err">@</span><span class="n">Product</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">result</span>
<span class="n">end</span><span class="w"> </span><span class="n">Product</span>

<span class="c1">// The processor is a constructor templates. This one called with $ (no input)</span>
<span class="n">def</span><span class="w"> </span><span class="n">multiplier</span><span class="o">:</span><span class="w"> </span><span class="n">$Product</span><span class="p">;</span>

<span class="c1">// Call object templates by sending messages with ::</span>
<span class="mf">1..7</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">multiplier</span><span class="o">::</span><span class="n">accumulate</span>
<span class="mi">-1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">multiplier</span><span class="o">::</span><span class="n">accumulate</span>
<span class="n">$multiplier</span><span class="o">::</span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">The</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Syntax sugar for a processor implementing the collector interface</span>
<span class="mf">1..7</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">=</span><span class="n">Product</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">The</span><span class="w"> </span><span class="n">collected</span><span class="w"> </span><span class="n">product</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">$</span><span class="p">;</span><span class="n">$</span><span class="err">#</span><span class="mi">10</span><span class="p">;</span><span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Symbol sets (essentially enums) can be defined for finite sets of values</span>
<span class="n">data</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="err">#</span><span class="p">{</span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">blue</span><span class="p">,</span><span class="w"> </span><span class="n">yellow</span><span class="p">}</span>

<span class="c1">// Use processor typestates to model state cleanly.</span>
<span class="c1">// The last named mutable state value set determines the typestate</span>
<span class="n">processor</span><span class="w"> </span><span class="n">Lamp</span>
<span class="w">  </span><span class="n">def</span><span class="w"> </span><span class="n">colours</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="p">;</span>
<span class="w">  </span><span class="err">@</span><span class="n">Off</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">state</span><span class="w"> </span><span class="n">Off</span>
<span class="w">    </span><span class="n">source</span><span class="w"> </span><span class="n">switchOn</span>
<span class="w">      </span><span class="err">@</span><span class="n">On</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="err">@</span><span class="n">Off</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="n">$colours</span><span class="o">::</span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">      </span><span class="err">&#39;</span><span class="n">Shining</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">$colours</span><span class="p">(</span><span class="n">$</span><span class="err">@</span><span class="n">On</span><span class="p">);</span><span class="w"> </span><span class="n">light$</span><span class="err">#</span><span class="mi">10</span><span class="p">;</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">    </span><span class="n">end</span><span class="w"> </span><span class="n">switchOn</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">Off</span>
<span class="w">  </span><span class="n">state</span><span class="w"> </span><span class="n">On</span>
<span class="w">    </span><span class="n">source</span><span class="w"> </span><span class="n">turnOff</span>
<span class="w">      </span><span class="err">@</span><span class="n">Off</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="err">@</span><span class="n">On</span><span class="p">;</span>
<span class="w">      </span><span class="err">&#39;</span><span class="n">Lamp</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">off$</span><span class="err">#</span><span class="mi">10</span><span class="p">;</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">    </span><span class="n">end</span><span class="w"> </span><span class="n">turnOff</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">On</span>
<span class="n">end</span><span class="w"> </span><span class="n">Lamp</span>

<span class="n">def</span><span class="w"> </span><span class="n">myLamp</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">colour</span><span class="err">#</span><span class="n">green</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="err">#</span><span class="n">blue</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Lamp</span><span class="p">;</span>

<span class="n">$myLamp</span><span class="o">::</span><span class="n">switchOn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Shining a green light</span>
<span class="n">$myLamp</span><span class="o">::</span><span class="n">turnOff</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w">  </span><span class="c1">// Lamp is off</span>
<span class="n">$myLamp</span><span class="o">::</span><span class="n">switchOn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Shining a blue light</span>
<span class="n">$myLamp</span><span class="o">::</span><span class="n">turnOff</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w">  </span><span class="c1">// Lamp is off</span>
<span class="n">$myLamp</span><span class="o">::</span><span class="n">switchOn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Shining a green light</span>

<span class="c1">// Use regular expressions to test strings</span>
<span class="p">[</span><span class="err">&#39;</span><span class="n">banana</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">apple</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">pear</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">cherry</span><span class="err">&#39;</span><span class="p">]...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="p">(</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">&#39;</span><span class="p">.</span><span class="o">*</span><span class="n">a</span><span class="p">.</span><span class="o">*</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="err">&#39;</span><span class="sc">&#39;a&#39;</span><span class="err">&#39;&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">otherwise</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="err">&#39;</span><span class="sc">&#39;a&#39;</span><span class="err">&#39;&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="err">\</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Use composers with regular expressions and defined rules to parse strings</span>
<span class="n">composer</span><span class="w"> </span><span class="n">parse</span><span class="o">-</span><span class="n">stock</span><span class="o">-</span><span class="n">line</span>
<span class="w">  </span><span class="p">{</span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">INT</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">WS</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="err">&#39;\</span><span class="n">w</span><span class="o">+</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">WS</span><span class="o">&gt;</span><span class="p">),</span><span class="w"> </span><span class="n">currency</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="err">&#39;</span><span class="p">.{</span><span class="mi">3</span><span class="p">}</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">unit</span><span class="o">-</span><span class="n">price</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">INT</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">WS</span><span class="o">&gt;?</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="n">parts</span><span class="o">&gt;?</span><span class="p">}</span>
<span class="w">  </span><span class="n">rule</span><span class="w"> </span><span class="n">parts</span><span class="o">:</span><span class="w"> </span><span class="n">associated</span><span class="o">-</span><span class="n">parts</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="o">&lt;</span><span class="n">part</span><span class="o">&gt;+</span><span class="p">]</span>
<span class="w">  </span><span class="n">rule</span><span class="w"> </span><span class="n">part</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="err">&#39;</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;=</span><span class="sc">&#39;,&#39;</span><span class="o">&gt;?</span><span class="p">)</span>
<span class="n">end</span><span class="w"> </span><span class="n">parse</span><span class="o">-</span><span class="n">stock</span><span class="o">-</span><span class="n">line</span>

<span class="err">&#39;</span><span class="mi">705</span><span class="w"> </span><span class="n">gizmo</span><span class="w"> </span><span class="n">EUR5</span><span class="w"> </span><span class="n">A67</span><span class="p">,</span><span class="n">G456</span><span class="p">,</span><span class="n">B32</span><span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">parse</span><span class="o">-</span><span class="n">stock</span><span class="o">-</span><span class="n">line</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="c1">// {associated-parts: [A67, G456, B32], currency: EUR,</span>
<span class="c1">//     inventory-id: 705, name: gizmo, unit-price: 5}</span>
<span class="err">&#39;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Stream a string to split it into glyphs.</span>
<span class="c1">// A list can be indexed/sliced by an array of indexes</span>
<span class="c1">// Outputs [&#39;h&#39;,&#39;e&#39;,&#39;l&#39;,&#39;l&#39;,&#39;o&#39;], indexing arrays/lists starts at 1</span>
<span class="p">[</span><span class="err">&#39;</span><span class="n">abcdefghijklmnopqrstuvwxyz</span><span class="err">&#39;</span><span class="p">...]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="err">&#39;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// We have used only raw strings above.</span>
<span class="c1">// Strings can have different types as determined by a tag.</span>
<span class="c1">// Comparing different types is an error, unless a wider type bound is set</span>
<span class="c1">// Type bound is given in ´´ and &#39;&#39; means any string value, tagged or raw</span>
<span class="n">templates</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">string</span><span class="o">-</span><span class="n">type</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´&#39;&#39;´</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.</span><span class="o">*</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">string</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´&#39;&#39;´</span><span class="w"> </span><span class="n">id</span><span class="err">´&#39;\</span><span class="n">d</span><span class="o">+</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">numeric</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="n">string</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´&#39;&#39;´</span><span class="w"> </span><span class="o">=</span><span class="n">id</span><span class="err">´&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">id</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="n">found</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´&#39;&#39;´</span><span class="w"> </span><span class="n">id</span><span class="err">´&#39;</span><span class="p">.</span><span class="o">*</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">id</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´&#39;&#39;´</span><span class="w"> </span><span class="n">name</span><span class="err">´&#39;</span><span class="p">.</span><span class="o">+</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">name</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">otherwise</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">string</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="n">end</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">string</span><span class="o">-</span><span class="n">type</span>

<span class="p">[</span><span class="n">name</span><span class="err">´&#39;</span><span class="n">Anna</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="err">´&#39;</span><span class="mi">789</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">city</span><span class="err">´&#39;</span><span class="n">London</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="err">´&#39;</span><span class="n">xzgh</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="err">´&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">]...</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">string</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Numbers can be raw, tagged or have a unit of measure</span>
<span class="c1">// Type .. is any numeric value, tagged, measure or raw</span>
<span class="n">templates</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">type</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´</span><span class="p">..</span><span class="err">´</span><span class="w"> </span><span class="o">=</span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mi">86</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="mi">86</span><span class="w"> </span><span class="n">found</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´</span><span class="p">..</span><span class="err">´</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mf">100.</span><span class="p">.</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">100</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´</span><span class="p">..</span><span class="err">´</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mf">0.</span><span class="p">.</span><span class="o">|</span><span class="p">..</span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´</span><span class="p">..</span><span class="err">´</span><span class="w"> </span><span class="mi">0</span><span class="s">&quot;m&quot;</span><span class="p">..</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="n">measure</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="s">&quot;m&quot;</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">´</span><span class="p">..</span><span class="err">´</span><span class="w"> </span><span class="p">.</span><span class="mf">.0</span><span class="o">|</span><span class="mf">0.</span><span class="p">.</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">raw</span><span class="w"> </span><span class="n">number</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="w">  </span><span class="n">otherwise</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">positive</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="n">measure</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">raw</span><span class="err">&#39;</span><span class="w"> </span><span class="o">!</span>
<span class="n">end</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">type</span>

<span class="p">[</span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mi">86</span><span class="p">,</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">78</span><span class="s">&quot;m&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">99</span><span class="p">,</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mi">654</span><span class="p">]...</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Measures can be used in arithmetic, &quot;1&quot; is the scalar unit</span>
<span class="c1">// When mixing measures you have to cast to the result measure</span>
<span class="mi">4</span><span class="s">&quot;m&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">6</span><span class="s">&quot;m&quot;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="o">~/</span><span class="w"> </span><span class="mi">2</span><span class="s">&quot;s&quot;</span><span class="p">)</span><span class="s">&quot;m/s&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Tagged identifiers must be made into raw numbers when used in arithmetic</span>
<span class="c1">// Then you can cast the result back to a tagged identifier if you like</span>
<span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="mi">300</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="err">´</span><span class="p">(</span><span class="n">$</span><span class="o">::</span><span class="n">raw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">type</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Fields get auto-typed, tagging raw strings or numbers by default</span>
<span class="c1">// You cannot assign the wrong type to a field</span>
<span class="n">def</span><span class="w"> </span><span class="n">item</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">thingy</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="o">:</span><span class="w"> </span><span class="mi">12</span><span class="s">&quot;m&quot;</span><span class="w"> </span><span class="p">};</span>

<span class="err">&#39;</span><span class="n">Field</span><span class="w"> </span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="n">$item</span><span class="p">.</span><span class="n">inventory</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">type</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="err">&#39;</span><span class="n">Field</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">$item</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">string</span><span class="o">-</span><span class="n">type</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="err">&#39;</span><span class="n">Field</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="n">$item</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">number</span><span class="o">-</span><span class="n">type</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// You can define types and use as type-tests. This also defines a field.</span>
<span class="c1">// It would be an error to assign a non-standard plate to a standard-plate field</span>
<span class="n">data</span><span class="w"> </span><span class="n">standard</span><span class="o">-</span><span class="n">plate</span><span class="w"> </span><span class="o">&lt;</span><span class="err">&#39;</span><span class="p">[</span><span class="n">A</span><span class="o">-</span><span class="n">Z</span><span class="p">]{</span><span class="mi">3</span><span class="p">}[</span><span class="mi">0-9</span><span class="p">]{</span><span class="mi">3</span><span class="p">}</span><span class="err">&#39;</span><span class="o">&gt;</span>

<span class="p">[[</span><span class="err">&#39;</span><span class="n">Audi</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">XYZ345</span><span class="err">&#39;</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="err">&#39;</span><span class="n">BMW</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">I</span><span class="w"> </span><span class="n">O</span><span class="w"> </span><span class="n">U</span><span class="err">&#39;</span><span class="p">]]...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="p">(</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;?</span><span class="p">(</span><span class="n">$</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="n">standard</span><span class="o">-</span><span class="n">plate</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="n">make</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">standard</span><span class="o">-</span><span class="n">plate</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="o">!</span>
<span class="w">  </span><span class="n">otherwise</span><span class="w"> </span><span class="p">{</span><span class="n">make</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">vanity</span><span class="o">-</span><span class="n">plate</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span><span class="o">!</span>
<span class="err">\</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// You can define union types</span>
<span class="n">data</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;</span><span class="s">&quot;years&quot;</span><span class="o">|</span><span class="s">&quot;months&quot;</span><span class="o">&gt;</span>

<span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Cesar</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="mi">20</span><span class="s">&quot;years&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Francesca</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="mi">19</span><span class="s">&quot;years&quot;</span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Bobby</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="mi">11</span><span class="s">&quot;months&quot;</span><span class="p">}]...</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="p">(</span>
<span class="c1">// Conditional tests on structures look a lot like literals, with field tests</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">13</span><span class="s">&quot;years&quot;</span><span class="p">.</span><span class="mf">.19</span><span class="s">&quot;years&quot;</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">.</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">teenager</span><span class="err">&#39;</span><span class="o">!</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="p">{</span><span class="n">age</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="s">&quot;months&quot;</span><span class="o">&gt;</span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">.</span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">baby</span><span class="err">&#39;</span><span class="o">!</span>
<span class="c1">// You don&#39;t need to handle all cases, &#39;Cesar&#39; will just be ignored</span>
<span class="err">\</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Array/list indexes start at 1 by default, but you can choose</span>
<span class="c1">// Slices return whatever overlaps with the actual array</span>
<span class="p">[</span><span class="mf">1..5</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="mf">-2..2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Outputs [1,2]</span>
<span class="mi">0</span><span class="o">:</span><span class="p">[</span><span class="mf">1..5</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="mf">-2..2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Outputs [1,2,3]</span>
<span class="mi">-2</span><span class="o">:</span><span class="p">[</span><span class="mf">1..5</span><span class="p">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="mf">-2..2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Outputs [1,2,3,4,5]</span>

<span class="c1">// Arrays can have indexes of measures or tagged identifiers</span>
<span class="n">def</span><span class="w"> </span><span class="n">game</span><span class="o">-</span><span class="n">map</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="s">&quot;y&quot;</span><span class="o">:</span><span class="p">[</span>
<span class="w">  </span><span class="mf">1..5</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">0</span><span class="s">&quot;x&quot;</span><span class="o">:</span><span class="p">[</span>
<span class="w">    </span><span class="mf">1..5</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">level</span><span class="err">´</span><span class="mi">1</span><span class="o">:</span><span class="p">[</span>
<span class="w">      </span><span class="mf">1..3</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nl">level</span><span class="p">:</span><span class="w"> </span><span class="n">$</span><span class="p">,</span>
<span class="w">        </span><span class="n">terrain</span><span class="o">-</span><span class="n">id</span><span class="o">:</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SYS</span><span class="o">::</span><span class="n">randomInt</span><span class="p">,</span>
<span class="w">        </span><span class="nl">altitude</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SYS</span><span class="o">::</span><span class="n">randomInt</span><span class="p">)</span><span class="s">&quot;m&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">];</span>

<span class="c1">// Projections (indexing) can span several dimensions</span>
<span class="n">$game</span><span class="o">-</span><span class="n">map</span><span class="p">(</span><span class="mi">3</span><span class="s">&quot;y&quot;</span><span class="p">;</span><span class="w"> </span><span class="mi">1</span><span class="s">&quot;x&quot;</span><span class="p">.</span><span class="mf">.3</span><span class="s">&quot;x&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">level</span><span class="err">´</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">altitude</span><span class="o">:</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Gives a list of three altitude values</span>

<span class="c1">// Flatten and do a grouping projection to get stats</span>
<span class="c1">// Count and Max are built-in collector processors</span>
<span class="p">[</span><span class="n">$game</span><span class="o">-</span><span class="n">map</span><span class="p">...</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">...]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="n">collect</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nl">occurences</span><span class="p">:</span><span class="w"> </span><span class="n">Count</span><span class="p">,</span>
<span class="w">      </span><span class="n">highest</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">level</span><span class="o">:</span><span class="w"> </span><span class="n">Max</span><span class="o">&amp;</span><span class="p">{</span><span class="n">by</span><span class="o">:</span><span class="w"> </span><span class="o">:</span><span class="p">(</span><span class="n">altitude</span><span class="o">:</span><span class="p">),</span><span class="w"> </span><span class="n">select</span><span class="o">:</span><span class="w"> </span><span class="o">:</span><span class="p">(</span><span class="n">level</span><span class="o">:</span><span class="p">)}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">$</span><span class="p">({</span><span class="n">terrain</span><span class="o">-</span><span class="n">id</span><span class="o">:</span><span class="p">}))</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="err">&#39;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Relations are sets of structures/records.</span>
<span class="c1">// Here we get all unique {level:, terrain-id:, altitude:} combinations</span>
<span class="n">def</span><span class="w"> </span><span class="n">location</span><span class="o">-</span><span class="n">types</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="o">|</span><span class="n">$game</span><span class="o">-</span><span class="n">map</span><span class="p">...</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">...</span><span class="o">|</span><span class="p">};</span>

<span class="c1">// Projections can re-map structures. Note § is the relative accessor</span>
<span class="n">$location</span><span class="o">-</span><span class="n">types</span><span class="p">({</span><span class="n">terrain</span><span class="o">-</span><span class="n">id</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="o">:</span><span class="w"> </span><span class="err">§</span><span class="p">.</span><span class="n">level</span><span class="o">::</span><span class="n">raw</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="err">§</span><span class="p">.</span><span class="n">altitude</span><span class="p">})</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Relational algebra operators can be used on relations</span>
<span class="p">(</span><span class="n">$location</span><span class="o">-</span><span class="n">types</span><span class="w"> </span><span class="n">join</span><span class="w"> </span><span class="p">{</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="n">altitude</span><span class="o">:</span><span class="w"> </span><span class="mi">3</span><span class="s">&quot;m&quot;</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="p">})</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>
<span class="err">&#39;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Define your own operators for binary operations</span>
<span class="n">operator</span><span class="w"> </span><span class="p">(</span><span class="n">left</span><span class="w"> </span><span class="n">dot</span><span class="w"> </span><span class="n">right</span><span class="p">)</span>
<span class="w">  </span><span class="n">$left</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">\</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">$</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">$right</span><span class="p">(</span><span class="n">$i</span><span class="p">)</span><span class="o">!</span><span class="err">\</span><span class="p">)...</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">=</span><span class="n">Sum</span><span class="o">&amp;</span><span class="p">{</span><span class="n">of</span><span class="o">:</span><span class="w"> </span><span class="o">:</span><span class="p">()}</span><span class="w"> </span><span class="o">!</span>
<span class="n">end</span><span class="w"> </span><span class="n">dot</span>

<span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="n">dot</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">dot</span><span class="w"> </span><span class="n">product</span><span class="o">:</span><span class="w"> </span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Supply parameters to vary templates behaviour</span>
<span class="n">templates</span><span class="w"> </span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="o">&amp;</span><span class="p">{</span><span class="n">sides</span><span class="o">:</span><span class="p">}</span>
<span class="w">  </span><span class="mf">1.</span><span class="p">.</span><span class="n">$</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$sides</span><span class="o">::</span><span class="n">raw</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">SYS</span><span class="o">::</span><span class="n">randomInt</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">!</span>
<span class="n">end</span><span class="w"> </span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span>

<span class="p">[</span><span class="mi">5</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="o">&amp;</span><span class="p">{</span><span class="n">sides</span><span class="o">:</span><span class="mi">4</span><span class="p">}]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Pass templates as parameters, maybe with some parameters pre-filled</span>
<span class="n">source</span><span class="w"> </span><span class="n">damage</span><span class="o">-</span><span class="n">roll</span><span class="o">&amp;</span><span class="p">{</span><span class="n">first</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">second</span><span class="o">:</span><span class="p">,</span><span class="w"> </span><span class="n">third</span><span class="o">:</span><span class="p">}</span>
<span class="w">  </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">first</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">second</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">third</span><span class="p">)</span><span class="w"> </span><span class="o">!</span>
<span class="n">end</span><span class="w"> </span><span class="n">damage</span><span class="o">-</span><span class="n">roll</span>

<span class="n">$damage</span><span class="o">-</span><span class="n">roll</span><span class="o">&amp;</span><span class="p">{</span><span class="n">first</span><span class="o">:</span><span class="w"> </span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="o">&amp;</span><span class="p">{</span><span class="n">sides</span><span class="o">:</span><span class="mi">4</span><span class="p">},</span>
<span class="w">  </span><span class="nl">second</span><span class="p">:</span><span class="w"> </span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="o">&amp;</span><span class="p">{</span><span class="n">sides</span><span class="o">:</span><span class="mi">6</span><span class="p">},</span><span class="w"> </span><span class="n">third</span><span class="o">:</span><span class="w"> </span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="o">&amp;</span><span class="p">{</span><span class="n">sides</span><span class="o">:</span><span class="mi">20</span><span class="p">}}</span>
<span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Damage</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span>

<span class="c1">// Write tests inline. Run by --test flag on command line</span>
<span class="c1">// Note the ~ in the matcher means &quot;not&quot;,</span>
<span class="c1">// and the array content matcher matches elements &lt; 1 and &gt; 4</span>
<span class="n">test</span><span class="w"> </span><span class="err">&#39;</span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="err">&#39;</span>
<span class="w">  </span><span class="n">assert</span><span class="w"> </span><span class="p">[</span><span class="mi">100</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="o">&amp;</span><span class="p">{</span><span class="n">sides</span><span class="o">:</span><span class="w"> </span><span class="mi">4</span><span class="p">}]</span><span class="w"> </span><span class="o">&lt;~</span><span class="p">[</span><span class="o">&lt;</span><span class="p">..</span><span class="o">~</span><span class="mi">1</span><span class="o">|</span><span class="mi">4</span><span class="o">~</span><span class="p">..</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">all</span><span class="w"> </span><span class="n">rolls</span><span class="w"> </span><span class="mf">1..4</span><span class="err">&#39;</span>
<span class="n">end</span><span class="w"> </span><span class="err">&#39;</span><span class="n">die</span><span class="o">-</span><span class="n">rolls</span><span class="err">&#39;</span>

<span class="c1">// Provide modified modules to tests (aka test doubles or mocks)</span>
<span class="c1">// IN is the standard input object and ::lines gets all lines</span>
<span class="n">source</span><span class="w"> </span><span class="n">read</span><span class="o">-</span><span class="n">numbers</span>
<span class="w">  </span><span class="n">$IN</span><span class="o">::</span><span class="n">lines</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">#</span>
<span class="w">  </span><span class="n">when</span><span class="w"> </span><span class="o">&lt;</span><span class="err">&#39;\</span><span class="n">d</span><span class="o">+</span><span class="err">&#39;</span><span class="o">&gt;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">$</span><span class="o">!</span>
<span class="n">end</span><span class="w"> </span><span class="n">read</span><span class="o">-</span><span class="n">numbers</span>

<span class="n">test</span><span class="w"> </span><span class="err">&#39;</span><span class="n">read</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">input</span><span class="err">&#39;</span>
<span class="w">  </span><span class="n">use</span><span class="w"> </span><span class="n">shadowed</span><span class="w"> </span><span class="n">core</span><span class="o">-</span><span class="n">system</span><span class="o">/</span>
<span class="w">    </span><span class="n">processor</span><span class="w"> </span><span class="n">MockIn</span>
<span class="w">      </span><span class="n">source</span><span class="w"> </span><span class="n">lines</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">          </span><span class="err">&#39;</span><span class="mi">12</span><span class="n">a</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="err">&#39;</span><span class="mi">65</span><span class="err">&#39;</span><span class="p">,</span>
<span class="w">          </span><span class="err">&#39;</span><span class="n">abc</span><span class="err">&#39;</span>
<span class="w">        </span><span class="p">]...</span><span class="w"> </span><span class="o">!</span>
<span class="w">      </span><span class="n">end</span><span class="w"> </span><span class="n">lines</span>
<span class="w">    </span><span class="n">end</span><span class="w"> </span><span class="n">MockIn</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">IN</span><span class="o">:</span><span class="w"> </span><span class="n">$MockIn</span><span class="p">;</span>
<span class="w">  </span><span class="n">end</span><span class="w"> </span><span class="n">core</span><span class="o">-</span><span class="n">system</span><span class="o">/</span>
<span class="w">  </span><span class="n">assert</span><span class="w"> </span><span class="n">$read</span><span class="o">-</span><span class="n">numbers</span><span class="w"> </span><span class="o">&lt;=</span><span class="mi">65</span><span class="o">&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Only</span><span class="w"> </span><span class="mi">65</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">read</span><span class="err">&#39;</span>
<span class="n">end</span><span class="w"> </span><span class="err">&#39;</span><span class="n">read</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">input</span><span class="err">&#39;</span>

<span class="c1">// You can work with byte arrays</span>
<span class="n">composer</span><span class="w"> </span><span class="n">hexToBytes</span>
<span class="w">  </span><span class="o">&lt;</span><span class="n">HEX</span><span class="o">&gt;</span>
<span class="n">end</span><span class="w"> </span><span class="n">hexToBytes</span>

<span class="err">&#39;</span><span class="mi">1</span><span class="n">a5c678d</span><span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hexToBytes</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">$</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="mo">07</span><span class="w"> </span><span class="n">x</span><span class="p">])</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">$</span><span class="p">(</span><span class="n">last</span><span class="mf">-1.</span><span class="p">.</span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="err">&#39;</span><span class="n">$</span><span class="p">;</span>
<span class="err">&#39;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">OUT</span><span class="o">::</span><span class="n">write</span><span class="w"> </span><span class="c1">// Outputs 0005</span>
</pre></div>
<h2>Further Reading</h2>

<ul>
<li><a href="https://github.com/tobega/tailspin-v0/">Main Tailspin site</a></li>
<li><a href="https://github.com/tobega/tailspin-v0/blob/master/TailspinReference.md">Tailspin language reference</a></li>
</ul>

    <hr>
    <p>Got a suggestion? A correction, perhaps? <a href="https://github.com/adambard/learnxinyminutes-docs/issues/new">Open an Issue</a> on the Github Repo, or make a <a href="https://github.com/adambard/learnxinyminutes-docs/edit/master/tailspin.html.markdown">pull request</a> yourself!
    </p>
    <p class="contributed">
    Originally contributed by Torbjörn Gannholm, and updated by <a href="https://github.com/adambard/learnxinyminutes-docs/blame/master/tailspin.html.markdown">1 contributor</a>.
    </p>

    <footer>
    <a style="float: left" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
    <p>
    &copy; 2024
        <a href="https://github.com/tobega/">Torbjörn Gannholm</a>
    </p>

    <p>

    </footer>
  </div>

        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="/js/script.js"></script>
    </body>
</html>
