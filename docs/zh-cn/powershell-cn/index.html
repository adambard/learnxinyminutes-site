<!DOCTYPE html lang="zh-cn" xml:lang="zh-cn" xmlns="http://www.w3.org/1999/xhtml">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Content-Language" content="zh-cn">
        <!-- Use title if it's in the page YAML frontmatter -->
        <title>Learn X in Y Minutes: Scenic Programming Language Tours</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="/css/index.css">

        <link rel="canonical" href="https://learnxinyminutes.com/docs/zh-cn/powershell-cn/">
        <script>
            var THEME_KEY = "lxiym_theme";
            function set_theme(theme) {
                var el = document.getElementsByTagName("html")[0];
                if (!el) {
                  return;
                }

                if (theme === "dark" ) {
                    el.className = "dark";
                } else {
                    el.className = "light";
                }

                localStorage.setItem(THEME_KEY, theme);
            }

            function load_theme() {
              var theme = localStorage.getItem(THEME_KEY);
              if (theme) {
                set_theme(theme);
              }
            }

            // Attempt immediate application of html style
            load_theme();

            // Backup: do it onload. Will flash, but better than nothing.
            window.addEventListener("load", function(){
              load_theme();
            });
        </script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <div class="container">
            <div class="share">
    <span class="sharemsg">
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flearnxinyminutes.com%2Fdocs%2Fzh-cn%2Fpowershell-cn%2F&text=Y%E5%88%86%E9%92%9F%E9%80%9F%E6%88%90X%2C+%E5%85%B6%E4%B8%AD+X%3Dpowershell">
        分享此页
      </a></span>

      <span class='st_facebook_large' displayText='Facebook'></span>
      <span class='st_twitter_large' displayText='Tweet'></span>
  </div>
  <div class="theme-choice">
    <label id="theme-label">选择主题：</label>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('light');">亮</button>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('dark');">暗</button>
  </div>
  <h1><a href="/">Y分钟速成X</a></h1>
  <h2>其中 X=powershell</h2>
    <p class="filelink">
    源代码下载：
    <a href="/docs/files/LearnPowershell-cn.ps1">LearnPowershell-cn.ps1</a>
    </p>
  <div id="doc">
    <p>PowerShell 是 Windows 平台下的脚本语言同时也是配置管理框架，它是建立在微软 .Net Framework 之上，Windows 7 以及之后版本都内置 Poweshell。下面的示例中都是 PoweShell 脚本的一部分或者直接能够在 Shell 交互窗口中执行。</p>

<p>与 Bash 最大的不同是你大部分操作的东西是对象而不是普通的文本。</p>

<p><a href="https://docs.microsoft.com/zh-cn/powershell/scripting/overview">延伸阅读</a></p>

<p>如果你不确定你的环境，执行如下操作：</p>
<div class="highlight"><pre class="highlight powershell"><code><span class="n">Get-ExecutionPolicy</span><span class="w"> </span><span class="nt">-List</span><span class="w">
</span><span class="n">Set-ExecutionPolicy</span><span class="w"> </span><span class="nx">AllSigned</span><span class="w">
</span><span class="c"># Execution Policy 包含以下：</span><span class="w">
</span><span class="c"># - Restricted: 不会运行脚本。</span><span class="w">
</span><span class="c"># - RemoteSigned: 只会运行受信任的发行商下载的脚本。</span><span class="w">
</span><span class="c"># - AllSigned: 运行需要被信任发行商签名的脚本。</span><span class="w">
</span><span class="c"># - Unrestricted: 运行所有脚本</span><span class="w">
</span><span class="n">help</span><span class="w"> </span><span class="nx">about_Execution_Policies</span><span class="w"> </span><span class="c"># 查看更多信息</span><span class="w">

</span><span class="c"># 当前 PowerShell 版本</span><span class="w">
</span><span class="bp">$PSVersionTable</span><span class="w">
</span></code></pre></div>
<p>获取帮助</p>
<div class="highlight"><pre class="highlight powershell"><code><span class="c"># 查找命令</span><span class="w">
</span><span class="n">Get-Command</span><span class="w"> </span><span class="nx">about_</span><span class="o">*</span><span class="w"> </span><span class="c"># 别名: gcm</span><span class="w">
</span><span class="n">Get-Command</span><span class="w"> </span><span class="nt">-Verb</span><span class="w"> </span><span class="nx">Add</span><span class="w">
</span><span class="n">Get-Alias</span><span class="w"> </span><span class="nx">ps</span><span class="w">
</span><span class="n">Get-Alias</span><span class="w"> </span><span class="nt">-Definition</span><span class="w"> </span><span class="nx">Get-Process</span><span class="w">

</span><span class="n">Get-Help</span><span class="w"> </span><span class="nx">ps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="c"># 别名: help</span><span class="w">
</span><span class="n">ps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w"> </span><span class="c"># 别名: gm</span><span class="w">

</span><span class="n">Show-Command</span><span class="w"> </span><span class="nx">Get-EventLog</span><span class="w"> </span><span class="c"># GUI 填充参数</span><span class="w">

</span><span class="n">Update-Help</span><span class="w"> </span><span class="c"># 管理员运行</span><span class="w">
</span></code></pre></div>
<p>接下来是教程</p>
<div class="highlight"><pre class="highlight powershell"><code><span class="c"># 正如你看到的，每一行开头是 # 都是注释</span><span class="w">

</span><span class="c"># 简单的 Hello World 实例</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="nx">Hello</span><span class="w"> </span><span class="nx">world</span><span class="o">!</span><span class="w">
</span><span class="c"># echo 是 Write-Output (cmdlet) 的别名</span><span class="w">
</span><span class="c"># 大部分 cmdlet 和函数都遵循 "动词-名词" 命名规则。</span><span class="w">

</span><span class="c"># 每个命令都从新的一行开始或者是一个分号</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s1">'This is the first line'</span><span class="p">;</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s1">'This is the second line'</span><span class="w">

</span><span class="c"># 声明一个变量如下：</span><span class="w">
</span><span class="nv">$aString</span><span class="o">=</span><span class="s2">"Some string"</span><span class="w">
</span><span class="c"># 或者像这样：</span><span class="w">
</span><span class="nv">$aNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">-as</span><span class="w"> </span><span class="p">[</span><span class="n">double</span><span class="p">]</span><span class="w">
</span><span class="nv">$aList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="w">
</span><span class="nv">$anEmptyList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w">
</span><span class="nv">$aString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$aList</span><span class="w"> </span><span class="o">-join</span><span class="w"> </span><span class="s1">'--'</span><span class="w"> </span><span class="c"># 也包含 join 方法</span><span class="w">
</span><span class="nv">$aHashtable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="nx">name1</span><span class="o">=</span><span class="s1">'val1'</span><span class="p">;</span><span class="w"> </span><span class="nx">name2</span><span class="o">=</span><span class="s1">'val2'</span><span class="p">}</span><span class="w">

</span><span class="c"># 使用变量：</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="nv">$aString</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Interpolation: </span><span class="nv">$aString</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"</span><span class="nv">$aString</span><span class="s2"> has length of </span><span class="si">$(</span><span class="nv">$aString</span><span class="o">.</span><span class="nf">Length</span><span class="si">)</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s1">'$aString'</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="sh">@"
This is a Here-String
</span><span class="nv">$aString</span><span class="sh">
"@</span><span class="w">
</span><span class="c"># 注意 ' (单引号) 不是变量的一部分</span><span class="w">
</span><span class="c"># 在这里字符串也可以是单引号</span><span class="w">

</span><span class="c"># 内置变量:</span><span class="w">
</span><span class="c"># 下面是一些有用的内置变量，比如：</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Booleans: </span><span class="nv">$TRUE</span><span class="s2"> and </span><span class="nv">$FALSE</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Empty value: </span><span class="nv">$NULL</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Last program's return value: </span><span class="bp">$?</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Exit code of last run Windows-based program: </span><span class="bp">$LastExitCode</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"The last token in the last line received by the session: </span><span class="bp">$$</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"The first token: </span><span class="bp">$^</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Script's PID: </span><span class="bp">$PID</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Full path of current script directory: </span><span class="bp">$PSScriptRoot</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s1">'Full path of current script: '</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">$MyInvocation</span><span class="o">.</span><span class="nf">MyCommand</span><span class="o">.</span><span class="nf">Path</span><span class="w">
</span><span class="nx">echo</span><span class="w"> </span><span class="s2">"FUll path of current directory: </span><span class="nv">$Pwd</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Bound arguments in a function, script or code block: </span><span class="bp">$PSBoundParameters</span><span class="s2">"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Unbound arguments: </span><span class="si">$(</span><span class="nv">$Args</span><span class="w"> </span><span class="o">-join</span><span class="w"> </span><span class="s1">', '</span><span class="si">)</span><span class="s2">."</span><span class="w">
</span><span class="c"># 更多的内置类型: `help about_Automatic_Variables`</span><span class="w">

</span><span class="c"># 内联其他文件 (点操作符)</span><span class="w">
</span><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\otherScriptName.ps1</span><span class="w">


</span><span class="c">### 控制流</span><span class="w">
</span><span class="c"># 下面是条件判断结构</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$Age</span><span class="w"> </span><span class="o">-is</span><span class="w"> </span><span class="p">[</span><span class="n">string</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">echo</span><span class="w"> </span><span class="s1">'But.. $Age cannot be a string!'</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="nv">$Age</span><span class="w"> </span><span class="o">-lt</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="nv">$Age</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">echo</span><span class="w"> </span><span class="s1">'Child (Less than 12. Greater than 0)'</span><span class="w">
</span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">echo</span><span class="w"> </span><span class="s1">'Adult'</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># Switch 语句比其他语言更强大</span><span class="w">
</span><span class="nv">$val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"20"</span><span class="w">
</span><span class="kr">switch</span><span class="p">(</span><span class="nv">$val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">}</span><span class="w">           </span><span class="p">{</span><span class="w"> </span><span class="s2">"The answer equals 42"</span><span class="p">;</span><span class="w"> </span><span class="kr">break</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="s1">'20'</span><span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="s2">"Exactly 20"</span><span class="p">;</span><span class="w"> </span><span class="kr">break</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s1">'s*'</span><span class="w"> </span><span class="p">}</span><span class="w">       </span><span class="p">{</span><span class="w"> </span><span class="s2">"Case insensitive"</span><span class="p">;</span><span class="w"> </span><span class="kr">break</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-clike</span><span class="w"> </span><span class="s1">'s*'</span><span class="p">}</span><span class="w">       </span><span class="p">{</span><span class="w"> </span><span class="s2">"clike, ceq, cne for case sensitive"</span><span class="p">;</span><span class="w"> </span><span class="kr">break</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-notmatch</span><span class="w"> </span><span class="s1">'^.*$'</span><span class="p">}</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="s2">"Regex matching. cnotmatch, cnotlike, ..."</span><span class="p">;</span><span class="w"> </span><span class="kr">break</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="s1">'x'</span><span class="w"> </span><span class="o">-contains</span><span class="w"> </span><span class="s1">'x'</span><span class="p">}</span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="s2">"FALSE! -contains is for lists!"</span><span class="p">;</span><span class="w"> </span><span class="kr">break</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="n">default</span><span class="w">                 </span><span class="p">{</span><span class="w"> </span><span class="s2">"Others"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># 经典的 For 循环</span><span class="w">
</span><span class="kr">for</span><span class="p">(</span><span class="nv">$i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="o">-le</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="s2">"Loop number </span><span class="nv">$i</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c"># 或者可以更简洁</span><span class="w">
</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"Loop number </span><span class="bp">$_</span><span class="s2">"</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># PowerShell 还提供其他循环方式</span><span class="w">
</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$var</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="s1">'val1'</span><span class="p">,</span><span class="s1">'val2'</span><span class="p">,</span><span class="s1">'val3'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="nv">$var</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="c"># while () {}</span><span class="w">
</span><span class="c"># do {} while ()</span><span class="w">
</span><span class="c"># do {} until ()</span><span class="w">

</span><span class="c"># 异常处理</span><span class="w">
</span><span class="kr">try</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">catch</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">finally</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="kr">try</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">catch</span><span class="w"> </span><span class="p">[</span><span class="n">System.NullReferenceException</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">echo</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Exception</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-List</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c">### Providers</span><span class="w">
</span><span class="c"># 列出当前目录下的文件和子目录</span><span class="w">
</span><span class="n">ls</span><span class="w"> </span><span class="c"># 或者 `dir`</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">~</span><span class="w"> </span><span class="c"># 回到主目录</span><span class="w">

</span><span class="n">Get-Alias</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="c"># -&gt; Get-ChildItem</span><span class="w">
</span><span class="c"># 这些 cmdlet 有更加通用的名称，因为它不仅仅只操作当前目录，这一点和其他脚本语言不同。</span><span class="w">
</span><span class="n">cd</span><span class="w"> </span><span class="nx">HKCU:</span><span class="w"> </span><span class="c"># 跳转 HKEY_CURRENT_USER 注册表中的值</span><span class="w">

</span><span class="c"># 获取当前会话中的提供者</span><span class="w">
</span><span class="n">Get-PSProvider</span><span class="w">


</span><span class="c">### 管道</span><span class="w">
</span><span class="c"># Cmdlets 中的参数用来控制它们的行为：</span><span class="w">
</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="o">*.</span><span class="nf">txt</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="c"># 获取所有 txt 文件名。</span><span class="w">
</span><span class="c"># 需要输入足够多的参数来确保没有歧义。</span><span class="w">
</span><span class="n">ls</span><span class="w"> </span><span class="nt">-fi</span><span class="w"> </span><span class="o">*.</span><span class="nf">txt</span><span class="w"> </span><span class="nt">-n</span><span class="w"> </span><span class="c"># -f 是不可以的因为 -Force 同样存在。</span><span class="w">
</span><span class="c"># 使用 `Get-Help Get-ChildItem -Full` 来查看全部参数。</span><span class="w">

</span><span class="c"># 之前 cmdlet 获取的结果输出可以作为一下个输入。</span><span class="w">
</span><span class="c"># `$_` 指代当前管道处理的对象。</span><span class="w">
</span><span class="n">ls</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'c'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Export-CSV</span><span class="w"> </span><span class="nx">export.txt</span><span class="w">
</span><span class="n">ls</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">?</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s1">'c'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ConvertTo-HTML</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-File</span><span class="w"> </span><span class="nx">export.html</span><span class="w">

</span><span class="c"># 如果对管道的对象感到疑惑，使用 `Get-Member` 来查看该对象的可使用的方法和属性。</span><span class="w">
</span><span class="n">ls</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Get-Member</span><span class="w">
</span><span class="nx">Get-Date</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">gm</span><span class="w">

</span><span class="c"># ` 是行连续标识符，或者在每一行结尾添加一个 |</span><span class="w">
</span><span class="n">Get-Process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Sort-Object</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="nt">-Descending</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="w"> </span><span class="nx">10</span><span class="w"> </span><span class="nx">Name</span><span class="p">,</span><span class="nx">ID</span><span class="p">,</span><span class="nx">VM</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">Stop-Process</span><span class="w"> </span><span class="nt">-WhatIf</span><span class="w">

</span><span class="n">Get-EventLog</span><span class="w"> </span><span class="nx">Application</span><span class="w"> </span><span class="nt">-After</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Date</span><span class="p">)</span><span class="o">.</span><span class="nf">AddHours</span><span class="p">(</span><span class="nt">-2</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-List</span><span class="w">

</span><span class="c"># 使用 % 作为 ForEach-Object 的简称。</span><span class="w">
</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="se">`
</span><span class="w">    </span><span class="nt">-Begin</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"Starting"</span><span class="p">;</span><span class="w"> </span><span class="nv">$counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">`</span><span class="w">
    </span><span class="nt">-Process</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"Processing </span><span class="bp">$_</span><span class="s2">"</span><span class="p">;</span><span class="w"> </span><span class="nv">$counter</span><span class="o">++</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="err">`</span><span class="w">
    </span><span class="nt">-End</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">"Finishing: </span><span class="nv">$counter</span><span class="s2">"</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="c"># Get-Process 返回包含三列的表</span><span class="w">
</span><span class="c"># 第三列是使用 2 位精度数值表示 VM 属性</span><span class="w">
</span><span class="c"># 计算出来的列也可以表示更多的信息:</span><span class="w">
</span><span class="c"># `@{name='lbl';expression={$_}`</span><span class="w">
</span><span class="n">ps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Format-Table</span><span class="w"> </span><span class="nx">ID</span><span class="p">,</span><span class="nx">Name</span><span class="p">,@{</span><span class="nx">n</span><span class="o">=</span><span class="s1">'VM(MB)'</span><span class="p">;</span><span class="nx">e</span><span class="o">=</span><span class="p">{</span><span class="s1">'{0:n2}'</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="p">(</span><span class="bp">$_</span><span class="o">.</span><span class="nf">VM</span><span class="w"> </span><span class="n">/</span><span class="w"> </span><span class="nx">1MB</span><span class="p">)}}</span><span class="w"> </span><span class="nt">-autoSize</span><span class="w">


</span><span class="c">### 函数</span><span class="w">
</span><span class="c"># [string] 注记是可选的。</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">foo</span><span class="p">([</span><span class="n">string</span><span class="p">]</span><span class="nv">$name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">echo</span><span class="w"> </span><span class="s2">"Hey </span><span class="nv">$name</span><span class="s2">, have a function"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c"># 调用你的函数</span><span class="w">
</span><span class="n">foo</span><span class="w"> </span><span class="s2">"Say my name"</span><span class="w">

</span><span class="c"># 函数可以包含命名参数、参数的注记和可解析的文档</span><span class="w">
</span><span class="cm">&lt;#
</span><span class="cs">.SYNOPSIS</span><span class="cm">
Setup a new website
</span><span class="cs">.DESCRIPTION</span><span class="cm">
Creates everything your new website needs for much win
</span><span class="cs">.PARAMETER</span><span class="cm"> siteName
The name for the new website
</span><span class="cs">.EXAMPLE</span><span class="cm">
New-Website -Name FancySite -Po 5000
New-Website SiteWithDefaultPort
New-Website siteName 2000 # ERROR! Port argument could not be validated
('name1','name2') | New-Website -Verbose
#&gt;</span><span class="w">
</span><span class="kr">function</span><span class="w"> </span><span class="nf">New-Website</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="p">[</span><span class="n">CmdletBinding</span><span class="p">()]</span><span class="w">
    </span><span class="kr">param</span><span class="w"> </span><span class="p">(</span><span class="w">
        </span><span class="p">[</span><span class="n">Parameter</span><span class="p">(</span><span class="n">ValueFromPipeline</span><span class="o">=</span><span class="bp">$true</span><span class="p">,</span><span class="w"> </span><span class="n">Mandatory</span><span class="o">=</span><span class="bp">$true</span><span class="p">)]</span><span class="w">
        </span><span class="p">[</span><span class="n">Alias</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)]</span><span class="w">
        </span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="nv">$siteName</span><span class="p">,</span><span class="w">
        </span><span class="p">[</span><span class="n">ValidateSet</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">8000</span><span class="p">)]</span><span class="w">
        </span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3000</span><span class="w">
    </span><span class="p">)</span><span class="w">
    </span><span class="kr">BEGIN</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s1">'Creating new website(s)'</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="kr">PROCESS</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s2">"name: </span><span class="nv">$siteName</span><span class="s2">, port: </span><span class="nv">$port</span><span class="s2">"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="kr">END</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Write-Verbose</span><span class="w"> </span><span class="s1">'Website(s) created'</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="c">### 都是 .NET</span><span class="w">
</span><span class="c"># PS 中的字符串事实上就是 .NET 的 System.String 类型</span><span class="w">
</span><span class="c"># 所有 .NET 方法和属性都可用</span><span class="w">
</span><span class="s1">'string'</span><span class="o">.</span><span class="nf">ToUpper</span><span class="p">()</span><span class="o">.</span><span class="nf">Replace</span><span class="p">(</span><span class="s1">'G'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ggg'</span><span class="p">)</span><span class="w">
</span><span class="c"># 或者更加 PowerShell 一点</span><span class="w">
</span><span class="s1">'string'</span><span class="o">.</span><span class="nf">ToUpper</span><span class="p">()</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">'G'</span><span class="p">,</span><span class="w"> </span><span class="s1">'ggg'</span><span class="w">

</span><span class="c"># 不确定这样的话 .NET 方法如何调用</span><span class="w">
</span><span class="s1">'string'</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">gm</span><span class="w">

</span><span class="c"># 调用静态 .NET 方法的语法：</span><span class="w">
</span><span class="p">[</span><span class="n">System.Reflection.Assembly</span><span class="p">]::</span><span class="n">LoadWithPartialName</span><span class="p">(</span><span class="s1">'Microsoft.VisualBasic'</span><span class="p">)</span><span class="w">

</span><span class="c"># 注意 .NET 方法调用必须使用括号，然而 PS 函数调用不能使用括号；</span><span class="w">
</span><span class="c"># 如果你调用 cmdlet/PS 函数使用了括号，就相当于传递了参数列表。</span><span class="w">
</span><span class="nv">$writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nx">System.IO.StreamWriter</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span><span class="w"> </span><span class="bp">$true</span><span class="p">)</span><span class="w">
</span><span class="nv">$writer</span><span class="o">.</span><span class="nf">Write</span><span class="p">([</span><span class="n">Environment</span><span class="p">]::</span><span class="nx">NewLine</span><span class="p">)</span><span class="w">
</span><span class="nv">$writer</span><span class="o">.</span><span class="nf">Dispose</span><span class="p">()</span><span class="w">

</span><span class="c">### IO</span><span class="w">
</span><span class="c"># 从输入读入一个值</span><span class="w">
</span><span class="nv">$Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"What's your name?"</span><span class="w">
</span><span class="n">echo</span><span class="w"> </span><span class="s2">"Hello, </span><span class="nv">$Name</span><span class="s2">!"</span><span class="w">
</span><span class="p">[</span><span class="n">int</span><span class="p">]</span><span class="nv">$Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Read-Host</span><span class="w"> </span><span class="s2">"What's your age?"</span><span class="w">

</span><span class="c"># Test-Path, Split-Path, Join-Path, Resolve-Path</span><span class="w">
</span><span class="c"># Get-Content filename # 返回字符串数组 string[]</span><span class="w">
</span><span class="c"># Set-Content, Add-Content, Clear-Content</span><span class="w">
</span><span class="n">Get-Command</span><span class="w"> </span><span class="nx">ConvertTo-</span><span class="o">*</span><span class="p">,</span><span class="nx">ConvertFrom-</span><span class="o">*</span><span class="w">


</span><span class="c">### 有用的东西</span><span class="w">
</span><span class="c"># 更新 PATH</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PATH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">System.Environment</span><span class="p">]::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s2">"Path"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Machine"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="s2">";"</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="n">System.Environment</span><span class="p">]::</span><span class="n">GetEnvironmentVariable</span><span class="p">(</span><span class="s2">"Path"</span><span class="p">,</span><span class="w"> </span><span class="s2">"User"</span><span class="p">)</span><span class="w">

</span><span class="c"># 找到 Python 的 PATH</span><span class="w">
</span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">PATH</span><span class="o">.</span><span class="nf">Split</span><span class="p">(</span><span class="s2">";"</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s2">"*python*"</span><span class="p">}</span><span class="w">

</span><span class="c"># 改变工作目录而不需要记住之前的路径</span><span class="w">
</span><span class="n">Push-Location</span><span class="w"> </span><span class="nx">c:\temp</span><span class="w"> </span><span class="c"># 改变工作目录至 c:\temp</span><span class="w">
</span><span class="n">Pop-Location</span><span class="w"> </span><span class="c"># 改变到之前的工作目录</span><span class="w">
</span><span class="c"># 别名: pushd 和 popd</span><span class="w">

</span><span class="c"># 在下载之后解除目录阻塞</span><span class="w">
</span><span class="n">Get-ChildItem</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Unblock-File</span><span class="w">

</span><span class="c"># Windows 资源管理器打开当前目录</span><span class="w">
</span><span class="n">ii</span><span class="w"> </span><span class="o">.</span><span class="w">

</span><span class="c"># 按任意键退出</span><span class="w">
</span><span class="nv">$host</span><span class="o">.</span><span class="nf">UI</span><span class="o">.</span><span class="nf">RawUI</span><span class="o">.</span><span class="nf">ReadKey</span><span class="p">()</span><span class="w">
</span><span class="kr">return</span><span class="w">

</span><span class="c"># 创建快捷方式</span><span class="w">
</span><span class="nv">$WshShell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">New-Object</span><span class="w"> </span><span class="nt">-comObject</span><span class="w"> </span><span class="nx">WScript.Shell</span><span class="w">
</span><span class="nv">$Shortcut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$WshShell</span><span class="o">.</span><span class="nf">CreateShortcut</span><span class="p">(</span><span class="nv">$link</span><span class="p">)</span><span class="w">
</span><span class="nv">$Shortcut</span><span class="o">.</span><span class="nf">TargetPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$file</span><span class="w">
</span><span class="nv">$Shortcut</span><span class="o">.</span><span class="nf">WorkingDirectory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Split-Path</span><span class="w"> </span><span class="nv">$file</span><span class="w">
</span><span class="nv">$Shortcut</span><span class="o">.</span><span class="nf">Save</span><span class="p">()</span><span class="w">
</span></code></pre></div>
<p>配置你的 PowerShell</p>
<div class="highlight"><pre class="highlight powershell"><code><span class="c"># $Profile 是文件 `Microsoft.PowerShell_profile.ps1` 完整路径</span><span class="w">
</span><span class="c"># 下面所有的代码都在 PS 会话开始的时候执行</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="o">-not</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$Profile</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-Type</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$Profile</span><span class="w"> </span><span class="nt">-Force</span><span class="w">
    </span><span class="n">notepad</span><span class="w"> </span><span class="nv">$Profile</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c"># 更多信息: `help about_profiles`</span><span class="w">
</span><span class="c"># 更多关于 Shell 有用的信息，确保查看下面的 PSReadLine 项目。</span><span class="w">
</span></code></pre></div>
<p>更多项目</p>

<ul>
<li><a href="https://channel9.msdn.com/Search?term=powershell%20pipeline#ch9Search&amp;lang-en=en">Channel9</a> PowerShell 教程</li>
<li><a href="https://github.com/psget/psget">PSGet</a> PowerShell NuGet 包</li>
<li><a href="https://github.com/lzybkr/PSReadLine/">PSReadLine</a> 仿 bash 按行读取（ Window10 默认包含）</li>
<li><a href="https://github.com/dahlbyk/posh-git/">Posh-Git</a> Git 命令提示 (推荐!)</li>
<li><a href="https://github.com/psake/psake">PSake</a> 自动构建工作</li>
<li><a href="https://github.com/pester/Pester">Pester</a> BDD 测试框架</li>
<li><a href="https://github.com/tkellogg/Jump-Location">Jump-Location</a> Poweshell 中 <code>cd</code> 来跳转目录</li>
<li><a href="http://pscx.codeplex.com/">PowerShell Community Extensions</a> (废弃)</li>
</ul>

<p>尚未涉及</p>

<ul>
<li>WMI: Windows 管理规范 (Get-CimInstance)</li>
<li>多任务: Start-Job -scriptBlock {&hellip;},</li>
<li>代码签名</li>
<li>远程 (Enter-PSSession/Exit-PSSession; Invoke-Command)</li>
</ul>

    <hr>
    <p>有建议？或者发现什么错误？在Github上<a href="https://github.com/adambard/learnxinyminutes-docs/issues/new">开一个issue</a>，或者发起<a href="https://github.com/adambard/learnxinyminutes-docs/edit/master/zh-cn/powershell-cn.html.markdown">pull request</a>！
    </p>
    <p class="contributed">
    原著Wouter Van Schandevijl，并由<a href="https://github.com/adambard/learnxinyminutes-docs/blame/master/zh-cn/powershell-cn.html.markdown">0个好心人</a>修改。
    </p>

    <footer>
    <a style="float: left" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
    <p>
    &copy; 2024
        <a href="https://github.com/laoujin">Wouter Van Schandevijl</a>
    </p>

    <p>
      Translated by:
        <a href="https://github.com/gaufung">Feng Gao</a>

    </footer>
  </div>

        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="/js/script.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-3525624-21'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
