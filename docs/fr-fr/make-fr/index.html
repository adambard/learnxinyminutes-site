<!DOCTYPE html>
<!--[if lt IE 7]>      <html lang="fr-fr" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html lang="fr-fr" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html lang="fr-fr" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html lang="fr-fr" class="no-js"> <!--<![endif]-->
    <head>
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-WXC8R75DEN"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-WXC8R75DEN');
      </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Content-Language" content="fr-fr">
        <!-- Use title if it's in the page YAML frontmatter -->
        <title>Learn X in Y Minutes: Scenic Programming Language Tours</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="/css/index.css">

        <link rel="canonical" href="https://learnxinyminutes.com/docs/fr-fr/make-fr/">
        <script>
            var THEME_KEY = "lxiym_theme";
            function set_theme(theme) {
                var el = document.getElementsByTagName("html")[0];
                if (!el) {
                  return;
                }

                if (theme === "dark" ) {
                    el.className = "dark";
                } else {
                    el.className = "light";
                }

                localStorage.setItem(THEME_KEY, theme);
            }

            function load_theme() {
              var theme = localStorage.getItem(THEME_KEY);
              if (theme) {
                set_theme(theme);
              }
            }

            // Attempt immediate application of html style
            load_theme();

            // Backup: do it onload. Will flash, but better than nothing.
            window.addEventListener("load", function(){
              load_theme();
            });
        </script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <div class="container">
            <div class="share">
    <span class="sharemsg">
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flearnxinyminutes.com%2Fdocs%2Ffr-fr%2Fmake-fr%2F&text=Apprendre+X+en+Y+minutes%2C+o%C3%B9+X%3Dmake">
        Partager cette page
      </a></span>

      <span class='st_facebook_large' displayText='Facebook'></span>
      <span class='st_twitter_large' displayText='Tweet'></span>
  </div>
  <div class="theme-choice">
    <label id="theme-label">Choisis un thème:</label>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('light');">clair</button>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('dark');">sombre</button>
  </div>
  <h1><a href="/">Apprendre X en Y minutes</a></h1>
  <h2>Où X=make</h2>
    <p class="filelink">
    Récupérer le code:
    <a href="/docs/files/Makefile-fr">Makefile-fr</a>
    </p>
  <div id="doc">
    <p>Un makefile est un fichier qui définit un ensemble de règles liées entre elles
pour créer une ou plusieurs cibles. L&#39;idée est d&#39;effectuer le moins de travail
possible afin de mettre à jour la ou les cibles en fonction des dépendances.</p>

<p>Écrit en un week-end par Stuart Feldman en 1976, le make et les
makefiles sont encore très utilisés (principalement dans les systèmes Unix),
malgré la concurrence et les critiques faites à son égard.</p>

<p>Le programme make a plusieurs variantes. Dans ce tutoriel, nous utiliserons
l&#39;implémentation standard : GNU make.</p>
<div class="highlight"><pre><span></span><span class="c"># Ceci est un commentaire.</span>

<span class="c"># Un makefile devrait être nommé &quot;Makefile&quot; (avec ou sans la</span>
<span class="c"># majuscule). Il peut alors être exécuté par `make &lt;cible&gt;`.</span>
<span class="c"># Ce nommage n&#39;est toutefois pas obligatoire : utiliser</span>
<span class="c"># `make -f &quot;fichier&quot; &lt;cible&gt;`.</span>

<span class="c"># ATTENTION : l&#39;indentation est quant à elle obligatoire, et se fait avec des</span>
<span class="c"># tabulations, pas avec des espaces !</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Les basiques</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># Une règle. Elle ne sera exécutée que si fichier0.txt n&#39;existe pas.</span>
<span class="nf">fichier0.txt</span><span class="o">:</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;truc&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>fichier0.txt
<span class="c">    # Même les commentaires sont transférés dans le terminal.</span>

<span class="c"># Cette règle ne sera exécutée que si fichier0.txt est plus récent que</span>
<span class="c"># fichier1.txt.</span>
<span class="nf">fichier1.txt</span><span class="o">:</span><span class="w"> </span><span class="n">fichier</span>0.<span class="n">txt</span>
<span class="w">    </span>cat<span class="w"> </span>fichier0.txt<span class="w"> </span>&gt;<span class="w"> </span>fichier1.txt
<span class="c">    # Utiliser la même syntaxe que dans un terminal.</span>
<span class="w">    </span>@cat<span class="w"> </span>fichier0.txt<span class="w"> </span>&gt;&gt;<span class="w"> </span>fichier1.txt
<span class="c">    # @ empêche l&#39;affichage de la sortie texte d&#39;une commande.</span>
<span class="w">    </span>-@echo<span class="w"> </span><span class="s1">&#39;hello&#39;</span>
<span class="c">    # - signifie que la règle devrait continuer à s&#39;exécuter si cette commande</span>
<span class="c">    # échoue.</span>

<span class="c"># Une règle peut avoir plusieurs cibles et plusieurs dépendances.</span>
<span class="nf">fichier2.txt fichier3.txt</span><span class="o">:</span><span class="w"> </span><span class="n">fichier</span>0.<span class="n">txt</span> <span class="n">fichier</span>1.<span class="n">txt</span>
<span class="w">    </span>touch<span class="w"> </span>fichier2.txt
<span class="w">    </span>touch<span class="w"> </span>fichier3.txt

<span class="c"># Make affichera un avertissement si le makefile comporte plusieurs règles pour</span>
<span class="c"># une même cible. Cependant les règles vides ne comptent pas, et peuvent être</span>
<span class="c"># utilisées pour ajouter des dépendances plus facilement.</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Fausses règles</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># Une fausse règle est une règle qui ne correspond pas à un fichier.</span>
<span class="c"># Par définition, elle ne peut pas être à jour, et donc make l’exécutera à</span>
<span class="c"># chaque demande.</span>
<span class="nf">all</span><span class="o">:</span><span class="w"> </span><span class="n">maker</span> <span class="n">process</span>

<span class="c"># La déclaration des règles peut être faite dans n&#39;importe quel ordre.</span>
<span class="nf">maker</span><span class="o">:</span>
<span class="w">    </span>touch<span class="w"> </span>ex0.txt<span class="w"> </span>ex1.txt

<span class="c"># On peut transformer une règle en fausse règle grâce à la cible spéciale</span>
<span class="c"># suivante :</span>
<span class="nf">.PHONY</span><span class="o">:</span><span class="w"> </span><span class="n">all</span> <span class="n">maker</span> <span class="n">process</span>

<span class="c"># Une règle dépendante d&#39;une fausse règle sera toujours exécutée.</span>
<span class="nf">ex0.txt ex1.txt</span><span class="o">:</span><span class="w"> </span><span class="n">maker</span>

<span class="c"># Voici quelques exemples fréquents de fausses règles : all, make, clean,</span>
<span class="c"># install...</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Variables automatiques et wildcards</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># Utilise un wildcard pour des noms de fichier</span>
<span class="nf">process</span><span class="o">:</span><span class="w"> </span><span class="n">fichier</span>*.<span class="n">txt</span>
<span class="w">    </span>@echo<span class="w"> </span>$^<span class="w">    </span><span class="c1"># $^ est une variable contenant la liste des dépendances de la</span>
<span class="c">                # cible actuelle.</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="nv">$@</span><span class="w">    </span><span class="c1"># $@ est le nom de la cible actuelle. En cas de cibles</span>
<span class="c">                # multiples, $@ est le nom de la cible ayant causé l&#39;exécution</span>
<span class="c">                # de cette règle.</span>
<span class="w">    </span>@echo<span class="w"> </span>$&lt;<span class="w">    </span><span class="c1"># $&lt; contient la première dépendance.</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="nv">$?</span><span class="w">    </span><span class="c1"># $? contient la liste des dépendances qui ne sont pas à jour.</span>
<span class="w">    </span>@echo<span class="w"> </span>$+<span class="w">    </span><span class="c1"># $+ contient la liste des dépendances avec d&#39;éventuels</span>
<span class="c">                # duplicatas, contrairement à $^.</span>
<span class="w">    </span>@echo<span class="w"> </span>$<span class="p">|</span><span class="w">    </span><span class="c1"># $| contient la liste des cibles ayant préséance sur la cible</span>
<span class="c">                # actuelle.</span>

<span class="c"># Même si la définition de la règle est scindée en plusieurs morceaux, $^</span>
<span class="c"># listera toutes les dépendances indiquées.</span>
<span class="nf">process</span><span class="o">:</span><span class="w"> </span><span class="n">ex</span>1.<span class="n">txt</span> <span class="n">fichier</span>0.<span class="n">txt</span>
<span class="c"># Ici, fichier0.txt est un duplicata dans $+.</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Pattern matching</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># En utilisant le pattern matching, on peut par exemple créer des règles pour</span>
<span class="c"># convertir les fichiers d&#39;un certain format dans un autre.</span>
<span class="nf">%.png</span><span class="o">:</span><span class="w"> </span>%.<span class="n">svg</span>
<span class="w">    </span>inkscape<span class="w"> </span>--export-png<span class="w"> </span>$^

<span class="c"># Make exécute une règle même si le fichier correspondant est situé dans un sous</span>
<span class="c"># dossier. En cas de conflit, la règle avec la meilleure correspondance est</span>
<span class="c"># choisie.</span>
<span class="nf">small/%.png</span><span class="o">:</span><span class="w"> </span>%.<span class="n">svg</span>
<span class="w">    </span>inkscape<span class="w"> </span>--export-png<span class="w"> </span>--export-dpi<span class="w"> </span><span class="m">30</span><span class="w"> </span>$^

<span class="c"># Dans ce type de conflit (même cible, même dépendances), make exécutera la</span>
<span class="c"># dernière règle déclarée...</span>
<span class="nf">%.png</span><span class="o">:</span><span class="w"> </span>%.<span class="n">svg</span>
<span class="w">    </span>@echo<span class="w"> </span>cette<span class="w"> </span>règle<span class="w"> </span>est<span class="w"> </span>choisie

<span class="c"># Dans ce type de conflit (même cible mais pas les mêmes dépendances), make</span>
<span class="c"># exécutera la première règle pouvant être exécutée.</span>
<span class="nf">%.png</span><span class="o">:</span><span class="w"> </span>%.<span class="n">ps</span>
<span class="w">    </span>@echo<span class="w"> </span>cette<span class="w"> </span>règle<span class="w"> </span>n<span class="se">\&#39;</span>est<span class="w"> </span>pas<span class="w"> </span>choisie<span class="w"> </span>si<span class="w"> </span>*.svg<span class="w"> </span>et<span class="w"> </span>*.ps<span class="w"> </span>sont<span class="w"> </span>présents

<span class="c"># Make a des règles pré établies. Par exemple, il sait comment créer la cible</span>
<span class="c"># *.o à partir de *.c.</span>

<span class="c"># Les makefiles plus vieux utilisent un matching par extension de fichier.</span>
<span class="nf">.png.ps</span><span class="o">:</span>
<span class="w">    </span>@echo<span class="w"> </span>cette<span class="w"> </span>règle<span class="w"> </span>est<span class="w"> </span>similaire<span class="w"> </span>à<span class="w"> </span>une<span class="w"> </span>règle<span class="w"> </span>par<span class="w"> </span>pattern<span class="w"> </span>matching

<span class="c"># Utiliser cette règle spéciale pour déclarer une règle comme ayant un</span>
<span class="c"># matching par extension de fichier.</span>
<span class="nf">.SUFFIXES</span><span class="o">:</span><span class="w"> </span>.<span class="n">png</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Variables, ou macros</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># Les variables sont des chaînes de caractères.</span>

<span class="nv">variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Ted
<span class="nv">variable2</span><span class="o">=</span><span class="s2">&quot;Sarah&quot;</span>

<span class="nf">echo</span><span class="o">:</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="k">$(</span>variable<span class="k">)</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="si">${</span><span class="nv">variable2</span><span class="si">}</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="nv">$variable</span><span class="w">    </span><span class="c1"># Cette syntaxe signifie $(n)ame et non pas $(variable) !</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="k">$(</span>variable3<span class="k">)</span><span class="w"> </span><span class="c1"># Les variables non déclarées valent &quot;&quot; (chaîne vide).</span>

<span class="c"># Les variables sont déclarées de 4 manières, de la plus grande priorité à la</span>
<span class="c"># plus faible :</span>
<span class="c"># 1 : dans la ligne de commande qui invoque make,</span>
<span class="c"># 2 : dans le makefile,</span>
<span class="c"># 3 : dans les variables d’environnement du terminal qui invoque make,</span>
<span class="c"># 4 : les variables prédéfinies.</span>

<span class="c"># Assigne la variable si une variable d’environnement du même nom n&#39;existe pas</span>
<span class="c"># déjà.</span>
<span class="nv">variable4</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span>Jean

<span class="c"># Empêche cette variable d&#39;être modifiée par la ligne de commande.</span>
<span class="err">override</span><span class="w"> </span><span class="nv">variable5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>David

<span class="c"># Concatène à une variable (avec un espace avant).</span>
<span class="nv">variable4</span><span class="w"> </span><span class="o">+=</span>gris

<span class="c"># Assignations de variable pour les règles correspondant à un pattern</span>
<span class="c"># (spécifique à GNU make).</span>
<span class="nf">*.png</span><span class="o">:</span><span class="w"> </span><span class="n">variable</span>2 = <span class="n">Sara</span> <span class="c"># Pour toutes les règles correspondant à *.png, et tous</span>
<span class="c">                        # leurs descendants, la variable variable2 vaudra</span>
<span class="c">                        # &quot;Sara&quot;.</span>
<span class="c"># Si le jeux des dépendances et descendances devient vraiment trop compliqué,</span>
<span class="c"># des incohérences peuvent survenir.</span>

<span class="c"># Certaines variables sont prédéfinies par make :</span>
<span class="nf">affiche_predefinies</span><span class="o">:</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>CC<span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">CXX</span><span class="si">}</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>FC<span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">CFLAGS</span><span class="si">}</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>CPPFLAGS<span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">CXXFLAGS</span><span class="si">}</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="k">$(</span>LDFLAGS<span class="k">)</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">LDLIBS</span><span class="si">}</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Variables : le retour</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># Les variables sont évaluées à chaque instance, ce qui peut être coûteux en</span>
<span class="c"># calculs. Pour parer à ce problème, il existe dans GNU make une seconde</span>
<span class="c"># manière d&#39;assigner des variables pour qu&#39;elles ne soient évaluées qu&#39;une seule</span>
<span class="c"># fois seulement.</span>

<span class="nv">var</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>A<span class="w"> </span>B<span class="w"> </span>C
<span class="nf">var2 </span><span class="o">::</span>=  <span class="k">$(</span><span class="nv">var</span><span class="k">)</span> <span class="n">D</span> <span class="n">E</span> <span class="n">F</span> <span class="c"># := et ::= sont équivalents.</span>

<span class="c"># Ces variables sont évaluées procéduralement (i.e. dans leur ordre</span>
<span class="c"># d&#39;apparition), contrairement aux règles par exemple !</span>

<span class="c"># Ceci ne fonctionne pas.</span>
<span class="nf">var3 </span><span class="o">::</span>= <span class="k">$(</span><span class="nv">var4</span><span class="k">)</span> <span class="n">et</span> <span class="n">fais</span> <span class="n">de</span> <span class="n">beaux</span> <span class="n">r</span>ê<span class="n">ves</span>
<span class="nf">var4 </span><span class="o">::</span>= <span class="n">bonne</span> <span class="n">nuit</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Fonctions</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># Make a une multitude de fonctions. La syntaxe générale est</span>
<span class="c"># $(fonction arg0,arg1,arg2...).</span>

<span class="c"># Quelques exemples :</span>

<span class="nv">fichiers_source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>wildcard<span class="w"> </span>*.c<span class="w"> </span>*/*.c<span class="k">)</span>
<span class="nv">fichiers_objet</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>patsubst<span class="w"> </span>%.c,%.o,<span class="k">$(</span>fichiers_source<span class="k">))</span>

<span class="nf">ls</span><span class="o">:</span><span class="w"> </span>* <span class="n">src</span>/*
<span class="w">    </span>@echo<span class="w"> </span><span class="k">$(</span>filter<span class="w"> </span>%.txt,<span class="w"> </span>$^<span class="k">)</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="k">$(</span>notdir<span class="w"> </span>$^<span class="k">)</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="k">$(</span>join<span class="w"> </span><span class="k">$(</span>dir<span class="w"> </span>$^<span class="k">)</span>,<span class="k">$(</span>notdir<span class="w"> </span>$^<span class="k">))</span>

<span class="c">#-----------------------------------------------------------------------</span>
<span class="c"># Directives</span>
<span class="c">#-----------------------------------------------------------------------</span>

<span class="c"># Inclut d&#39;autres makefiles.</span>
<span class="cp">include meuh.mk</span>

<span class="c"># Branchements conditionnels.</span>
<span class="nv">sport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tennis
<span class="nf">report</span><span class="o">:</span>
<span class="cp">ifeq ($(sport),tennis)                  # Il y a aussi ifneq.</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="s1">&#39;jeu, set et match&#39;</span>
<span class="cp">else</span>
<span class="w">    </span>@echo<span class="w"> </span><span class="s2">&quot;C&#39;est pas ici Wimbledon ?&quot;</span>
<span class="cp">endif</span>

<span class="nv">truc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="cp">ifdef $(truc)                           # Il y a aussi ifndef.</span>
<span class="w">    </span><span class="nv">machin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;salut&#39;</span>
<span class="cp">endif</span>
</pre></div>
<h2>Quelques références</h2>

<h3>En français</h3>

<ul>
<li><a href="http://gl.developpez.com/tutoriel/outil/makefile/">Introduction à Makefile (developpez.com)</a>,</li>
<li><a href="https://openclassrooms.com/courses/compilez-sous-gnu-linux">Compilez sous GNU/Linux ! (openclassrooms)</a>.</li>
</ul>

<h3>En anglais</h3>

<ul>
<li><a href="https://www.gnu.org/software/make/manual/">Documentation de GNU make</a>,</li>
<li><a href="http://swcarpentry.github.io/make-novice/">Software carpentry tutorial</a>,</li>
<li>Learn C the hard way <a href="http://c.learncodethehardway.org/book/ex2.html">ex2</a>
<a href="http://c.learncodethehardway.org/book/ex28.html">ex28</a>.</li>
</ul>

    <hr>
    <p>Vous avez une suggestion ? Peut-être une correction ? <a href="https://github.com/adambard/learnxinyminutes-docs/issues/new">Ouvrez un ticket</a> sur GitHub, ou faites vous-même une <a href="https://github.com/adambard/learnxinyminutes-docs/edit/master/fr-fr/make-fr.html.markdown">pull request</a> !
    </p>
    <p class="contributed">
    Version originale par Robert Steed, mis à jour par <a href="https://github.com/adambard/learnxinyminutes-docs/blame/master/fr-fr/make-fr.html.markdown">2 contributeur(s)</a>.
    </p>

    <footer>
    <a style="float: left" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
    <p>
    &copy; 2024
        <a href="https://github.com/robochat">Robert Steed</a>
    </p>

    <p>
      Translated by:
        <a href="https://github.com/altaris">altaris</a>

    </footer>
  </div>

        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="/js/script.js"></script>
    </body>
</html>
