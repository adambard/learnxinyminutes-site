<!DOCTYPE html lang="fr-fr" xml:lang="fr-fr" xmlns="http://www.w3.org/1999/xhtml">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-WXC8R75DEN"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-WXC8R75DEN');
      </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Content-Language" content="fr-fr">
        <!-- Use title if it's in the page YAML frontmatter -->
        <title>Learn Lua in Y Minutes</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="/css/index.css">

        <link rel="canonical" href="https://learnxinyminutes.com/docs/fr-fr/lua-fr/">
        <script>
            var THEME_KEY = "lxiym_theme";
            function set_theme(theme) {
                var el = document.getElementsByTagName("html")[0];
                if (!el) {
                  return;
                }

                if (theme === "dark" ) {
                    el.className = "dark";
                } else {
                    el.className = "light";
                }

                localStorage.setItem(THEME_KEY, theme);
            }

            function load_theme() {
              var theme = localStorage.getItem(THEME_KEY);
              if (theme) {
                set_theme(theme);
              }
            }

            // Attempt immediate application of html style
            load_theme();

            // Backup: do it onload. Will flash, but better than nothing.
            window.addEventListener("load", function(){
              load_theme();
            });
        </script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <div class="container">
            <div class="share">
    <span class="sharemsg">
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flearnxinyminutes.com%2Fdocs%2Ffr-fr%2Flua-fr%2F&text=Apprendre+X+en+Y+minutes%2C+o%C3%B9+X%3DLua">
        Partager cette page
      </a></span>

      <span class='st_facebook_large' displayText='Facebook'></span>
      <span class='st_twitter_large' displayText='Tweet'></span>
  </div>
  <div class="theme-choice">
    <label id="theme-label">Choisis un thème:</label>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('light');">clair</button>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('dark');">sombre</button>
  </div>
  <h1><a href="/">Apprendre X en Y minutes</a></h1>
  <h2>Où X=Lua</h2>
    <p class="filelink">
    Récupérer le code:
    <a href="/docs/files/learnlua-fr.lua">learnlua-fr.lua</a>
    </p>
  <div id="doc">
    <div class="highlight"><pre class="highlight lua"><code><span class="c1">-- Les commentaires unilignes commencent par un double tiret.</span>

<span class="cm">--[[
     Les doubles crochets à la suite du double tiret 
     permettent d'insérer des commentaires multilignes.
--]]</span>

<span class="c1">----------------------------------------------------</span>
<span class="c1">-- 1. Variables et contrôle d'exécution.</span>
<span class="c1">----------------------------------------------------</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">42</span>  <span class="c1">-- Tous les nombres sont de type double.</span>
<span class="c1">-- Rassurez vous cependant, les doubles stockés sur 64-bits</span>
<span class="c1">-- en réservent 52 pour la valeur exacte des entiers. La</span>
<span class="c1">-- précision n'est donc pas un problème pour tout entier qui</span>
<span class="c1">-- peut être codé sur moins de 52 bits.</span>

<span class="n">s</span> <span class="o">=</span> <span class="s1">'walternate'</span>  <span class="c1">-- Chaines de caractères immuables comme en Python.</span>
<span class="n">t</span> <span class="o">=</span> <span class="s2">"une chaine avec des guillemets doubles"</span>
<span class="n">u</span> <span class="o">=</span> <span class="s">[[les double crochets permettent
      d'avoir une chaine de caractères
      sur plusieurs lignes.]]</span>
<span class="n">t</span> <span class="o">=</span> <span class="kc">nil</span>  <span class="c1">-- Affecte la valeur nulle à t; Lua possède un ramasse-miettes</span>

<span class="c1">-- Le do/end définit un bloc de code</span>
<span class="k">while</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="k">do</span>
  <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1">-- Pas d'opérateurs de type ++ ou +=.</span>
<span class="k">end</span>

<span class="c1">-- Les structures en if:</span>
<span class="k">if</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">40</span> <span class="k">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">'supérieur à 40'</span><span class="p">)</span>
<span class="k">elseif</span> <span class="n">s</span> <span class="o">~=</span> <span class="s1">'walternate'</span> <span class="k">then</span>  <span class="c1">-- ~= : est différent de.</span>
  <span class="c1">-- Le test d'égalité se fait avec == comme en Python.</span>
  <span class="nb">io.write</span><span class="p">(</span><span class="s1">'inférieur à 40\n'</span><span class="p">)</span>  <span class="c1">-- Écrit par defaut sur la sortie stdout.</span>
<span class="k">else</span>
  <span class="c1">-- Les variables sont globales par défaut.</span>
  <span class="n">thisIsGlobal</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1">-- le style camelCase est courant.</span>

  <span class="c1">-- Une variable locale est déclarée avec le mot-clé local:</span>
  <span class="kd">local</span> <span class="n">line</span> <span class="o">=</span> <span class="nb">io.read</span><span class="p">()</span>  <span class="c1">-- Permet de lire la ligne suivante dans stdin.</span>

  <span class="c1">-- .. est l'opérateur de concaténation:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"L'hiver approche, "</span> <span class="o">..</span> <span class="n">line</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- Les variables non définies reçoivent par défaut la valeur nil.</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">anUnknownVariable</span>  <span class="c1">-- Maintenant, foo = nil.</span>

<span class="n">aBoolValue</span> <span class="o">=</span> <span class="kc">false</span>

<span class="c1">-- Seuls nil et false sont des valeurs fausses.</span>
<span class="c1">-- Mais 0 et '' sont des valeurs vraies!</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">aBoolValue</span> <span class="k">then</span> <span class="nb">print</span><span class="p">(</span><span class="s1">'etait faux'</span><span class="p">)</span> <span class="k">end</span>

<span class="c1">-- L'évaluation du 'or' et du 'and' est court-circuité.</span>
<span class="c1">-- Comme avec les ternaires du C et du JS: a?b:c</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">aBoolValue</span> <span class="ow">and</span> <span class="s1">'oui'</span> <span class="ow">or</span> <span class="s1">'non'</span>  <span class="c1">--&gt; 'non'</span>

<span class="n">karlSum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span> <span class="k">do</span>  <span class="c1">-- Les bornes sont incluses dans l'intervalle.</span>
  <span class="n">karlSum</span> <span class="o">=</span> <span class="n">karlSum</span> <span class="o">+</span> <span class="n">i</span>
<span class="k">end</span>

<span class="c1">-- Utilisez "100, 1, -1" pour la décrémentation:</span>
<span class="n">fredSum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">do</span> <span class="n">fredSum</span> <span class="o">=</span> <span class="n">fredSum</span> <span class="o">+</span> <span class="n">j</span> <span class="k">end</span>

<span class="c1">-- En général, l'intervalle est début, fin[, pas].</span>

<span class="c1">-- Un autre type de boucle:</span>
<span class="k">repeat</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">'the way of the future'</span><span class="p">)</span>
  <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span>
<span class="k">until</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span>


<span class="c1">----------------------------------------------------</span>
<span class="c1">-- 2. Fonctions.</span>
<span class="c1">----------------------------------------------------</span>

<span class="k">function</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">then</span> <span class="k">return</span> <span class="n">n</span> <span class="k">end</span>
  <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- Lua implémente les fermetures et les fonctions anonymes:</span>
<span class="k">function</span> <span class="nf">adder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="c1">-- La fonction retournée est créée lorsque adder est appelé</span>
  <span class="c1">-- et elle se rappelle de la valeur de x.</span>
  <span class="k">return</span> <span class="k">function</span> <span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="k">end</span>
<span class="k">end</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">adder</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a1</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>  <span class="c1">--&gt; 25</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a2</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>  <span class="c1">--&gt; 100</span>

<span class="c1">-- Les valeurs de retour, les appels de fonction, les assignations</span>
<span class="c1">-- supportent tous les listes qui peuvent ne pas correspondre en longueur.</span>
<span class="c1">-- Dans ce cas, les variables à assigner en supplément reçoivent nil</span>
<span class="c1">-- tandis que les valeurs à attribuer en supplément sont ignorées</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="c1">-- x = 1 et y = 2</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="c1">-- x = 1, y = 2 et z = nil</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="c1">-- x = 1, y = 2, z = 3, et 4 est ignoré.</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">42</span>
<span class="k">end</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="s1">'zaphod'</span><span class="p">)</span>  <span class="c1">--&gt; affiche "zaphod nil nil"</span>
<span class="c1">-- x = 4, y = 8, les valeurs 15 à 42 sont ignorées.</span>

<span class="c1">-- Les fonctions sont des valeurs de première classe </span>
<span class="c1">-- et peuvent être locales/globales.</span>
<span class="c1">-- Les déclarations suivantes sont identiques:</span>
<span class="k">function</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">end</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="k">end</span>

<span class="c1">-- Il en va de même pour les déclarations suivantes:</span>
<span class="kd">local</span> <span class="k">function</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">end</span>
<span class="kd">local</span> <span class="n">g</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">end</span>
<span class="c1">-- Sauf que pour le dernier cas, même si local g = function(x)</span>
<span class="c1">-- est équivalent à local function g(x), il n'est pas possible</span>
<span class="c1">-- de faire appel à g à l'intérieur du corps de la fonction (récursion)</span>

<span class="c1">-- À moins de déclarer la fonction auparavant:</span>
<span class="kd">local</span> <span class="n">g</span><span class="p">;</span> <span class="n">g</span>  <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">return</span> <span class="nb">math.sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">end</span>

<span class="c1">-- À propos, les fonctions trigonométriques interprètent </span>
<span class="c1">-- leurs arguments en radians.</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">math.cos</span><span class="p">(</span><span class="nb">math.pi</span><span class="p">))</span> <span class="c1">-- affiche "-1"</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">math.sin</span><span class="p">(</span><span class="nb">math.pi</span><span class="p">))</span> <span class="c1">-- affiche "0"</span>

<span class="c1">-- Lorsqu'une fonction est appelée avec un seul argument qui est une chaine,</span>
<span class="c1">-- les parenthèses peuvent être omises:</span>
<span class="nb">print</span> <span class="s1">'hello'</span>  <span class="c1">-- équivalent à print('hello').</span>

<span class="c1">-- Lorsqu'une fonction est appelée avec un seul argument qui est une table,</span>
<span class="c1">-- les parenthèses peuvent aussi être omises.</span>
<span class="nb">print</span> <span class="p">{}</span> <span class="c1">-- équivalent à print({}).</span>


<span class="c1">----------------------------------------------------</span>
<span class="c1">-- 3. Tables.</span>
<span class="c1">----------------------------------------------------</span>

<span class="c1">-- Tables = Seule structure de données en Lua;</span>
<span class="c1">--          Ce sont des listes assotiatives.</span>
<span class="c1">-- Elles sont similaires aux tables PHP ou aux objets JS :</span>
<span class="c1">-- des tables-dictionnaires que l'on peut utiliser en tant que listes.</span>

<span class="c1">-- Tables en tant que dictionnaires:</span>

<span class="c1">-- Les clés sont des chaines de caractères par défaut:</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s1">'valeur1'</span><span class="p">,</span> <span class="n">key2</span> <span class="o">=</span> <span class="kc">false</span><span class="p">}</span>

<span class="c1">-- Elles peuvent être indexées avec la notation en point, comme en JS:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">key1</span><span class="p">)</span>  <span class="c1">-- Affiche "valeur1".</span>
<span class="n">t</span><span class="p">.</span><span class="n">newKey</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">-- Ajoute une nouvelle paire clé/valeur.</span>
<span class="n">t</span><span class="p">.</span><span class="n">key2</span> <span class="o">=</span> <span class="kc">nil</span>   <span class="c1">-- Supprime la clé "key2" de la table.</span>

<span class="c1">-- Notation littérale pour toute valeur non nulle en tant que clé:</span>
<span class="n">u</span> <span class="o">=</span> <span class="p">{[</span><span class="s1">'@!#'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'qbert'</span><span class="p">,</span> <span class="p">[{}]</span> <span class="o">=</span> <span class="mi">1729</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">.</span><span class="mi">28</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'tau'</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">6</span><span class="p">.</span><span class="mi">28</span><span class="p">])</span>  <span class="c1">-- affiche "tau"</span>

<span class="c1">-- La correspondance des clés se fait par valeur pour</span>
<span class="c1">-- les nombres et les chaines, mais par référence pour les tables.</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="s1">'@!#'</span><span class="p">]</span>  <span class="c1">-- a = 'qbert'.</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">u</span><span class="p">[{}]</span>     <span class="c1">-- On pourrait s'attendre à 1729, mais l'on obtient nil:</span>
<span class="c1">-- b = nil car la clé utilisée n'est pas le même objet que celui</span>
<span class="c1">-- utilisé pour stocker la valeur originale 1729.</span>

<span class="c1">-- Si une fonction prend en argument une seule table, l'on peut</span>
<span class="c1">-- omettre les parenthèses:</span>
<span class="k">function</span> <span class="nf">h</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">key1</span><span class="p">)</span> <span class="k">end</span>
<span class="n">h</span><span class="p">{</span><span class="n">key1</span> <span class="o">=</span> <span class="s1">'Sonmi~451'</span><span class="p">}</span>  <span class="c1">-- Affiche 'Sonmi~451'.</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="k">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">do</span>  <span class="c1">-- Parcours d'une table.</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">-- _G est une table spéciale contenant toutes les variables globales,</span>
<span class="c1">-- et donc elle même.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">_G</span><span class="p">[</span><span class="s1">'_G'</span><span class="p">]</span> <span class="o">==</span> <span class="n">_G</span><span class="p">)</span>  <span class="c1">-- Affiche 'true'.</span>

<span class="c1">-- Tables en tant que listes:</span>

<span class="c1">-- De manière implicite, les clés sont des nombres entiers:</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'value1'</span><span class="p">,</span> <span class="s1">'value2'</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">21</span><span class="p">,</span> <span class="s1">'gigawatts'</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">v</span> <span class="k">do</span>  <span class="c1">-- #v retourne la taille de la table v si elle est une liste.</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1">-- Attention, en Lua, les indices commencent à 1!</span>
<span class="k">end</span>
<span class="c1">-- Il n'existe pas vraiment de type 'liste' en Lua, v est juste</span>
<span class="c1">-- une table avec des clés qui sont des nombres entiers consécutifs</span>
<span class="c1">-- commençant à 1. Lua le traite comme étant une liste.</span>

<span class="c1">----------------------------------------------------</span>
<span class="c1">-- 3.1 Métatables and métaméthodes.</span>
<span class="c1">----------------------------------------------------</span>

<span class="c1">-- Une table peut avoir une métatable qui confère à la table</span>
<span class="c1">-- un patron/prototype de conception (surcharge d'opération). Nous verrons</span>
<span class="c1">-- dans la suite comment les métatables imitent le prototypage du JS.</span>

<span class="n">f1</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">}</span>  <span class="c1">-- Représente la fraction a/b.</span>
<span class="n">f2</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">}</span>

<span class="c1">-- Ceci créée une erreur:</span>
<span class="c1">-- s = f1 + f2</span>

<span class="n">metafraction</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">function</span> <span class="nc">metafraction</span><span class="p">.</span><span class="nf">__add</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">sum</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">sum</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">f1</span><span class="p">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">f2</span><span class="p">.</span><span class="n">b</span>
  <span class="n">sum</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">f1</span><span class="p">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">f2</span><span class="p">.</span><span class="n">b</span> <span class="o">+</span> <span class="n">f2</span><span class="p">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">f1</span><span class="p">.</span><span class="n">b</span>
  <span class="k">return</span> <span class="n">sum</span>
<span class="k">end</span>

<span class="nb">setmetatable</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">metafraction</span><span class="p">)</span>
<span class="nb">setmetatable</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">metafraction</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>  <span class="c1">-- appèle __add(f1, f2) de la métatable de f1</span>

<span class="c1">-- f1, f2 ne possèdent pas de clé qui pointent vers leur métatable, comme</span>
<span class="c1">-- avec les prototypes en JS. Mais l'on peut utiliser getmetatable(f1).</span>
<span class="c1">-- La métatable est une table normale avec des clés prédéfinies, comme __add.</span>

<span class="c1">-- Mais la ligne suivante génère une erreur puisque s n'a pas de métatable:</span>
<span class="c1">-- t = s + s</span>
<span class="c1">-- En implémentant de l'orienté objet, comme nous le verrons par la suite,</span>
<span class="c1">-- le problème est résolu.</span>

<span class="c1">-- Une clé __index dans une métatable mt surcharge l'indexation dans sa table t</span>
<span class="c1">-- si la clé est absente de cette table t:</span>
<span class="n">defaultFavs</span> <span class="o">=</span> <span class="p">{</span><span class="n">animal</span> <span class="o">=</span> <span class="s1">'gru'</span><span class="p">,</span> <span class="n">food</span> <span class="o">=</span> <span class="s1">'donuts'</span><span class="p">}</span>
<span class="n">myFavs</span> <span class="o">=</span> <span class="p">{</span><span class="n">food</span> <span class="o">=</span> <span class="s1">'pizza'</span><span class="p">}</span>
<span class="nb">setmetatable</span><span class="p">(</span><span class="n">myFavs</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span> <span class="o">=</span> <span class="n">defaultFavs</span><span class="p">})</span>
<span class="n">eatenBy</span> <span class="o">=</span> <span class="n">myFavs</span><span class="p">.</span><span class="n">animal</span>  <span class="c1">-- Affiche "gru"! merci à la métatable!</span>

<span class="c1">-- Ainsi donc, un accès direct à une valeur dans une table via une clé </span>
<span class="c1">-- inexistante (ce qui normalement retourne "nil") conduira à exploiter</span>
<span class="c1">-- le champ __index de la métatable. Cela peut être récursif.</span>

<span class="c1">-- Le champ __index peut aussi être une fonction (tbl, clé)</span>
<span class="c1">-- ce qui permet une gestion plus souple des indexations.</span>

<span class="c1">-- Les clés __index, __add,... sont appelées métaméthodes.</span>
<span class="c1">-- En voici la liste complète:</span>

<span class="c1">-- __add(a, b)                   pour a + b</span>
<span class="c1">-- __sub(a, b)                   pour a - b</span>
<span class="c1">-- __mul(a, b)                   pour a * b</span>
<span class="c1">-- __div(a, b)                   pour a / b</span>
<span class="c1">-- __mod(a, b)                   pour a % b</span>
<span class="c1">-- __pow(a, b)                   pour a ^ b</span>
<span class="c1">-- __unm(a)                      pour -a</span>
<span class="c1">-- __concat(a, b)                pour a .. b</span>
<span class="c1">-- __len(a)                      pour #a</span>
<span class="c1">-- __eq(a, b)                    pour a == b</span>
<span class="c1">-- __lt(a, b)                    pour a &lt; b</span>
<span class="c1">-- __le(a, b)                    pour a &lt;= b</span>
<span class="c1">-- __index(a, b)  &lt;fn ou table&gt;  pour a.b</span>
<span class="c1">-- __newindex(a, b, c)           pour a.b = c</span>
<span class="c1">-- __call(a, ...)                pour a(...)</span>

<span class="c1">----------------------------------------------------</span>
<span class="c1">-- 3.2 Pseudo-orienté objet et héritage.</span>
<span class="c1">----------------------------------------------------</span>

<span class="c1">-- Lua n'implémente pas d'orienté objet par défaut.</span>
<span class="c1">-- Mais il reste possible d'imiter de plusieurs manières </span>
<span class="c1">-- le concept de "classe" grâce aux tables et aux métatables.</span>

<span class="c1">-- L'explication pour l'exemple qui suit vient juste après.</span>

<span class="n">Dog</span> <span class="o">=</span> <span class="p">{}</span>                                   <span class="c1">-- 1.</span>

<span class="k">function</span> <span class="nf">Dog</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>                         <span class="c1">-- 2.</span>
  <span class="kd">local</span> <span class="n">newObj</span> <span class="o">=</span> <span class="p">{</span><span class="n">sound</span> <span class="o">=</span> <span class="s1">'woof'</span><span class="p">}</span>          <span class="c1">-- 3.</span>
  <span class="n">self</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">self</span>                      <span class="c1">-- 4.</span>
  <span class="k">return</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="n">newObj</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>        <span class="c1">-- 5.</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">Dog</span><span class="p">:</span><span class="n">makeSound</span><span class="p">()</span>                   <span class="c1">-- 6.</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">'Je dis: '</span> <span class="o">..</span> <span class="n">self</span><span class="p">.</span><span class="n">sound</span><span class="o">..</span><span class="s1">'!'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">mrDog</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>                          <span class="c1">-- 7.</span>
<span class="n">mrDog</span><span class="p">:</span><span class="n">makeSound</span><span class="p">()</span>  <span class="c1">-- 'Je dis: woof!       -- 8.</span>

<span class="c1">-- 1. Dog agit comme une classe; c'est une simple table.</span>
<span class="c1">-- 2. L'expression tbl:fn(...) est identique à </span>
<span class="c1">--    tbl.fn(self, ...)</span>
<span class="c1">--    La notation : permet de passer par défaut un premier </span>
<span class="c1">--    argument appelé "self" à la fonction tbl.fn</span>
<span class="c1">--    Voir 7 &amp; 8 ci-après pour comprendre comment self prend</span>
<span class="c1">--    sa valeur.</span>
<span class="c1">-- 3. newObj sera une instance de la classe Dog.</span>
<span class="c1">-- 4. self = la classe instanciée. Souvent, self = Dog, mais</span>
<span class="c1">--    cela peut changer du fait de l'héritage.</span>
<span class="c1">--    newObj reçoit les fonctions de self si l'__index des</span>
<span class="c1">--    métatables de newObj et de self pointent vers self.</span>
<span class="c1">-- 5. Rappel: setmetatable retourne son premier argument.</span>
<span class="c1">-- 6. La notation : fonctionne comme au 2, mais cette fois, self</span>
<span class="c1">--    est une instance au lieu d'être une classe.</span>
<span class="c1">-- 7. Similaire à Dog.new(Dog), donc self = Dog dans new().</span>
<span class="c1">-- 8. Similaire à mrDog.makeSound(mrDog); self = mrDog.</span>

<span class="c1">----------------------------------------------------</span>

<span class="c1">-- Exemple d'héritage:</span>

<span class="n">LoudDog</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>                           <span class="c1">-- 1.</span>

<span class="k">function</span> <span class="nf">LoudDog</span><span class="p">:</span><span class="n">makeSound</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sound</span> <span class="o">..</span> <span class="s1">' '</span>                 <span class="c1">-- 2.</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">s</span> <span class="o">..</span> <span class="n">s</span> <span class="o">..</span> <span class="n">s</span><span class="o">..</span><span class="s1">'!'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">seymour</span> <span class="o">=</span> <span class="n">LoudDog</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>                       <span class="c1">-- 3.</span>
<span class="n">seymour</span><span class="p">:</span><span class="n">makeSound</span><span class="p">()</span>  <span class="c1">-- 'woof woof woof!'     -- 4.</span>

<span class="c1">-- 1. LoudDog reçoit les méthodes et les variables de Dog.</span>
<span class="c1">-- 2. self possède une clé 'sound', reçue de new(), voir 3.</span>
<span class="c1">-- 3. Similaire à LoudDog.new(LoudDog) et traduit en Dog.new(LoudDog),</span>
<span class="c1">--    puisque LoudDog ne possède pas de clé 'new', mais a une métatable</span>
<span class="c1">--    qui a la clé __index = Dog.</span>
<span class="c1">--    Résulat: la métatable de seymour est LoudDog, et</span>
<span class="c1">--    LoudDog.__index = LoudDog. Donc seymour.key deviendra soit égal à</span>
<span class="c1">--    seymour.key, LoudDog.key, Dog.key, selon le fait qu'il s'agira</span>
<span class="c1">--    de la première table ayant la clé 'key' en question, en remontant</span>
<span class="c1">--    dans la hiérarchie.</span>
<span class="c1">-- 4. La clé 'makeSound' est trouvée dans LoudDog; cela est similaire</span>
<span class="c1">--    à LoudDog.makeSound(seymour).</span>

<span class="c1">-- Si besoin est, la méthode new() de la sous-classe est</span>
<span class="c1">-- identique à la méthode new() de sa classe mère:</span>
<span class="k">function</span> <span class="nf">LoudDog</span><span class="p">:</span><span class="n">new</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">newObj</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="c1">-- Prépare self à être la superclasse de newObj:</span>
  <span class="n">self</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">self</span>
  <span class="k">return</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="n">newObj</span><span class="p">,</span> <span class="n">self</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">----------------------------------------------------</span>
<span class="c1">-- 4. Modules.</span>
<span class="c1">----------------------------------------------------</span>


<span class="c1">--[[ Cette section est mise en commentaire afin que le reste du</span>
<span class="c1">--   ce script reste exécutable.</span>
</code></pre></div><div class="highlight"><pre class="highlight lua"><code><span class="c1">-- Supposons que le fichier mod.lua contienne ceci:</span>
<span class="kd">local</span> <span class="n">M</span> <span class="o">=</span> <span class="p">{}</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">sayMyName</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">'Hrunkner'</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">M</span><span class="p">.</span><span class="nf">sayHello</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>
  <span class="n">sayMyName</span><span class="p">()</span>
<span class="k">end</span>

<span class="k">return</span> <span class="n">M</span>

<span class="c1">--  Un autre fichier peut exploiter le contenu défini dans mod.lua's:</span>
<span class="kd">local</span> <span class="n">mod</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'mod'</span><span class="p">)</span>  <span class="c1">-- Exécute le fichier mod.lua.</span>

<span class="c1">-- require est le moyen par défaut d'inclure des modules.</span>
<span class="c1">-- require agit comme:     (si non trouvé en cache; voir ci-après)</span>
<span class="kd">local</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="k">function</span> <span class="p">()</span>
  <span class="o">&lt;</span><span class="n">contenu</span> <span class="n">de</span> <span class="n">mod</span><span class="p">.</span><span class="n">lua</span><span class="o">&gt;</span>
<span class="k">end</span><span class="p">)()</span>
<span class="c1">-- Comme si le contenu de mod.lua était enveloppé dans le corps d'une fonction,</span>
<span class="c1">-- si bien que les variables locales contenues dans mod.lua sont </span>
<span class="c1">-- inaccessibles en dehors de ce module.</span>

<span class="c1">-- Le code suivant fonctionne car mod = M (dans mod.lua):</span>
<span class="n">mod</span><span class="p">.</span><span class="n">sayHello</span><span class="p">()</span>  <span class="c1">-- Dis bonjour à Hrunkner.</span>

<span class="c1">-- Le code suivant génère une erreur car sayMyName est local à mod.lua:</span>
<span class="n">mod</span><span class="p">.</span><span class="n">sayMyName</span><span class="p">()</span>  <span class="c1">-- erreur!</span>

<span class="c1">-- Les valeurs retournées par require sont mises en cache, ce qui fait</span>
<span class="c1">-- qu'un module est toujours chargé une seule fois, même s'il est inclus</span>
<span class="c1">-- avec require à plusieurs reprises.</span>

<span class="c1">-- Supposons que mod2.lua contienne le code "print('Hi!')".</span>
<span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'mod2'</span><span class="p">)</span>  <span class="c1">-- Affiche "Hi!"</span>
<span class="kd">local</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">'mod2'</span><span class="p">)</span>  <span class="c1">-- N'affiche rien; et a = b.</span>

<span class="c1">-- dofile est identique à require, sauf qu'il ne fait pas de mise en cache:</span>
<span class="nb">dofile</span><span class="p">(</span><span class="s1">'mod2'</span><span class="p">)</span>  <span class="c1">--&gt; Hi!</span>
<span class="nb">dofile</span><span class="p">(</span><span class="s1">'mod2'</span><span class="p">)</span>  <span class="c1">--&gt; Hi! (le code de mod2.lua est encore exécuté)</span>

<span class="c1">-- loadfile charge le contenu d'un fichier, sans l'exécuter.</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">loadfile</span><span class="p">(</span><span class="s1">'mod2'</span><span class="p">)</span>  <span class="c1">-- L'appel f() exécute le contenu de mod2.lua.</span>

<span class="c1">-- loadstring est similaire à loadfile, mais pour les chaines de caractères.</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">loadstring</span><span class="p">(</span><span class="s1">'print(343)'</span><span class="p">)</span>  <span class="c1">-- Retourne une fonction.</span>
<span class="n">g</span><span class="p">()</span>  <span class="c1">-- Affiche 343; Rien n'est affiché avant cet appel.</span>

<span class="c1">--]]</span>
</code></pre></div>
<h2>Références</h2>

<p><em>Les références qui suivent sont en Anglais.</em></p>

<p>Les sujets non abordés dans ce tutoriel sont couverts en intégralité par 
les librairies standard:</p>

<ul>
<li>La librairie <a href="http://lua-users.org/wiki/StringLibraryTutorial">string</a></li>
<li>La librairie <a href="http://lua-users.org/wiki/TableLibraryTutorial">table</a></li>
<li>La librairie <a href="http://lua-users.org/wiki/MathLibraryTutorial">math</a></li>
<li>La librairie <a href="http://lua-users.org/wiki/IoLibraryTutorial">io</a></li>
<li>La librairie <a href="http://lua-users.org/wiki/OsLibraryTutorial">os</a></li>
</ul>

<p>Autres références complémentaires:</p>

<ul>
<li><a href="http://nova-fusion.com/2012/08/27/lua-for-programmers-part-1/">Lua pour programmeurs</a></li>
<li><a href="lua-users.org/files/wiki_insecure/users/thomasl/luarefv51.pdf">Référence condensée de Lua</a></li>
<li><a href="http://www.lua.org/pil/contents.html">Programmer en Lua</a></li>
<li><a href="http://www.lua.org/manual/">Les manuels de référence Lua</a></li>
</ul>

<p>A propos, ce fichier est exécutable. Sauvegardez-le sous le nom <em>learn.lua</em> et
exécutez-le avec la commande <code>lua learn.lua</code> !</p>

<p>Ce tutoriel a été originalement écrit pour <a href="tylerneylon.com">tylerneylon.com</a> et est aussi 
disponible en tant que <a href="https://gist.github.com/tylerneylon/5853042">gist</a>.
Il a été traduit en français par Roland Yonaba (voir son <a href="http://github.com/Yonaba">github</a>).</p>

<p>Amusez-vous bien avec Lua!</p>

    <hr>
    <p>Vous avez une suggestion ? Peut-être une correction ? <a href="https://github.com/adambard/learnxinyminutes-docs/issues/new">Ouvrez un ticket</a> sur Github, ou faites vous-même une <a href="https://github.com/adambard/learnxinyminutes-docs/edit/master/fr-fr/lua-fr.html.markdown">pull request</a> !
    </p>
    <p class="contributed">
    Version originale par Tyler Neylon, mis à jour par <a href="https://github.com/adambard/learnxinyminutes-docs/blame/master/fr-fr/lua-fr.html.markdown">3 contributeur(s)</a>.
    </p>

    <footer>
    <a style="float: left" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
    <p>
    &copy; 2024
        <a href="http://tylerneylon.com/">Tyler Neylon</a>
    </p>

    <p>
      Translated by:
        <a href="http://github.com/Yonaba">Roland Yonaba</a>

    </footer>
  </div>

        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="/js/script.js"></script>
    </body>
</html>
