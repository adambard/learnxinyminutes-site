<!DOCTYPE html lang="en-us" xml:lang="en-us" xmlns="http://www.w3.org/1999/xhtml">
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta http-equiv="Content-Language" content="en-us">
        <!-- Use title if it's in the page YAML frontmatter -->
        <title>Learn M (MUMPS) in Y Minutes</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="/css/index.css">

        <link rel="canonical" href="https://learnxinyminutes.com/docs/m/">
        <script>
            var THEME_KEY = "lxiym_theme";
            function set_theme(theme) {
                var el = document.getElementsByTagName("html")[0];
                if (!el) {
                  return;
                }

                if (theme === "dark" ) {
                    el.className = "dark";
                } else {
                    el.className = "light";
                }

                localStorage.setItem(THEME_KEY, theme);
            }

            function load_theme() {
              var theme = localStorage.getItem(THEME_KEY);
              if (theme) {
                set_theme(theme);
              }
            }

            // Attempt immediate application of html style
            load_theme();

            // Backup: do it onload. Will flash, but better than nothing.
            window.addEventListener("load", function(){
              load_theme();
            });
        </script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <div class="container">
            <div class="share">
    <span class="sharemsg">
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flearnxinyminutes.com%2Fdocs%2Fm%2F&text=Learn+X+in+Y+minutes%2C+where+X%3DM+%28MUMPS%29">
        Share this page
      </a></span>

      <span class='st_facebook_large' displayText='Facebook'></span>
      <span class='st_twitter_large' displayText='Tweet'></span>
  </div>
  <div class="theme-choice">
    <label id="theme-label">Select theme:</label>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('light');">light</button>
    <button type="button" aria-labelledby="theme-label" onclick="set_theme('dark');">dark</button>
  </div>
  <h1><a href="/">Learn X in Y minutes</a></h1>
  <h2>Where X=M (MUMPS)</h2>
    <p class="filelink">
    Get the code:
    <a href="/docs/files/LEARNM.m">LEARNM.m</a>
    </p>
  <div id="doc">
    <p>M, or MUMPS (Massachusetts General Hospital Utility Multi-Programming System) is
a procedural language with a built-in NoSQL database. Or, itâ€™s a database with
an integrated language optimized for accessing and manipulating that database.
A key feature of M is that accessing local variables in memory and persistent
storage use the same basic syntax, so there&rsquo;s no separate query
language to remember. This makes it fast to program with, especially for
beginners. M&rsquo;s syntax was designed to be concise in an era where
computer memory was expensive and limited. This concise style means that a lot
more fits on one screen without scrolling.</p>

<p>The M database is a hierarchical key-value store designed for high-throughput
transaction processing. The database is organized into tree structures called
&ldquo;globals&rdquo;, (for global variables) which are sparse data structures with parallels
to modern formats like JSON.</p>

<p>Originally designed in 1966 for the healthcare applications, M continues to be
used widely by healthcare systems and financial institutions for high-throughput
real-time applications. </p>

<h3>Example</h3>

<p>Here&rsquo;s an example M program using expanded syntax to calculate the Fibonacci series:</p>
<div class="highlight"><pre class="highlight plaintext"><code>fib ; compute the first few Fibonacci terms
    new i,a,b,sum
    set (a,b)=1 ; Initial conditions
    for i=1:1 do  quit:sum&gt;1000
    . set sum=a+b
    . write !,sum
    . set a=b,b=sum
</code></pre></div>
<h3>Comments</h3>

<p>Comments in M need at least one space before the comment marker of semicolon.
Comments that start with at least two semicolons (;;) are guaranteed to be accessible
within a running program.</p>
<div class="highlight"><pre class="highlight plaintext"><code> ;   Comments start with a semicolon (;)
</code></pre></div>
<h3>Data Types</h3>

<p>M has one data type (String) and three interpretations of that string.:</p>
<div class="highlight"><pre class="highlight plaintext"><code>;   Strings - Characters enclosed in double quotes.
;       "" is the null string. Use "" within a string for "
;       Examples: "hello", "Scrooge said, ""Bah, Humbug!"""
;
;   Numbers - no commas, leading and trailing 0 removed.
;       Scientific notation with 'E'.  (not 'e')
;       Numbers with at least with IEEE 754 double-precision values (guaranteed 15 digits of precision)
;       Examples: 20 (stored as 20) , 1e3 (stored as 1000), 0500.20 (stored as 500.2),
;                 the US National Debt AT sometime on 12-OCT-2020 retrieved from http://www.usdebt.org is 27041423576201.15)
;                     (required to be stored as at least 27041422576201.10 but most implementations store as 27041432576201.15)
;
;   Truthvalues - String interpreted as 0  is used for false and any string interpreted as non-zero (such as 1) for true.
</code></pre></div>
<h3>Commands</h3>

<p>Commands are case insensitive, and have full form, and a shortened abbreviation, often the first letter. Commands have zero or more arguments,depending on the command. This page includes programs written in this terse syntax. M is whitespace-aware. Spaces are treated as a delimiter between commands and arguments. Each command is separated from its arguments by 1 space. Commands with zero arguments are followed by 2 spaces. (technically these are called argumentless commands)</p>

<h4>Common Commands from all National and International Standards of M</h4>

<h4>Write (abbreviated as W)</h4>

<p>Print data to the current device.</p>
<div class="highlight"><pre class="highlight plaintext"><code>WRITE !,"hello world" 
</code></pre></div>
<p>Output Formatting characters:</p>

<p>The ! character is syntax for a new line.
 The # character is syntax for a new page.
 The sequence of the ? character and then a numeric expression is syntax for output of spaces until the number&#39;th colum is printed.</p>

<p>Multiple statements can be provided as additional arguments before the space separators to the next command:</p>
<div class="highlight"><pre class="highlight plaintext"><code>w !,"foo bar"," ","baz" 
</code></pre></div>
<h4>Read (abbreviated as R)</h4>

<p>Retrieve input from the user</p>
<div class="highlight"><pre class="highlight plaintext"><code>READ var
r !,"Wherefore art thou Romeo? ",why
</code></pre></div>
<p>As with all M commands, multiple arguments can be passed to a read command. Constants like quoted strings, numbers, and formatting characters are output directly. Values for both global variables and local variables are retrieved from the user. The terminal waits for the user to enter the first variable before displaying the second prompt.</p>
<div class="highlight"><pre class="highlight plaintext"><code>r !,"Better one, or two? ",lorem," Better two, or three? ",ipsum
</code></pre></div>
<h4>Set (abbreviated as S)</h4>

<p>Assign a value to a variable</p>
<div class="highlight"><pre class="highlight plaintext"><code>SET name="Benjamin Franklin"
s centi=0.01,micro=10E-6
w !,centi,!,micro

;.01
;.00001
</code></pre></div>
<h4>Kill (abbreviated as K)</h4>

<p>Remove a variable from memory or remove a database entry from disk.
A database node (global variable) is killed depending on the variable name being prefixed by the caret character (^).
If it is not, then the local variable is removed from memory. 
If KILLed, automatic garbage collection occurs.
<code>
KILL centi
k micro
</code></p>

<h3>Globals and Arrays</h3>

<p>In addition to local variables, M has persistent, shared variables that are the built-in database of M.  They are stored to disk and called <em>globals</em>. Global names must start with a <strong>caret</strong> (<strong>^</strong>). </p>

<p>Any variable (local or global) can be an array with the assignment of a <em>subscript</em>. Arrays are sparse and do not have a predefined size. Only if data is stored will a value use memory. Arrays should be visualized like trees, where subscripts are branches and assigned values are leaves. Not all nodes in an array need to have a value. </p>
<div class="highlight"><pre class="highlight plaintext"><code>s ^cars=20
s ^cars("Tesla",1,"Name")="Model 3"
s ^cars("Tesla",2,"Name")="Model X"
s ^cars("Tesla",2,"Doors")=5

w !,^cars 
; 20
w !,^cars("Tesla")
; null value - there's no value assigned to this node but it has children
w !,^cars("Tesla",1,"Name")
; Model 3
</code></pre></div>
<p>The index values of Arrays are automatically sorted in order. There is a catchphrase of &ldquo;MUMPS means never having to say you are sorting&rdquo;. Take advantage of the built-in sorting by setting your value of interest as the last child subscript of an array rather than its value, and then storing an empty string for that node.</p>
<div class="highlight"><pre class="highlight plaintext"><code>; A log of temperatures by date and time
s ^TEMPS("11/12","0600",32)=""
s ^TEMPS("11/12","1030",48)=""
s ^TEMPS("11/12","1400",49)=""
s ^TEMPS("11/12","1700",43)=""
</code></pre></div>
<h3>Operators</h3>
<div class="highlight"><pre class="highlight jinja"><code>; Assignment:       =
; Unary:            +   Convert a string value into a numeric value.
; Arthmetic:
;                   +   addition
Â­;                   -   subtraction
;                   *   multiplication
;                   /   floating-point division
;                   \   integer division
;                   #   modulo
;                   **  exponentiation
; Logical:  
;                   <span class="err">&amp;</span>   and
;                   !   or
;                   '   not
; Comparison:
;                   =   equal 
;                   '=  not equal
;                   &gt;   greater than
;                   <span class="nt">&lt;</span>   <span class="nt">less</span> <span class="na">than</span>
<span class="err">;</span>                   <span class="err">'</span><span class="nt">&gt;</span>  not greater / less than or equal to
;                   '<span class="nt">&lt;</span>  <span class="nt">not</span> <span class="na">less</span> <span class="err">/</span> <span class="na">greater</span> <span class="na">than</span> <span class="na">or</span> <span class="na">equal</span> <span class="na">to</span>
<span class="err">;</span> <span class="na">String</span> <span class="na">operators:</span>
<span class="err">;</span>                   <span class="na">_</span>   <span class="na">concatenate</span>
<span class="err">;</span>                   <span class="err">[</span>   <span class="na">contains</span> <span class="err">Â­</span>          <span class="na">a</span> <span class="na">contains</span> <span class="na">b</span> 
<span class="err">;</span>                   <span class="err">]]</span>  <span class="na">sorts</span> <span class="na">after</span>  <span class="err">Â­</span>      <span class="na">a</span> <span class="na">comes</span> <span class="na">after</span> <span class="na">b</span>
<span class="err">;</span>                   <span class="err">'[</span>  <span class="na">does</span> <span class="na">not</span> <span class="na">contain</span>
<span class="err">;</span>                   <span class="err">']]</span> <span class="na">does</span> <span class="na">not</span> <span class="na">sort</span> <span class="na">after</span>
</code></pre></div>
<h4>Order of operations</h4>

<p>Operations in M are <em>strictly</em> evaluated left to right. No operator has precedence over any other.
For example, there is NO order of operations where multiply is evaluated before addition.
To change this order, just use parentheses to group expressions to be evaluated first.</p>
<div class="highlight"><pre class="highlight plaintext"><code>w 5+3*20
;160
;You probably wanted 65
write 5+(3*20) 
</code></pre></div>
<h3>Flow Control, Blocks, &amp; Code Structure</h3>

<p>A single M file is called a <em>routine</em>. Within a given routine, you can break your code up into smaller chunks with <em>tags</em>. The tag starts in column 1 and the commands pertaining to that tag are indented.</p>

<p>A tag can accept parameters and return a value, this is a function. A function is called with &lsquo;$$&rsquo;:</p>
<div class="highlight"><pre class="highlight plaintext"><code>; Execute the 'tag' function, which has two parameters, and write the result.
w !,$$tag^routine(a,b) 
</code></pre></div>
<p>M has an execution stack. When all levels of the stack have returned, the program ends. Levels are added to the stack with <em>do</em> commands and removed with <em>quit</em> commands.</p>

<h4>Do (abbreviated as D)</h4>

<p>With an argument: execute a block of code &amp; add a level to the stack. </p>
<div class="highlight"><pre class="highlight plaintext"><code>d ^routine    ;run a routine from the beginning. 
;             ;routines are identified by a caret.
d tag         ;run a tag in the current routine
d tag^routine ;run a tag in different routine
</code></pre></div>
<p>Argumentless do: used to create blocks of code. The block is indented with a period for each level of the block:</p>
<div class="highlight"><pre class="highlight plaintext"><code>set a=1
if a=1 do  
. write !,a
. read b
. if b &gt; 10 d
. . w !, b 
w "hello"
</code></pre></div>
<h4>Quit (abbreviated as Q)</h4>

<p>Stop executing this block and return to the previous stack level.
Quit can return a value, following the comamnd with a single space.
Quit can stop a loop. remember to follow with two spaces.
Quit outside a loop will return from the current subroutine followed by two spaces or a linefeed</p>

<h4>New (abbreviated as N)</h4>

<p>Hide with a cleared value a given variable&rsquo;s value <em>for just this stack level</em>. Useful for preventing side effects.</p>

<p>Putting all this together, we can create a full example of an M routine:</p>
<div class="highlight"><pre class="highlight plaintext"><code>; RECTANGLE - a routine to deal with rectangle math
    q ; quit if a specific tag is not called

main 
    n length,width ; New length and width so any previous value doesn't persist
    w !,"Welcome to RECTANGLE. Enter the dimensions of your rectangle."
    r !,"Length? ",length,!,"Width? ",width
    d area(length,width)            ;Do/Call subroutine using a tag
    s per=$$perimeter(length,width)      ;Get the value of a function
    w !,"Perimeter: ",per
    quit

area(length,width)  ; This is a tag that accepts parameters. 
                    ; It's not a function since it quits with no value.
    w !, "Area: ",length*width
    q  ; Quit: return to the previous level of the stack.

perimeter(length,width)
    q 2*(length+width) ; Returns a value using Quit ; this is a function
</code></pre></div>
<h3>Conditionals, Looping and $Order()</h3>

<p>F(or) loops can follow a few different patterns:</p>
<div class="highlight"><pre class="highlight jinja"><code>;Finite loop with counter
;f var=start:increment:stop

f i=0:5:25 w i," "
;0 5 10 15 20 25 

; Infinite loop with counter
; The counter will keep incrementing forever. Use a conditional with Quit to get out of the loop.
;f var=start:increment 

f j=1:1 w j," " i j&gt;1E3 q
; Print 1-1000 separated by a space

;Argumentless for - infinite loop. Use a conditional with Quit.
;   Also read as "forever" - f or for followed by two spaces.
s var=""
f  s var=var_"%" w !,var i var="%%%%%%%%%%" q  
; %
; %%
; %%%
; %%%%
; %%%%%
; %%%%%%
; %%%%%%%
; %%%%%%%%
; %%%%%%%%%
; %%%%%%%%%%

</code></pre></div>
<h4>I(f), E(lse), Postconditionals</h4>

<p>M has an if/else construct for conditional evaluation, but any command can be conditionally executed without an extra if statement using a <em>postconditional</em>. This is a condition that occurs immediately after the command, separated with a colon (:).</p>
<div class="highlight"><pre class="highlight jinja"><code>; Conditional using traditional if/else
r "Enter a number: ",num
i num&gt;100 w !,"huge"
e i num&gt;10 w !,"big"
e w !,"small"

; Postconditionals are especially useful in a for loop.
; This is the dominant for loop construct:
;   a 'for' statement
;   that tests for a 'quit' condition with a postconditional
;   then 'do'es an indented block for each iteration

s var=""
f  s var=var_"%" q:var="%%%%%%%%%%" d  ;Read as "Quit if var equals "%%%%%%%%%%"
. w !,var

;Bonus points - the $L(ength) built-in function makes this even terser

s var=""
f  s var=var_"%" q:$L(var)&gt;10  d  ;
. w !,var

</code></pre></div>
<h4>Array Looping - $Order</h4>

<p>As we saw in the previous example, M has built-in functions called with a single $, compared to user-defined functions called with $$. These functions have shortened abbreviations, like commands.
One of the most useful is <strong>$Order()</strong> / $O(). When given an array subscript, $O returns the next subscript in that array. When it reaches the last subscript, it returns &ldquo;&rdquo;.</p>
<div class="highlight"><pre class="highlight jinja"><code>;Let's call back to our ^TEMPS global from earlier:
; A log of temperatures by date and time
s ^TEMPS("11/12","0600",32)=""
s ^TEMPS("11/12","0600",48)=""
s ^TEMPS("11/12","1400",49)=""
s ^TEMPS("11/12","1700",43)=""
; Some more
s ^TEMPS("11/16","0300",27)=""
s ^TEMPS("11/16","1130",32)=""
s ^TEMPS("11/16","1300",47)=""

;Here's a loop to print out all the dates we have temperatures for:
n date,time ; Initialize these variables with ""

; This line reads: forever; set date as the next date in ^TEMPS.
; If date was set to "", it means we're at the end, so quit.
; Do the block below
f  s date=$ORDER(^TEMPS(date)) q:date="" d
. w !,date

; Add in times too:
f  s date=$ORDER(^TEMPS(date)) q:date=""  d
. w !,"Date: ",date
. f  s time=$O(^TEMPS(date,time)) q:time=""  d
. . w !,"Time: ",time

; Build an index that sorts first by temperature - 
; what dates and times had a given temperature?
n date,time,temp
f  s date=$ORDER(^TEMPS(date)) q:date=""  d
. f  s time=$O(^TEMPS(date,time)) q:time=""  d
. . f  s temp=$O(^TEMPS(date,time,temp)) q:temp=""  d
. . . s ^TEMPINDEX(temp,date,time)=""

;This will produce a global like
^TEMPINDEX(27,"11/16","0300")
^TEMPINDEX(32,"11/12","0600")
^TEMPINDEX(32,"11/16","1130")
</code></pre></div>
<h2>Further Reading</h2>

<p>There&rsquo;s lots more to learn about M. A great short tutorial comes from the University of Northern Iowa and  Professor Kevin O&#39;Kane&rsquo;s <a href="https://www.cs.uni.edu/~okane/source/MUMPS-MDH/MumpsTutorial.pdf">Introduction to the MUMPS Language</a> presentation.  More about M using VistA is at </p>

<p>Intersystems has some products which are a super-set of the M programming language.
* <a href="https://www.intersystems.com/products/intersystems-iris/">Iris Description Page</a>
* <a href="https://en.wikipedia.org/wiki/InterSystems_CachÃ©">Cache Description Page</a></p>

<p>To install an M interpreter / database on your computer, try a <a href="https://yottadb.com/product/get-started/">YottaDB Docker image</a>. </p>

<p>YottaDB and its precursor, GT.M, have thorough documentation on all the language features including database transactions, locking, and replication:</p>

<ul>
<li><a href="https://docs.yottadb.com/ProgrammersGuide/langfeat.html">YottaDB Programmer&rsquo;s Guide</a></li>
<li><a href="http://tinco.pair.com/bhaskar/gtm/doc/books/pg/UNIX_manual/index.html">GT.M Programmer&rsquo;s Guide</a></li>
</ul>

    <hr>
    <p>Got a suggestion? A correction, perhaps? <a href="https://github.com/adambard/learnxinyminutes-docs/issues/new">Open an Issue</a> on the Github Repo, or make a <a href="https://github.com/adambard/learnxinyminutes-docs/edit/master/m.html.markdown">pull request</a> yourself!
    </p>
    <p class="contributed">
    Originally contributed by Fred Turkington, and updated by <a href="https://github.com/adambard/learnxinyminutes-docs/blame/master/m.html.markdown">0 contributor(s)</a>.
    </p>

    <footer>
    <a style="float: left" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a>
    <p>
    &copy; 2024
        <a href="http://z3ugma.github.io">Fred Turkington</a>
    </p>

    <p>

    </footer>
  </div>

        </div>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="/js/script.js"></script>

        <script>
            var _gaq=[['_setAccount','UA-3525624-21'],['_trackPageview']];
            (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
            s.parentNode.insertBefore(g,s)}(document,'script'));
        </script>
    </body>
</html>
