<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WXC8R75DEN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WXC8R75DEN');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Language" content="en">
    <title>Learn Vim9Script in Y Minutes</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto+Slab:wght@100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/screen.css">
    <link rel="stylesheet" href="/css/light.css">
    <link rel="stylesheet" href="/css/dark.css">

    <link rel="canonical" href="https://learnxinyminutes.com/vim9script/">
    <script>
      localStorage.removeItem("lxiym_theme");
    </script>
  </head>
  <body>
    <div class="container">
      <div class="share">
        <span class="sharemsg">
          <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flearnxinyminutes.com%2Fvim9script%2F&amp;text=Learn+X+in+Y+minutes%2C+where+X%3DVim9Script">
            Share this page
          </a>
        </span>
        <span class='st_facebook_large' displayText='Facebook'></span>
        <span class='st_twitter_large' displayText='Tweet'></span>
      </div>
      <h1><a href="/">Learn X in Y minutes</a></h1>
      <h2>Where X=Vim9Script</h2>
      <p class="filelink">
        Get the code:
        <a href="/files/learnvim9script.vim">learnvim9script.vim</a>
      </p>
      <div id="doc">
<p>Vim9script is a modernized, TypeScript-like language to script the Vim text editor.
(See however <a href="https://github.com/yegappan/Vim9ScriptForPythonDevelopers">Yegappan's Vim9 for Python Developers</a>).</p>
<p>It improves on its predecessor, legacy Vimscript, also called VimL, which is a sequence of Ex commands enhanced with scripting constructs like variables, functions, and control flow.
(Ex commands, such as <code>:echo</code>, <code>:write</code>, <code>:substitute</code>, <code>:quit</code>, ... are commands that are part of the legacy Ex editor to execute a single action, one-liners without return values.)
Legacy Vimscript is interpreted line by line, requiring backslashes to continue lines, and commands like <code>let</code> and <code>call</code> are used to make them resemble ex-commands.</p>
<p>In contrast, Vim9script supports multi-line syntax natively, without needing line continuation.
This makes it less suited for command-line usage, unlike traditional ex-commands, so that Vim9Script complements these for scripting.</p>
<p>Vim9Script enforces stricter syntax, improves performance, and supports modern programming features such as strong typing, classes, lambdas, and modules.
Differences (see <a href="https://vimhelp.org/vim9.txt.html#vim9-differences">https://vimhelp.org/vim9.txt.html#vim9-differences</a>) include:</p>
<ol>
<li>
<p>New syntax basics</p>
<ul>
<li>Comments start with <code>#</code> instead of <code>&quot;</code>.</li>
<li>Line-continuation backslashes are rarely needed --- just concatenate with <code>..</code>.</li>
<li>Whitespace is significant in many places to keep things readable.</li>
</ul>
</li>
<li>
<p>Variables and constants</p>
<ul>
<li>Declare regular variables with <code>:var</code>, e.g. <code>var count = 0</code></li>
<li>Change them with standard operators (<code>count += 3</code>) --- no more <code>:let</code>.</li>
<li>Declare immutable names with <code>:const</code> or <code>:final</code>.</li>
</ul>
</li>
<li>
<p>Typed, script-local functions</p>
<ul>
<li>All functions (and variables) are script-local by default.</li>
<li>Use <code>:def</code> with typed params and a return type, e.g.
<code>def foo(x: number, y: string): bool</code></li>
<li>Call them like normal functions (no <code>:call</code>).</li>
</ul>
</li>
</ol>
<p>All Ex commands can still be used inside functions and, vice-versa, you can call a function by an Ex command with <code>:vim9</code> (respectively <code>:call</code> in legacy vimscript) on the command line.
You can also define your own commands that call functions.</p>
<p>Try <a href="https://github.com/ubaldot/vim9-conversion-aid">vim9-conversion-aid</a> as a starting point to convert legacy Vimscript to Vim9Script.</p>
<div class="highlight"><pre lang="vim">vim9script

# The vim9script namespace<span class="p">,</span> <span class="k">above</span><span class="p">,</span> <span class="k">is</span> required <span class="k">to</span> distinguish <span class="k">a</span> Vim9 <span class="k">script</span>
# *.<span class="k">vim</span> <span class="k">file</span> from <span class="k">a</span> legacy vimscript <span class="k">file</span>.  In Vim&#39;s command<span class="p">-</span>line <span class="k">mode</span><span class="p">,</span>
# or <span class="k">in</span> <span class="k">a</span> legacy <span class="k">script</span><span class="p">,</span> using the command `:vim9cmd` <span class="p">(</span>or just `:vim9`<span class="p">)</span> before
# <span class="k">a</span> command also evaluates and executes code <span class="k">as</span> Vim9 <span class="k">script</span>.

# See https:<span class="sr">//</span>vimhelp.org/vim9.txt.html#vim9<span class="p">-</span>mix <span class="k">for</span> mixing these.

# There <span class="k">is</span> no distinction between single and multi<span class="p">-</span>line <span class="nb">comments</span>.
# Use # inside <span class="k">a</span> line at any position <span class="k">to</span> comment out <span class="k">all</span> following characters.

# You can run this Vim9 <span class="k">script</span> directly <span class="k">in</span> Vim.  After pasting the content
# into <span class="k">a</span> Vim buffer<span class="p">,</span> enter the command `<span class="k">so</span>` <span class="k">in</span> command<span class="p">-</span>line <span class="k">mode</span> <span class="p">(</span>press `:`
# <span class="k">first</span> <span class="k">to</span> enter command<span class="p">-</span>line <span class="k">mode</span><span class="p">)</span>.

##################################################################
## <span class="m">1</span>. Primitive types<span class="p">,</span> collection types<span class="p">,</span> operators<span class="p">,</span> and regex
##################################################################

# The builtin <span class="k">function</span> typename<span class="p">()</span> may be used <span class="k">to</span> reveal the type.
# Primitive data types are <span class="k">number</span> <span class="p">(</span>integer<span class="p">),</span> float<span class="p">,</span> and bool<span class="p">(</span>ean<span class="p">)</span>
echo typename<span class="p">(</span><span class="m">1</span><span class="p">)</span>  # <span class="k">number</span>
echo typename<span class="p">(</span><span class="m">1</span>.<span class="m">1</span><span class="p">)</span>  # float
echo typename<span class="p">(</span>true<span class="p">)</span>  # bool

# Collection data types are string<span class="p">,</span> blob<span class="p">,</span> <span class="nb">list</span><span class="p">,</span> tuple<span class="p">,</span> and <span class="nb">dict</span><span class="p">(</span>ionary<span class="p">)</span>
echo typename<span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>  # string
# Blob <span class="k">is</span> <span class="k">a</span> <span class="nb">binary</span> object
echo typename<span class="p">(</span><span class="m">0</span>zFE<span class="m">0</span>F<span class="p">)</span>  # blob
echo typename<span class="p">(</span>[<span class="m">1</span><span class="p">,</span> <span class="m">2</span>]<span class="p">)</span>  # <span class="nb">list</span><span class="p">&lt;</span><span class="k">number</span><span class="p">&gt;</span>
# echo typename<span class="p">((</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span>  # tuple <span class="p">(</span>Yet commented <span class="k">as</span> it&#39;s <span class="k">a</span> recent addition<span class="p">)</span>
echo typename<span class="p">(</span>{<span class="m">1</span>: <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="m">2</span>: <span class="s1">&#39;two&#39;</span>}<span class="p">)</span>  # <span class="nb">dict</span><span class="p">&lt;</span>string<span class="p">&gt;</span>

# Arithmetic with the <span class="k">number</span> <span class="p">(</span>integer<span class="p">)</span> type.
echo <span class="m">1</span> <span class="p">+</span> <span class="m">1</span>  # <span class="m">2</span>
echo <span class="m">2</span> <span class="p">-</span> <span class="m">1</span>  # <span class="m">1</span>
echo <span class="m">3</span> * <span class="m">2</span>  # <span class="m">6</span>
echo <span class="m">8</span> / <span class="m">2</span>  # <span class="m">4</span>
# If the result <span class="k">is</span> not an integer<span class="p">,</span> the remainder <span class="k">is</span> not returned.
echo <span class="m">9</span> / <span class="m">2</span>  # <span class="m">4</span>
# But modulo returns the remainder.
echo <span class="m">9</span> % <span class="m">2</span>  # <span class="m">1</span>

# Similarly<span class="p">,</span> <span class="k">for</span> the float type.
echo <span class="m">3</span>.<span class="m">14</span> <span class="p">+</span> <span class="m">0</span>.<span class="m">0015</span>  # <span class="m">3</span>.<span class="m">1415</span>
echo <span class="m">3</span>.<span class="m">0</span> * <span class="m">2</span>.<span class="m">0</span>  # <span class="m">6</span>.<span class="m">0</span>
# An integer and float will <span class="k">return</span> <span class="k">a</span> float.
echo <span class="m">9</span> / <span class="m">2</span>.<span class="m">0</span>  # <span class="m">4</span>.<span class="m">5</span>

# Logical OR <span class="p">(||),</span> AND <span class="p">(</span>&amp;&amp;<span class="p">),</span> and NOT <span class="p">(!)</span>.
echo true <span class="p">||</span> false  # true
echo true &amp;&amp; false  # false
echo <span class="p">!</span>true  # false

# Equality <span class="p">(==)</span> and inequality <span class="p">(!=)</span> work <span class="k">on</span> <span class="k">all</span> three primitive types and
# comparisons <span class="p">(&gt;,</span> <span class="p">&gt;=,</span> <span class="p">&lt;=,</span> and <span class="p">&lt;)</span> <span class="k">on</span> numbers and floats.
echo [<span class="m">1</span><span class="p">,</span> <span class="m">2</span>] <span class="p">==</span> [<span class="m">1</span><span class="p">,</span> <span class="m">2</span>]  # true
echo <span class="s1">&#39;apples&#39;</span> <span class="p">!=</span> <span class="s1">&#39;pears&#39;</span>  # true
echo <span class="m">9</span> <span class="p">&gt;</span> <span class="m">8</span>  # true
echo <span class="m">8</span> <span class="p">&gt;=</span> <span class="m">8</span>  # true
echo <span class="m">8</span> <span class="p">&lt;=</span> <span class="m">9</span>  # true
echo <span class="m">8</span> <span class="p">&lt;</span> <span class="m">9</span>  # true

# Ternary operator.
echo <span class="m">9</span> <span class="p">&gt;</span> <span class="m">8</span> ? true : false  # true

# Falsy <span class="p">(</span><span class="s2">&quot;null coalescing operator&quot;</span><span class="p">)</span>.
echo <span class="m">9</span> <span class="p">&gt;</span> <span class="m">8</span> ?? <span class="m">1</span> <span class="p">+</span> <span class="m">1</span>  # true
echo <span class="m">8</span> <span class="p">&gt;</span> <span class="m">9</span> ?? <span class="m">1</span> <span class="p">+</span> <span class="m">1</span>  # <span class="m">2</span>

# Bitwise operators <span class="p">(&gt;&gt;</span> and <span class="p">&lt;&lt;)</span>.
echo <span class="m">1</span> <span class="p">&lt;&lt;</span> <span class="m">2</span>  # <span class="m">4</span>
echo <span class="m">9</span> <span class="p">&gt;&gt;</span> <span class="m">1</span>  # <span class="m">5</span>

# String concatenation.
echo <span class="s2">&quot;Hello&quot;</span> .. <span class="s2">&quot; &quot;</span> .. <span class="s1">&#39;world&#39;</span>  # Hello world
# String indexing <span class="k">is</span> at the character level <span class="p">(</span>not byte level like vimscript<span class="p">)</span>
echo <span class="s1">&#39;fenêtre&#39;</span>[<span class="m">-4</span> : <span class="m">-1</span>]  # être
# There are dozens of builtin string functions.  Examples.
echo reverse<span class="p">(</span><span class="s2">&quot;moor&quot;</span><span class="p">)</span>  # room
echo toupper<span class="p">(</span><span class="s2">&quot;summer&quot;</span><span class="p">)</span>  # SUMMER
echo str2list<span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>  # [<span class="m">121</span><span class="p">,</span> <span class="m">101</span><span class="p">,</span> <span class="m">115</span>]
echo strcharlen<span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">)</span>  # <span class="m">6</span>

# Type casting may be used <span class="k">to</span> give an error <span class="k">for</span> <span class="k">a</span> type mismatch.
# <span class="p">(</span>This example could use `<span class="k">try</span>`<span class="p">,</span> but that&#39;s covered <span class="k">later</span>.<span class="p">)</span>
echo <span class="p">&lt;</span><span class="k">number</span><span class="p">&gt;</span><span class="m">3</span>  # <span class="m">3</span>
# echo <span class="p">&lt;</span><span class="k">number</span><span class="p">&gt;</span><span class="s1">&#39;3&#39;</span>  # This errors<span class="p">,</span> but could be caught with <span class="k">try</span>/<span class="k">catch</span>

# Not<span class="p">-</span><span class="k">a</span><span class="p">-</span>real<span class="p">-</span><span class="k">number</span> values may be tested with isinf<span class="p">()</span> and isnan<span class="p">()</span> builtin
# functions.  These examples also illustrate method chaining.
echo <span class="m">1</span>.<span class="m">0</span> / <span class="m">0</span>.<span class="m">0</span> <span class="p">-&gt;</span>isinf<span class="p">()</span>  # <span class="nb">inf</span>
echo <span class="m">-1</span>.<span class="m">0</span> / <span class="m">0</span>.<span class="m">0</span> <span class="p">-&gt;</span>isinf<span class="p">()</span>  # <span class="p">-</span><span class="nb">inf</span>
echo <span class="m">0</span>.<span class="m">0</span> / <span class="m">0</span>.<span class="m">0</span> <span class="p">-&gt;</span>isnan<span class="p">()</span>  # nan

# The maximum <span class="k">number</span> <span class="k">is</span> either <span class="k">a</span> <span class="m">32</span> or <span class="m">64</span> bit signed <span class="k">number</span><span class="p">,</span> which may
# be checked using:
echo <span class="k">v</span>:numbersize  # echos either <span class="m">32</span> or <span class="m">64</span>
# The implication <span class="k">is</span> that any arithmatic where the <span class="k">number</span> exceeds the
# permitted value<span class="p">,</span> <span class="k">for</span> <span class="m">64</span><span class="p">-</span>bit <span class="m">9</span><span class="p">,</span><span class="m">223</span><span class="p">,</span><span class="m">372</span><span class="p">,</span><span class="m">036</span><span class="p">,</span><span class="m">854</span><span class="p">,</span><span class="m">775</span><span class="p">,</span><span class="m">807</span><span class="p">,</span> will fail:
echo <span class="m">9223372036854775807</span> <span class="p">+</span> <span class="m">1</span>  # <span class="m">-9223372036854775808</span>

# Numbers may be expressed <span class="k">as</span> decimal<span class="p">,</span> hexadecimal <span class="p">(</span>prefixed with <span class="m">0</span>x<span class="p">),</span>
# octal <span class="p">(</span><span class="m">0</span>o or <span class="m">0</span>O<span class="p">),</span> or <span class="nb">binary</span> <span class="p">(</span><span class="m">0</span>b<span class="p">)</span>.  These are <span class="k">all</span> decimal <span class="m">15</span>:
echo <span class="m">15</span> <span class="p">+</span> <span class="m">0</span>b<span class="m">1111</span> <span class="p">+</span> <span class="m">0</span>xF <span class="p">+</span> <span class="m">0</span>o<span class="m">17</span>  # <span class="m">60</span>

# Pattern matching <span class="k">on</span> strings.
echo <span class="s1">&#39;foobar&#39;</span> <span class="p">=~</span> <span class="s1">&#39;foo&#39;</span>  # true <span class="p">(</span>matches pattern<span class="p">)</span>
echo <span class="s1">&#39;foobar&#39;</span> <span class="p">!~</span> <span class="s1">&#39;baz&#39;</span>  # true <span class="p">(</span>does not <span class="k">match</span> pattern<span class="p">)</span>

# Vim uses distinct regular expressions.  The basics are the same <span class="k">as</span> many
# other languages.  The basics:
# `.` any character<span class="p">,</span> `*` zero<span class="p">+</span> times<span class="p">,</span> `\<span class="p">+</span>` one<span class="p">+</span> times
# `\<span class="k">c</span>` case<span class="p">-</span>insensitive<span class="p">,</span> `\C` case<span class="p">-</span>sensitive
# `\<span class="k">d</span>` digit<span class="p">,</span> `\<span class="k">w</span>` word char<span class="p">,</span> `\s` whitespace<span class="p">,</span> `^` <span class="k">start</span><span class="p">,</span> `$` <span class="k">end</span><span class="p">,</span> `\<span class="p">|</span>` OR
# Character classes may also be used.  Examples.
# [:blank:] <span class="k">is</span> the same <span class="k">as</span> \s<span class="p">,</span> [:digit:] <span class="k">is</span> the same <span class="k">as</span> \<span class="k">d</span>
# Some things like the <span class="s2">&quot;very nomagic&quot;</span> and <span class="s2">&quot;very magic&quot;</span> are unique.
# `\<span class="k">v</span>` very <span class="nb">magic</span><span class="p">,</span> most chars are special<span class="p">,</span> closer <span class="k">to</span> extended regexes
# `\V`: very <span class="nb">nomagic</span><span class="p">,</span> <span class="k">all</span> but \ are literal
echo <span class="s1">&#39;Foobar&#39;</span> <span class="p">=~</span> <span class="s1">&#39;\c^foo&#39;</span>  # true
echo <span class="s2">&quot;The year is 2025&quot;</span> <span class="p">=~</span> <span class="s1">&#39;[[:digit:]]\+$&#39;</span>  # true
echo <span class="s1">&#39;abc123&#39;</span> <span class="p">=~</span> <span class="s1">&#39;\v\d+&#39;</span>  # true
echo <span class="s1">&#39;a|b&#39;</span> <span class="p">=~</span> <span class="s1">&#39;\Va|b&#39;</span>  # true

# `\zs`: Sets the <span class="k">start</span> of the <span class="k">match</span>.
# `\ze`: Sets the <span class="k">end</span> of the <span class="k">match</span>.
# Match <span class="k">only</span> the domain from an email:
var email <span class="p">=</span> <span class="s1">&#39;user@example.com&#39;</span>
echo matchstr<span class="p">(</span>email<span class="p">,</span> <span class="s1">&#39;@\zs[^ ]\+\ze&#39;</span><span class="p">)</span>  # Output: <span class="s1">&#39;example.com&#39;</span>


####################################################
## <span class="m">2</span>. Variables
####################################################

# `var` <span class="k">is</span> used <span class="k">to</span> declare <span class="k">a</span> variable<span class="p">,</span> which may have <span class="k">a</span> type
var name: string <span class="p">=</span> <span class="s1">&#39;Vim&#39;</span>  # type declared
var count <span class="p">=</span> <span class="m">10</span>  # type inferred <span class="p">(</span><span class="k">number</span><span class="p">)</span>
# When the type <span class="k">is</span> declared <span class="k">as</span> <span class="k">a</span> <span class="nb">list</span> or <span class="nb">dict</span><span class="p">,</span> its type<span class="p">(</span>s<span class="p">)</span> must be also<span class="p">,</span> but
# may be <span class="s2">&quot;&lt;any&gt;&quot;</span>.
var Alist: <span class="nb">list</span><span class="p">&lt;</span><span class="nb">list</span><span class="p">&lt;</span><span class="k">number</span><span class="p">&gt;&gt;</span> <span class="p">=</span> [[<span class="m">1</span><span class="p">,</span> <span class="m">2</span>]<span class="p">,</span> [<span class="m">3</span><span class="p">,</span> <span class="m">4</span>]]
var Adict: <span class="nb">dict</span><span class="p">&lt;</span>any<span class="p">&gt;</span> <span class="p">=</span> {<span class="k">a</span>: <span class="m">1</span><span class="p">,</span> <span class="k">b</span>: <span class="s1">&#39;two&#39;</span>}

# Constants
# `const` may be used <span class="k">to</span> <span class="k">make</span> both the variable and values constant.
const PI: <span class="nb">dict</span><span class="p">&lt;</span>float<span class="p">&gt;</span> <span class="p">=</span> {<span class="m">2</span>: <span class="m">3</span>.<span class="m">14</span><span class="p">,</span> <span class="m">4</span>: <span class="m">3</span>.<span class="m">1415</span>}  # Cannot add items <span class="k">to</span> this <span class="nb">dict</span>
echo PI[<span class="m">4</span>]  # <span class="m">3</span>.<span class="m">1415</span>
# `<span class="k">final</span>` may be used <span class="k">to</span> <span class="k">make</span> the variable <span class="k">a</span> constant and the values mutable.
<span class="k">final</span> <span class="nb">pi</span>: <span class="nb">dict</span><span class="p">&lt;</span>float<span class="p">&gt;</span> <span class="p">=</span> {<span class="m">2</span>: <span class="m">3</span>.<span class="m">14</span><span class="p">,</span> <span class="m">4</span>: <span class="m">3</span>.<span class="m">1415</span>}
# Adding <span class="k">a</span> <span class="nb">key</span><span class="p">-</span>value pair <span class="k">to</span> <span class="nb">pi</span>.
<span class="nb">pi</span>[<span class="m">3</span>] <span class="p">=</span> <span class="m">3</span>.<span class="m">142</span>
echo <span class="nb">pi</span>  # {<span class="m">2</span>: <span class="m">3</span>.<span class="m">14</span><span class="p">,</span> <span class="m">3</span>: <span class="m">3</span>.<span class="m">142</span><span class="p">,</span> <span class="m">4</span>: <span class="m">3</span>.<span class="m">1415</span>}
# Dictionary <span class="nb">key</span><span class="p">-</span>value pairs may also be accessed using <span class="nb">dict</span>.<span class="nb">key</span>
echo <span class="nb">pi</span>.<span class="m">4</span>  # <span class="m">3</span>.<span class="m">1415</span>

# There are many builtin functions <span class="k">for</span> variable manipulation.  Some have been
# illustrated<span class="p">,</span> <span class="k">above</span>.  A <span class="nb">selection</span> of some <span class="nb">more</span> related <span class="k">to</span> lists.
var MyList: <span class="nb">list</span><span class="p">&lt;</span><span class="k">number</span><span class="p">&gt;</span> <span class="p">=</span> [<span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span>]
echo MyList[<span class="m">0</span>]  # <span class="m">0</span>
MyList<span class="p">-&gt;</span>add<span class="p">(</span><span class="m">4</span><span class="p">)</span>
MyList<span class="p">-&gt;</span>remove<span class="p">(</span><span class="m">0</span><span class="p">)</span>
echo <span class="k">join</span><span class="p">(</span>MyList<span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">)</span>  # <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span>
# String interpolation with $.
echo $<span class="s2">&quot;The first and last items in MyList are {MyList[0]} and {MyList[-1]}&quot;</span>

# Variables exist within scopes.  When unprefixed<span class="p">,</span> <span class="k">as</span> the examples are<span class="p">,</span> <span class="k">above</span><span class="p">,</span>
# the scope <span class="k">is</span> <span class="k">script</span><span class="p">-</span>local <span class="p">(</span>which differs from vimscript<span class="p">,</span> which uses `s:`<span class="p">)</span>.
# Other scopes are global <span class="p">(</span>prefixed with `<span class="k">g</span>:`<span class="p">),</span> <span class="nb">window</span><span class="p">-</span>local <span class="p">(</span>`<span class="k">w</span>:`<span class="p">),</span>
# buffer<span class="p">-</span>local <span class="p">(</span>`<span class="k">b</span>:`<span class="p">),</span> and <span class="k">tab</span><span class="p">-</span>local <span class="p">(</span>`<span class="k">t</span>:`<span class="p">)</span>.
# Vim help <span class="k">on</span> scopes: https:<span class="sr">//</span>vimhelp.org/eval.txt.html#variable<span class="p">-</span>scope
# Use `<span class="k">g</span>:` <span class="k">for</span> global variables<span class="p">,</span> `<span class="k">b</span>:` <span class="k">for</span> buffer<span class="p">-</span>local<span class="p">,</span> `<span class="k">w</span>:` <span class="k">for</span> <span class="nb">window</span><span class="p">-</span>local<span class="p">,</span>
# and <span class="k">so</span> <span class="k">on</span>.  Vim also has many Vim<span class="p">-</span>defined `<span class="k">v</span>:` prefixed global variables.
<span class="k">g</span>:global_var <span class="p">=</span> <span class="s1">&#39;I am global&#39;</span>
echo <span class="k">g</span>:global_var  # I am global
echo <span class="k">v</span>:version  # <span class="m">901</span> <span class="p">(</span>or whatever version you are running; <span class="m">901</span> means <span class="m">9</span>.<span class="m">1</span><span class="p">)</span>
echo <span class="k">b</span>:current_syntax  # <span class="k">vim</span> <span class="p">(</span><span class="k">if</span> the buffer<span class="s1">&#39;s filetype is vim with &#39;</span><span class="nb">syntax</span>&#39; <span class="k">on</span><span class="p">)</span>

# Registers are <span class="k">a</span> form of variable used <span class="k">to</span> store string values of many
# <span class="k">pre</span><span class="p">-</span>defined or user<span class="p">-</span>defined items.  When used <span class="k">in</span> <span class="k">a</span> Vim9 <span class="k">script</span><span class="p">,</span> they are
# prefixed with `@`.
echo @:  # <span class="p">(</span>echos the last command entered by the user<span class="p">)</span>
echo @/  # <span class="p">(</span>echos the last search performed by the user<span class="p">)</span>
echo @<span class="m">1</span>  # <span class="p">(</span>echos the penultimate yanked or deleted text<span class="p">)</span>
echo @%  # <span class="p">(</span>echos the current <span class="k">file</span> <span class="nb">path</span><span class="p">)</span>
@z <span class="p">=</span> <span class="s1">&#39;There are 26 named registers, a to z&#39;</span>
echo @z

# Other builtin variables.
echo $MYVIMRC  # <span class="p">(</span>location of your .vimrc<span class="p">,</span> or _vimrc using Windows<span class="p">,</span> <span class="k">file</span><span class="p">)</span>
echo $VIMRUNTIME  # <span class="p">(</span>the Vim <span class="nb">directory</span> of the current Vim executable<span class="p">)</span>
echo $PATH  # <span class="p">(</span>references the environment variable<span class="p">,</span> PATH<span class="p">)</span>

# Vim has many settings<span class="p">,</span> which are also variables.  They may be local or
# global scoped.
echo &amp;<span class="nb">textwidth</span> # <span class="p">(</span>echos the buffer<span class="p">-</span>local value of the <span class="nb">textwidth</span> <span class="k">option</span><span class="p">)</span>
echo &amp;<span class="nb">wildmenu</span> # <span class="p">(</span>echos the boolean value of command<span class="p">-</span>line wildcard expansion<span class="p">)</span>


####################################################
## <span class="m">3</span>. Control Flow
####################################################

# If / Else
<span class="k">if</span> count <span class="p">&gt;</span> <span class="m">5</span>
  echo <span class="s1">&#39;big&#39;</span>
<span class="k">elseif</span> count <span class="p">==</span> <span class="m">5</span>
  echo <span class="s1">&#39;medium&#39;</span>
<span class="k">else</span>
  echo <span class="s1">&#39;small&#39;</span>
<span class="k">endif</span>

# For loop
<span class="k">for</span> <span class="k">j</span> <span class="k">in</span> range<span class="p">(</span><span class="m">3</span><span class="p">)</span>
  echo <span class="k">j</span>
<span class="k">endfor</span>

# While loop
var <span class="k">k</span> <span class="p">=</span> <span class="m">0</span>
<span class="k">while</span> <span class="k">k</span> <span class="p">&lt;</span> <span class="m">3</span>
  echo <span class="k">k</span>
  <span class="k">k</span> <span class="p">+=</span> <span class="m">1</span>
<span class="k">endwhile</span>

# Loop control
<span class="k">for</span> <span class="k">x</span> <span class="k">in</span> [<span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span>]
  <span class="k">if</span> <span class="k">x</span> <span class="p">==</span> <span class="m">2</span>
    continue
  <span class="k">endif</span>
  <span class="k">if</span> <span class="k">x</span> <span class="p">==</span> <span class="m">3</span>
    <span class="k">break</span>
  <span class="k">endif</span>
  echo <span class="k">x</span>
<span class="k">endfor</span>

# Exceptions
<span class="k">try</span>
  DoesNotExist<span class="p">()</span>  # This fails
<span class="k">catch</span>
  echo <span class="s1">&#39;Function DoesNotExist() does not exist!&#39;</span>
<span class="k">endtry</span>

<span class="k">try</span>
  var <span class="nb">lines</span> <span class="p">=</span> readfile<span class="p">(</span><span class="s1">&#39;nofile.txt&#39;</span><span class="p">)</span>
<span class="k">catch</span> <span class="sr">/E484:/</span>
  echo <span class="s1">&#39;File not found&#39;</span>
<span class="k">finally</span>
  echo <span class="s1">&#39;Done&#39;</span>
<span class="k">endtry</span>

<span class="k">try</span>
  <span class="k">if</span> <span class="p">!</span>filereadable<span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">)</span>
    <span class="k">throw</span> <span class="s1">&#39;MyError&#39;</span>
  <span class="k">else</span>
    # Read
    var <span class="nb">lines</span> <span class="p">=</span> readfile<span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">)</span>
    # Append
    writefile<span class="p">(</span>[<span class="s1">&#39;line3&#39;</span>]<span class="p">,</span> <span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    echo <span class="nb">lines</span>
  <span class="k">endif</span>
<span class="k">catch</span> <span class="sr">/MyError/</span>
  echo <span class="s1">&#39;File not found&#39;</span>
<span class="k">endtry</span>


####################################################
## <span class="m">4</span>. Functions and Lambdas
####################################################

# Basic <span class="k">function</span>
<span class="nb">def</span> Add<span class="p">(</span><span class="k">x</span>: <span class="k">number</span><span class="p">,</span> <span class="k">y</span>: <span class="k">number</span><span class="p">)</span>: <span class="k">number</span>
  <span class="k">return</span> <span class="k">x</span> <span class="p">+</span> <span class="k">y</span>
enddef

echo Add<span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>

# Default arguments
<span class="nb">def</span> Power<span class="p">(</span>base: <span class="k">number</span><span class="p">,</span> exp: <span class="k">number</span> <span class="p">=</span> <span class="m">2</span><span class="p">)</span>: <span class="k">number</span>
  <span class="k">return</span> float2nr<span class="p">(</span>pow<span class="p">(</span>base<span class="p">,</span> exp<span class="p">))</span>
enddef

# Variable arguments
<span class="nb">def</span> Sum<span class="p">(</span>...args: <span class="nb">list</span><span class="p">&lt;</span><span class="k">number</span><span class="p">&gt;)</span>: <span class="k">number</span>
  <span class="k">return</span> reduce<span class="p">(</span>args<span class="p">,</span> <span class="p">(</span><span class="k">x</span><span class="p">,</span> <span class="k">y</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">x</span> <span class="p">+</span> <span class="k">y</span><span class="p">)</span>
enddef

# Define <span class="k">a</span> <span class="k">function</span> that returns <span class="k">a</span> closure capturing <span class="k">a</span> local variable
<span class="nb">def</span> MakeAdder<span class="p">(</span><span class="k">x</span>: <span class="k">number</span><span class="p">)</span>: func
  # Return <span class="k">a</span> reference <span class="k">to</span> the inner <span class="k">function</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">y</span>: <span class="k">number</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">x</span> <span class="p">+</span> <span class="k">y</span>
enddef

# Create <span class="k">a</span> closure that adds <span class="m">5</span>
var Add5 <span class="p">=</span> MakeAdder<span class="p">(</span><span class="m">5</span><span class="p">)</span>

# Call the closure with <span class="m">3</span>; result <span class="k">is</span> <span class="m">8</span>
echo Add5<span class="p">(</span><span class="m">3</span><span class="p">)</span>

# Lambdas <span class="k">in</span> Vim9Script use `<span class="p">(</span>args<span class="p">)</span> <span class="p">=&gt;</span> expr` <span class="nb">syntax</span>:
var Divide <span class="p">=</span> <span class="p">(</span>val: <span class="k">number</span><span class="p">,</span> by: <span class="k">number</span><span class="p">)</span>: <span class="k">number</span> <span class="p">=&gt;</span> val / by
echo Divide<span class="p">(</span><span class="m">420</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>  # <span class="m">42</span>

# Sample <span class="nb">list</span>
var nums <span class="p">=</span> [<span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span>]

# map<span class="p">()</span>: Square each <span class="k">number</span>
var squares <span class="p">=</span> map<span class="p">(</span>copy<span class="p">(</span>nums<span class="p">),</span> <span class="p">(</span><span class="k">i</span><span class="p">,</span> <span class="k">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">v</span> * <span class="k">v</span><span class="p">)</span>
echo squares  # [<span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">16</span><span class="p">,</span> <span class="m">25</span><span class="p">,</span> <span class="m">36</span>]

# filter<span class="p">()</span>: Keep even numbers
var evens <span class="p">=</span> filter<span class="p">(</span>copy<span class="p">(</span>nums<span class="p">),</span> <span class="p">(</span><span class="k">i</span><span class="p">,</span> <span class="k">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">v</span> % <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
echo evens  # [<span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span>]

# reduce<span class="p">()</span>: Sum <span class="k">all</span> numbers
var sum <span class="p">=</span> reduce<span class="p">(</span>copy<span class="p">(</span>nums<span class="p">),</span> <span class="p">(</span>acc<span class="p">,</span> <span class="k">v</span><span class="p">)</span> <span class="p">=&gt;</span> acc <span class="p">+</span> <span class="k">v</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span>
echo sum  # <span class="m">21</span>

# <span class="k">sort</span><span class="p">()</span>: Sort descending using lambda
# Use `copy<span class="p">()</span>` <span class="k">to</span> avoid mutating the original <span class="nb">list</span>.
var sorted <span class="p">=</span> <span class="k">sort</span><span class="p">(</span>copy<span class="p">(</span>nums<span class="p">),</span> <span class="p">(</span><span class="k">a</span><span class="p">,</span> <span class="k">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">b</span> <span class="p">-</span> <span class="k">a</span><span class="p">)</span>
echo sorted  # [<span class="m">6</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span>]

####################################################
## <span class="m">5</span>. Classes and enums
####################################################

# Class
class Point
  var <span class="k">x</span>: <span class="k">number</span>
  var <span class="k">y</span>: <span class="k">number</span>

  <span class="nb">def</span> <span class="k">new</span><span class="p">(</span><span class="k">x</span>: <span class="k">number</span><span class="p">,</span> <span class="k">y</span>: <span class="k">number</span><span class="p">)</span>
    this.<span class="k">x</span> <span class="p">=</span> <span class="k">x</span>
    this.<span class="k">y</span> <span class="p">=</span> <span class="k">y</span>
  enddef

  <span class="nb">def</span> Move<span class="p">(</span>dx: <span class="k">number</span><span class="p">,</span> <span class="nb">dy</span>: <span class="k">number</span><span class="p">)</span>
    this.<span class="k">x</span> <span class="p">+=</span> dx
    this.<span class="k">y</span> <span class="p">+=</span> <span class="nb">dy</span>
  enddef

  <span class="nb">def</span> ToString<span class="p">()</span>: string
    <span class="k">return</span> $<span class="s2">&quot;({this.x}, {this.y})&quot;</span>
  enddef
endclass

var <span class="k">p</span> <span class="p">=</span> Point.<span class="k">new</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<span class="k">p</span>.Move<span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
echo <span class="k">p</span>.ToString<span class="p">()</span>  # <span class="p">=&gt;</span> <span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span>

# Enum
enum Quad
  Square<span class="p">(</span><span class="s1">&#39;four&#39;</span><span class="p">,</span> true<span class="p">),</span>
  Rectangle<span class="p">(</span><span class="s1">&#39;opposite&#39;</span><span class="p">,</span> true<span class="p">),</span>
  Rhombus<span class="p">(</span><span class="s1">&#39;opposite&#39;</span><span class="p">,</span> false<span class="p">)</span>
  var es: string
  var ra: bool
  <span class="nb">def</span> QuadProps<span class="p">()</span>: <span class="nb">list</span><span class="p">&lt;</span>any<span class="p">&gt;</span>
    <span class="k">return</span> [this.es<span class="p">,</span> this.ra]
  enddef
endenum
var <span class="k">q</span>: Quad <span class="p">=</span> Quad.Square
# result using string interpolation and showing multiple <span class="nb">lines</span> without `\`<span class="p">,</span>
# which <span class="k">is</span> required <span class="k">in</span> vimscript but not <span class="k">in</span> Vim9 <span class="k">script</span>.
var result <span class="p">=</span> $<span class="s2">&quot;A {tolower(q.name)} has {q.QuadProps()[0]} sides of equal &quot;</span> ..
<span class="c">  &quot;length and &quot; ..</span>
  <span class="p">(</span><span class="k">q</span>.QuadProps<span class="p">()</span>[<span class="m">1</span>] ? <span class="s1">&#39;has only right angles&#39;</span> : <span class="s1">&#39;has no right angle&#39;</span><span class="p">)</span>
echo result


####################################################
## <span class="m">6</span>. Modules and Imports
####################################################

# Sourcing another <span class="k">script</span> <span class="k">file</span>.
# In this case<span class="p">,</span> sourcing the optional matchit plugin<span class="p">,</span> distributed with Vim.
source $VIMRUNTIME<span class="sr">/pack/</span>dist<span class="sr">/opt/</span>matchit<span class="sr">/plugin/</span>matchit.<span class="k">vim</span>
# That<span class="s1">&#39;s not an ideal way though.  It&#39;</span>s better <span class="k">to</span> use `packadd`.
packadd helptoc
# Using `runtime` <span class="k">is</span> another way <span class="p">(</span>which can be used with wildcards<span class="p">)</span>
runtime pack<span class="sr">/**/</span>**<span class="sr">/**/</span>comment.<span class="k">vim</span>

# Importing functions from other <span class="k">files</span> <span class="k">is</span> achieved with `export` <span class="k">in</span> the <span class="k">script</span>
# <span class="k">file</span> exporting the <span class="k">function</span><span class="sr">/constant/</span>variable and `import` <span class="k">in</span> the
# <span class="k">script</span> using the exported <span class="k">function</span><span class="sr">/constant/</span>variable.
# If this <span class="k">is</span> <span class="k">in</span> <span class="k">file</span><span class="p">,</span> `MyFile.<span class="k">vim</span>` <span class="k">in</span> the same <span class="nb">directory</span> <span class="k">as</span> the <span class="k">script</span> <span class="k">file</span>.
export const THEEND: string <span class="p">=</span> <span class="s1">&#39;The end.&#39;</span>
# The <span class="k">script</span> importing THEEND would <span class="nb">include</span> <span class="p">(</span><span class="k">try</span> used here <span class="k">to</span> prevent error<span class="p">)</span>
<span class="k">try</span>
  import <span class="s2">&quot;MyFile.vim&quot;</span>
<span class="k">catch</span>
  # Do something <span class="k">if</span> the import fails
<span class="k">endtry</span>
# And using the constant would be <span class="p">(</span><span class="k">try</span> again used <span class="k">to</span> prevent error<span class="p">)</span>
<span class="k">try</span>
  echo MyFile.THEEND
<span class="k">catch</span>
  echo <span class="s2">&quot;THE END&quot;</span>
<span class="k">endtry</span>

####################################################
## <span class="m">7</span>. Vim Idioms
####################################################

# Source guard <span class="p">(</span>plugin pattern<span class="p">)</span>
<span class="k">if</span> exists<span class="p">(</span><span class="s1">&#39;g:loaded_myplugin&#39;</span><span class="p">)</span> <span class="p">|</span> <span class="k">finish</span> <span class="p">|</span> <span class="k">endif</span>
# Set <span class="k">to</span> true <span class="k">to</span> avoid sourcing the following code multiple times.
# <span class="k">g</span>:loaded_myplugin <span class="p">=</span> true

# Default value
var greeting <span class="p">=</span> get<span class="p">(</span><span class="k">g</span>:<span class="p">,</span> <span class="s1">&#39;myplugin_greeting&#39;</span><span class="p">,</span> <span class="s1">&#39;Hello&#39;</span><span class="p">)</span>

# Command definition
command<span class="p">!</span> Hello echo <span class="s1">&#39;Hello Vim9&#39;</span>
# You can specify attributes like `<span class="p">-</span>nargs`<span class="p">,</span> `<span class="p">-</span>range`<span class="p">,</span> `<span class="p">-</span><span class="nb">complete</span>`;
# see https:<span class="sr">//</span>vimhelp.org/usr_40.txt.html#<span class="m">40</span>.<span class="m">2</span>
command<span class="p">!</span> <span class="p">-</span>nargs<span class="p">=</span><span class="m">1</span> <span class="p">-</span><span class="nb">complete</span><span class="p">=</span><span class="k">file</span> MyCmd edit <span class="p">&lt;</span>args<span class="p">&gt;</span>
# Toggle <span class="k">a</span> boolean setting
<span class="nb">def</span> ToggleFeature<span class="p">()</span>
  <span class="k">g</span>:myplugin_enabled <span class="p">=</span> <span class="p">!</span>get<span class="p">(</span><span class="k">g</span>:<span class="p">,</span> <span class="s1">&#39;myplugin_enabled&#39;</span><span class="p">,</span> false<span class="p">)</span>
  echo <span class="k">g</span>:myplugin_enabled ? <span class="s1">&#39;Enabled&#39;</span> : <span class="s1">&#39;Disabled&#39;</span>
enddef
command<span class="p">!</span> ToggleMyPlugin ToggleFeature<span class="p">()</span>

# Define <span class="k">a</span> <span class="k">script</span><span class="p">-</span>local <span class="k">function</span> and map it via <span class="p">&lt;</span>Plug<span class="p">&gt;</span>
<span class="nb">def</span> DoSomething<span class="p">()</span>
  echo <span class="s1">&#39;Action triggered&#39;</span>
enddef

<span class="nb">nnoremap</span> <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>MyPluginAction<span class="p">)</span> <span class="p">&lt;</span>ScriptCmd<span class="p">&gt;</span>DoSomething<span class="p">()&lt;</span>CR<span class="p">&gt;</span>
nmap <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">&lt;</span>Leader<span class="p">&gt;</span><span class="k">a</span> <span class="p">&lt;</span>Plug<span class="p">&gt;(</span>MyPluginAction<span class="p">)</span>

# Group autocommands <span class="k">to</span> manage them systematically
# <span class="k">to</span> prevent duplicate autocommands <span class="k">on</span> <span class="k">re</span><span class="p">-</span>sourcing.
augroup AutoReload
  autocmd<span class="p">!</span>
  autocmd <span class="nb">BufWritePost</span> $MYVIMRC source $MYVIMRC
  autocmd <span class="nb">BufReadPost</span> *.txt echo <span class="s1">&#39;Hello text file&#39;</span>
augroup END

# You can run normal commands from Vim9Script:
# This executes like pressing `ggddGp` <span class="k">in</span> normal <span class="k">mode</span>.
normal<span class="p">!</span> ggddGp

# `exists<span class="p">(</span>{name}<span class="p">)</span>` checks <span class="k">if</span> <span class="k">a</span> variable<span class="p">,</span> <span class="k">function</span><span class="p">,</span> or command <span class="k">is</span> defined.
echo exists<span class="p">(</span><span class="s1">&#39;:myVariable&#39;</span><span class="p">)</span> <span class="p">==</span> <span class="m">2</span>
# `has<span class="p">(</span>{feature}<span class="p">)</span>` checks <span class="k">if</span> Vim has <span class="k">a</span> specific feature <span class="p">(</span><span class="k">e</span>.<span class="k">g</span>. `has<span class="p">(</span><span class="s1">&#39;unix&#39;</span><span class="p">)</span>`<span class="p">)</span>.
echo has<span class="p">(</span><span class="s1">&#39;unix&#39;</span><span class="p">)</span>
<span class="k">if</span> has<span class="p">(</span><span class="s1">&#39;nvim&#39;</span><span class="p">)</span>
  echo <span class="s1">&#39;Running in Neovim&#39;</span>
<span class="k">endif</span>
# `expand<span class="p">(</span>{expr}<span class="p">)</span>` expands filenames<span class="p">,</span> `<span class="p">&lt;</span>cword<span class="p">&gt;</span>`<span class="p">,</span> etc.
echo expand<span class="p">(</span><span class="s1">&#39;%:p&#39;</span><span class="p">)</span>
# `printf<span class="p">(</span>{fmt}<span class="p">,</span> ...<span class="p">)</span>` formats strings.
echo printf<span class="p">(</span><span class="s1">&#39;Hello, %s!&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>
# `type<span class="p">()</span>`<span class="p">,</span> along with `<span class="k">v</span>:t_*` constants<span class="p">,</span> indicates object types.
echo type<span class="p">(</span><span class="m">123</span><span class="p">)</span> <span class="p">==</span> <span class="k">v</span>:t_number


####################################################
## <span class="m">8</span>. External Commands
####################################################

# Run <span class="k">a</span> <span class="k">shell</span> command and capture output
<span class="k">silent</span> result <span class="p">=</span> system<span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">)</span>
echo result

# Run and split into <span class="nb">lines</span>
<span class="k">silent</span> var <span class="nb">lines</span> <span class="p">=</span> systemlist<span class="p">(</span><span class="s1">&#39;ls&#39;</span><span class="p">)</span>
<span class="k">for</span> line <span class="k">in</span> <span class="nb">lines</span>
  echo line
<span class="k">endfor</span>

# output <span class="k">files</span> <span class="k">in</span> folder of current <span class="k">file</span>
# ... <span class="k">to</span> non<span class="p">-</span>interactive <span class="k">shell</span>
<span class="p">!</span><span class="k">ls</span> %:<span class="k">h</span>:S
# ... <span class="k">to</span> current buffer<span class="p">,</span> replacing its contents
<span class="p">:</span>%<span class="p">!</span><span class="k">ls</span> %:<span class="k">h</span>:S
# ... <span class="k">to</span> the same buffer<span class="p">,</span> appending at cursor position
<span class="p">:</span>.read<span class="p">!</span> <span class="k">ls</span> %:<span class="k">h</span>:S

# Using job_start<span class="p">()</span> callback
var shell_job: job
<span class="nb">def</span> GotOutput<span class="p">(</span>channel: channel<span class="p">,</span> msg: string<span class="p">)</span>
  echo msg
enddef
# Start <span class="k">a</span> <span class="k">shell</span> <span class="k">in</span> the <span class="nb">background</span>.
shell_job <span class="p">=</span> job_start<span class="p">(</span>[<span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span>]<span class="p">,</span> {
				out_cb: GotOutput<span class="p">,</span>
				err_cb: GotOutput
				}<span class="p">)</span>
# Check <span class="k">exit</span> status
echo <span class="k">v</span>:shell_error

# Create <span class="k">a</span> quickfix <span class="nb">list</span> from Git <span class="nb">diff</span>
<span class="nb">def</span> GitDiffQuickfix<span class="p">()</span>
  var diff_lines <span class="p">=</span> systemlist<span class="p">(</span><span class="s1">&#39;git diff --name-only&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="k">v</span>:shell_error <span class="p">!=</span> <span class="m">0</span>
    echo <span class="s1">&#39;Git not available or not a repo&#39;</span>
    <span class="k">return</span>
  <span class="k">endif</span>

  var qf_list <span class="p">=</span> []
  <span class="k">for</span> <span class="k">file</span> <span class="k">in</span> diff_lines
    add<span class="p">(</span>qf_list<span class="p">,</span> {<span class="s1">&#39;filename&#39;</span>: <span class="k">file</span><span class="p">,</span> <span class="s1">&#39;lnum&#39;</span>: <span class="m">1</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span>: <span class="s1">&#39;Modified file&#39;</span>}<span class="p">)</span>
  <span class="k">endfor</span>

  <span class="k">call</span> setqflist<span class="p">(</span>qf_list<span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
  <span class="k">copen</span>
enddef
command<span class="p">!</span> GitDiffQF <span class="k">call</span> GitDiffQuickfix<span class="p">()</span>

############################################################
## <span class="m">9</span>. Testing<span class="p">,</span> Debugging<span class="p">,</span> Compiling and Inspecting Bytecode
############################################################

<span class="k">v</span>:errors <span class="p">=</span> []

assert_equal<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">2</span> <span class="p">+</span> <span class="m">2</span><span class="p">)</span>
assert_false<span class="p">(</span><span class="m">2</span> <span class="p">&lt;</span> <span class="m">1</span><span class="p">)</span>
assert_notmatch<span class="p">(</span><span class="s1">&#39;\d\+&#39;</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="p">!</span>empty<span class="p">(</span><span class="k">v</span>:errors<span class="p">)</span>
  echo $<span class="s2">&quot;Test failures: {v:errors}&quot;</span>
<span class="k">endif</span>

<span class="nb">def</span> MyFunc<span class="p">()</span>
  var <span class="k">x</span> <span class="p">=</span> <span class="m">10</span>
  var <span class="k">y</span> <span class="p">=</span> <span class="k">x</span> * <span class="m">2</span>
  echo <span class="k">y</span>
enddef

# To <span class="k">debug</span> this <span class="k">function</span>:
# Add <span class="k">a</span> breakpoint at line <span class="m">3</span> of the <span class="k">function</span> <span class="p">(</span>line numbers are relative <span class="k">to</span> the <span class="k">function</span><span class="p">)</span>
# :<span class="k">breakadd</span> func MyFunc <span class="m">3</span>

# Then run the <span class="k">function</span> <span class="k">in</span> <span class="k">debug</span> <span class="k">mode</span>
# :<span class="k">debug</span> <span class="k">call</span> MyFunc<span class="p">()</span>

# While debugging<span class="p">,</span> use commands like:
# <span class="p">-</span> :step <span class="k">to</span> step into
# <span class="p">-</span> :next <span class="k">to</span> step over
# <span class="p">-</span> :<span class="k">finish</span> <span class="k">to</span> run <span class="k">to</span> <span class="k">end</span>
# <span class="p">-</span> :cont <span class="k">to</span> continue
# <span class="p">-</span> :echo <span class="k">to</span> inspect variables

## Listing Bytecode of <span class="k">a</span> Function<span class="p">,</span>
## Useful <span class="k">to</span> understand how Vim optimizes Vim9Script functions

<span class="nb">def</span> MyMultiply<span class="p">(</span><span class="k">a</span>: <span class="k">number</span><span class="p">,</span> <span class="k">b</span>: <span class="k">number</span><span class="p">)</span>: <span class="k">number</span>
  <span class="k">return</span> <span class="k">a</span> * <span class="k">b</span>
enddef

# To <span class="k">compile</span> and <span class="k">check</span> <span class="k">for</span> <span class="nb">syntax</span>/type errors:
# Use :func MyMultiply <span class="k">to</span> <span class="k">view</span> the <span class="k">function</span> definition

# To inspect the compiled bytecode:
disassemble MyMultiply

# Example output:
# <span class="p">&lt;</span>SNR<span class="p">&gt;</span><span class="m">757</span>_MyMultiply
#   <span class="k">return</span> <span class="k">a</span> * <span class="k">b</span>
#    <span class="m">0</span> LOAD <span class="k">arg</span>[<span class="m">-2</span>]
#    <span class="m">1</span> LOAD <span class="k">arg</span>[<span class="m">-1</span>]
#    <span class="m">2</span> OPNR *
#    <span class="m">3</span> RETURN
</pre></div>
<h3>Additional Resources</h3>
<ul>
<li><a href="https://vimhelp.org/vim9.txt.html">Vim9 Script Reference</a></li>
<li><a href="https://github.com/yegappan/Vim9ScriptForPythonDevelopers">Yegappan's Vim9 for Python Developers</a></li>
<li><a href="https://github.com/jessepav/lacygoill-wiki-backup/blob/master/vim/vim9.md">Lacygoill's Vim9 Notes</a></li>
</ul>

        <hr>
        <p>
          Got a suggestion? A correction, perhaps? <a href="https://github.com/adambard/learnxinyminutes-docs/issues/new">Open an Issue</a> on the GitHub Repo, or make a <a href="https://github.com/adambard/learnxinyminutes-docs/edit/master/vim9script.md">pull request</a> yourself!
        </p>
        <p class="contributed">
          Originally contributed by Alejandro Sanchez, and updated by <a href="https://github.com/adambard/learnxinyminutes-docs/blame/master/vim9script.md">1 contributor</a>.
        </p>

        <footer>
          <a style="float: left" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width: 0; width: 88px; height: 31px;" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-sa.svg" /></a>
          <p>
            &copy; 2025
            <a href="http://hiphish.github.io/">Alejandro Sanchez</a>,
            <a href="https://github.com/yegappan">Yegappan Lakshmanan</a>,
            <a href="https://github.com/lacygoill">LacyGoill</a>
          </p>
        </footer>
      </div>
    </div>
  </body>
</html>