<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WXC8R75DEN"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WXC8R75DEN');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Language" content="zh-CN">
    <title>Learn Nix in Y Minutes</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto+Slab:wght@100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/screen.css">
    <link rel="stylesheet" href="/css/light.css">
    <link rel="stylesheet" href="/css/dark.css">

    <link rel="canonical" href="https://learnxinyminutes.com/zh-cn/nix/">
    <script>
      localStorage.removeItem("lxiym_theme");
    </script>
  </head>
  <body>
    <div class="container">
      <div class="share">
        <span class="sharemsg">
          <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Flearnxinyminutes.com%2Fzh-cn%2Fnix%2F&amp;text=Y%E5%88%86%E9%92%9F%E9%80%9F%E6%88%90X%2C+%E5%85%B6%E4%B8%AD+X%3DNix">
            分享此页
          </a>
        </span>
        <span class='st_facebook_large' displayText='Facebook'></span>
        <span class='st_twitter_large' displayText='Tweet'></span>
      </div>
      <h1><a href="/">Y分钟速成X</a></h1>
      <h2>其中 X=Nix</h2>
      <p class="filelink">
        源代码下载：
        <a href="/zh-cn/files/learnnix.nix">learnnix.nix</a>
      </p>
      <div id="doc">
<p>Nix 是一个为 <a href="https://nixos.org/nix/">Nix 包管理器</a> 和 <a href="https://nixos.org/">NixOS</a> 开发的简单函数式语言。</p>
<p>你可以使用 <a href="https://nixos.org/nix/manual/#sec-nix-instantiate">nix-instantiate</a> 或 <a href="https://nixos.org/nix/manual/#ssec-relnotes-2.0"><code>nix repl</code></a> 来评估 Nix 表达式。</p>
<div class="highlight"><pre lang="nix"><span class="k">with</span> <span class="nb">builtins</span><span class="p">;</span> <span class="p">[</span>

  <span class="c1">#  注释</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># 行内注释看起来像这样。</span>

  <span class="cm">/* 多行注释</span>
<span class="cm">     看起来像这样。 */</span>


  <span class="c1">#  布尔值</span>
  <span class="c1">#=========================================</span>

  <span class="p">(</span><span class="no">true</span> <span class="o">&amp;&amp;</span> <span class="no">false</span><span class="p">)</span>               <span class="c1"># 与</span>
  <span class="c1">#=&gt; false</span>

  <span class="p">(</span><span class="no">true</span> <span class="o">||</span> <span class="no">false</span><span class="p">)</span>               <span class="c1"># 或</span>
  <span class="c1">#=&gt; true</span>

  <span class="p">(</span><span class="k">if</span> <span class="mi">3</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="k">then</span> <span class="s2">&quot;a&quot;</span> <span class="k">else</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>  <span class="c1"># 条件</span>
  <span class="c1">#=&gt; &quot;a&quot;</span>


  <span class="c1">#  整数和浮点数</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># 有两种数值类型：整数和浮点数</span>

  <span class="mi">1</span> <span class="mi">0</span> <span class="mi">42</span> <span class="p">(</span><span class="mi">-3</span><span class="p">)</span>       <span class="c1"># 一些整数</span>

  <span class="mf">123.43</span> <span class="mf">.27e13</span>     <span class="c1"># 一对浮点数</span>

  <span class="c1"># 运算将保留数值类型</span>

  <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># 加法</span>
  <span class="c1">#=&gt; 20</span>
  <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="mf">2.5</span><span class="p">)</span>
  <span class="c1">#=&gt; 1.5</span>

  <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>           <span class="c1"># 除法</span>
  <span class="c1">#=&gt; 3</span>
  <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
  <span class="c1">#=&gt; 3.5</span>


  <span class="c1">#  字符串</span>
  <span class="c1">#=========================================</span>

  <span class="s2">&quot;字符串字面量用双引号括起来。&quot;</span>

  <span class="s2">&quot;</span>
<span class="s2">    字符串字面量可以跨越</span>
<span class="s2">    多行。</span>
<span class="s2">  &quot;</span>

  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">    这被称为“缩进字符串”字面量。</span>
<span class="s s-Multiline">    它智能地去除前导空白。</span>
<span class="s s-Multiline">  &#39;&#39;</span>

  <span class="s s-Multiline">&#39;&#39;</span>
<span class="s s-Multiline">    a</span>
<span class="s s-Multiline">      b</span>
<span class="s s-Multiline">  &#39;&#39;</span>
  <span class="c1">#=&gt; &quot;a\n  b&quot;</span>

  <span class="p">(</span><span class="s2">&quot;ab&quot;</span> <span class="o">+</span> <span class="s2">&quot;cd&quot;</span><span class="p">)</span>   <span class="c1"># 字符串连接</span>
  <span class="c1">#=&gt; &quot;abcd&quot;</span>

  <span class="c1"># 反引号允许你在字符串中嵌入值。</span>
  <span class="p">(</span><span class="s2">&quot;Your home directory is </span><span class="si">${</span>getEnv <span class="s2">&quot;HOME&quot;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="c1">#=&gt; &quot;Your home directory is /home/alice&quot;</span>


  <span class="c1">#  路径</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># Nix 有一个用于路径的原始数据类型。</span>
  <span class="l">/tmp/tutorials/learn.nix</span>

  <span class="c1"># 相对路径在解析时相对于它出现的文件解析为绝对路径。</span>
  <span class="l">tutorials/learn.nix</span>
  <span class="c1">#=&gt; /the-base-path/tutorials/learn.nix</span>

  <span class="c1"># 路径必须至少包含一个斜杠，因此同一目录中的文件的相对路径需要一个 ./ 前缀，</span>
  <span class="l">./learn.nix</span>
  <span class="c1">#=&gt; /the-base-path/learn.nix</span>

  <span class="c1"># 如果你希望 / 运算符表示除法，它必须被空格包围。</span>

  <span class="mi">7</span><span class="l">/2</span>        <span class="c1"># 这是一个路径字面量</span>
  <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>    <span class="c1"># 这是整数除法</span>


  <span class="c1">#  导入</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># 一个 nix 文件包含一个没有自由变量的顶级表达式。一个导入表达式评估为它导入的文件的值。</span>
  <span class="p">(</span><span class="nb">import</span> <span class="l">/tmp/foo.nix</span><span class="p">)</span>

  <span class="c1"># 导入也可以通过字符串指定。</span>
  <span class="p">(</span><span class="nb">import</span> <span class="s2">&quot;/tmp/foo.nix&quot;</span><span class="p">)</span>

  <span class="c1"># 导入路径必须是绝对路径。路径字面量会自动解析，因此这没问题。</span>
  <span class="p">(</span><span class="nb">import</span> <span class="l">./foo.nix</span><span class="p">)</span>

  <span class="c1"># 但字符串不会这样。</span>
  <span class="p">(</span><span class="nb">import</span> <span class="s2">&quot;./foo.nix&quot;</span><span class="p">)</span>
  <span class="c1">#=&gt; 错误：字符串‘foo.nix’不代表绝对路径</span>


  <span class="c1">#  Let</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># `let` 块允许我们将值绑定到变量。</span>
  <span class="p">(</span><span class="k">let</span> <span class="ss">x</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">;</span> <span class="k">in</span>
    x <span class="o">+</span> x <span class="o">+</span> x<span class="p">)</span>
  <span class="c1">#=&gt; &quot;aaa&quot;</span>

  <span class="c1"># 绑定可以相互引用，并且它们的顺序无关紧要。</span>
  <span class="p">(</span><span class="k">let</span> <span class="ss">y</span> <span class="o">=</span> x <span class="o">+</span> <span class="s2">&quot;b&quot;</span><span class="p">;</span>
       <span class="ss">x</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">;</span> <span class="k">in</span>
    y <span class="o">+</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
  <span class="c1">#=&gt; &quot;abc&quot;</span>

  <span class="c1"># 内部绑定会覆盖外部绑定。</span>
  <span class="p">(</span><span class="k">let</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">in</span>
    <span class="k">let</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="k">in</span>
      a<span class="p">)</span>
  <span class="c1">#=&gt; 2</span>


  <span class="c1">#  函数</span>
  <span class="c1">#=========================================</span>

  <span class="p">(</span>n<span class="p">:</span> n <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>      <span class="c1"># 添加 1 的函数</span>

  <span class="p">((</span>n<span class="p">:</span> n <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 同一个函数，应用于 5</span>
  <span class="c1">#=&gt; 6</span>

  <span class="c1"># 没有命名函数的语法，但它们可以像任何其他值一样通过 `let` 块绑定。</span>
  <span class="p">(</span><span class="k">let</span> <span class="ss">succ</span> <span class="o">=</span> <span class="p">(</span>n<span class="p">:</span> n <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="k">in</span> succ <span class="mi">5</span><span class="p">)</span>
  <span class="c1">#=&gt; 6</span>

  <span class="c1"># 一个函数恰好有一个参数。</span>
  <span class="c1"># 多个参数可以通过柯里化实现。</span>
  <span class="p">((</span>x<span class="p">:</span> y<span class="p">:</span> x <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> y<span class="p">)</span> <span class="s2">&quot;a&quot;</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
  <span class="c1">#=&gt; &quot;a-b&quot;</span>

  <span class="c1"># 我们还可以有命名函数参数，</span>
  <span class="c1"># 我们将在引入集合后再讨论。</span>


  <span class="c1">#  列表</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># 列表用方括号表示。</span>

  <span class="p">(</span>length <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="s2">&quot;x&quot;</span><span class="p">])</span>
  <span class="c1">#=&gt; 4</span>

  <span class="p">([</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="o">++</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">5</span><span class="p">])</span>
  <span class="c1">#=&gt; [1 2 3 4 5]</span>

  <span class="p">(</span>concatLists <span class="p">[[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">]</span> <span class="p">[</span><span class="mi">3</span> <span class="mi">4</span><span class="p">]</span> <span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
  <span class="c1">#=&gt; [1 2 3 4 5]</span>

  <span class="p">(</span>head <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])</span>
  <span class="c1">#=&gt; 1</span>
  <span class="p">(</span>tail <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])</span>
  <span class="c1">#=&gt; [2 3]</span>

  <span class="p">(</span>elemAt <span class="p">[</span><span class="s2">&quot;a&quot;</span> <span class="s2">&quot;b&quot;</span> <span class="s2">&quot;c&quot;</span> <span class="s2">&quot;d&quot;</span><span class="p">]</span> <span class="mi">2</span><span class="p">)</span>
  <span class="c1">#=&gt; &quot;c&quot;</span>

  <span class="p">(</span>elem <span class="mi">2</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])</span>
  <span class="c1">#=&gt; true</span>
  <span class="p">(</span>elem <span class="mi">5</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">])</span>
  <span class="c1">#=&gt; false</span>

  <span class="p">(</span>filter <span class="p">(</span>n<span class="p">:</span> n <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">])</span>
  <span class="c1">#=&gt; [ 1 2 ]</span>


  <span class="c1">#  集合</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># “集合”是一个无序的字符串键映射。</span>
  <span class="p">{</span> <span class="ss">foo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span><span class="p">];</span> <span class="ss">bar</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1"># . 运算符从集合中提取一个值。</span>
  <span class="p">{</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span><span class="o">.</span>a
  <span class="c1">#=&gt; 1</span>

  <span class="c1"># ? 运算符测试一个键是否存在于集合中。</span>
  <span class="p">({</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span> <span class="o">?</span> a<span class="p">)</span>
  <span class="c1">#=&gt; true</span>
  <span class="p">({</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span> <span class="o">?</span> c<span class="p">)</span>
  <span class="c1">#=&gt; false</span>

  <span class="c1"># // 运算符合并两个集合。</span>
  <span class="p">({</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span> <span class="o">//</span> <span class="p">{</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">})</span>
  <span class="c1">#=&gt; { a = 1; b = 2; }</span>

  <span class="c1"># 右边的值覆盖左边的值。</span>
  <span class="p">({</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span> <span class="o">//</span> <span class="p">{</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="ss">c</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="p">})</span>
  <span class="c1">#=&gt; { a = 3; b = 2; c = 4; }</span>

  <span class="c1"># rec 关键字表示一个“递归集合”，</span>
  <span class="c1"># 其中属性可以相互引用。</span>
  <span class="p">(</span><span class="k">let</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">in</span>     <span class="p">{</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> a<span class="p">;</span> <span class="p">}</span><span class="o">.</span>b<span class="p">)</span>
  <span class="c1">#=&gt; 1</span>
  <span class="p">(</span><span class="k">let</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">in</span> <span class="k">rec</span> <span class="p">{</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> a<span class="p">;</span> <span class="p">}</span><span class="o">.</span>b<span class="p">)</span>
  <span class="c1">#=&gt; 2</span>

  <span class="c1"># 嵌套集合可以分段定义。</span>
  <span class="p">{</span>
    a<span class="o">.</span><span class="ss">b</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    a<span class="o">.</span>c<span class="o">.</span><span class="ss">d</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    a<span class="o">.</span>c<span class="o">.</span><span class="ss">e</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span><span class="o">.</span>a<span class="o">.</span>c
  <span class="c1">#=&gt; { d = 2; e = 3; }</span>

  <span class="c1"># 集合是不可变的，因此你不能重新定义一个属性：</span>
  <span class="p">{</span>
    <span class="ss">a</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
    a<span class="o">.</span><span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">#=&gt; 属性 &#39;a.b&#39; 在 (string):3:5 处已在 (string):2:11 处定义</span>

  <span class="c1"># 然而，即使属性本身已被直接赋值，属性的集合成员也可以分段定义。</span>
  <span class="p">{</span>
    <span class="ss">a</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">};</span>
    a<span class="o">.</span><span class="ss">c</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">#=&gt; { a = { b = 1; c = 2; }; }</span>


  <span class="c1">#  With</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># `with` 块的主体在集合的映射绑定到变量时进行评估。</span>
  <span class="p">(</span><span class="k">with</span> <span class="p">{</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">};</span>
    a <span class="o">+</span> b<span class="p">)</span>
  <span class="c1"># =&gt; 3</span>

  <span class="c1"># 内部绑定会覆盖外部绑定。</span>
  <span class="p">(</span><span class="k">with</span> <span class="p">{</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="ss">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="p">};</span>
    <span class="p">(</span><span class="k">with</span> <span class="p">{</span> <span class="ss">a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="p">};</span>
      a <span class="o">+</span> b<span class="p">))</span>
  <span class="c1">#=&gt; 7</span>

  <span class="c1"># 本教程的第一行以 &quot;with builtins;&quot; 开始，</span>
  <span class="c1"># 因为 builtins 是一个包含所有内置函数（length、head、tail、filter 等）的集合。</span>
  <span class="c1"># 这使我们不必写 &quot;builtins.length&quot; 而只需写 &quot;length&quot;。</span>


  <span class="c1">#  集合模式</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># 当我们需要将多个值传递给函数时，集合很有用。</span>
  <span class="p">(</span>args<span class="p">:</span> args<span class="o">.</span>x <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> args<span class="o">.</span>y<span class="p">)</span> <span class="p">{</span> <span class="ss">x</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">;</span> <span class="ss">y</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">#=&gt; &quot;a-b&quot;</span>

  <span class="c1"># 这可以用集合模式更清晰地写出来。</span>
  <span class="p">({</span>x<span class="p">,</span> y<span class="p">}:</span> x <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> y<span class="p">)</span> <span class="p">{</span> <span class="ss">x</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">;</span> <span class="ss">y</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">#=&gt; &quot;a-b&quot;</span>

  <span class="c1"># 默认情况下，模式在包含额外键的集合上失败。</span>
  <span class="p">({</span>x<span class="p">,</span> y<span class="p">}:</span> x <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> y<span class="p">)</span> <span class="p">{</span> <span class="ss">x</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">;</span> <span class="ss">y</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">;</span> <span class="ss">z</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">#=&gt; error: anonymous function called with unexpected argument ‘z’</span>

  <span class="c1"># 添加 &quot;, ...&quot; 允许忽略额外的键。</span>
  <span class="p">({</span>x<span class="p">,</span> y<span class="p">,</span> <span class="o">...</span><span class="p">}:</span> x <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> y<span class="p">)</span> <span class="p">{</span> <span class="ss">x</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">;</span> <span class="ss">y</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">;</span> <span class="ss">z</span> <span class="o">=</span> <span class="s2">&quot;c&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">#=&gt; &quot;a-b&quot;</span>

  <span class="c1"># 整个集合可以使用 `@` 绑定到一个变量</span>
  <span class="p">(</span>args<span class="p">@{</span>x<span class="p">,</span> y<span class="p">}:</span> args<span class="o">.</span>x <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> args<span class="o">.</span>y<span class="p">)</span> <span class="p">{</span> <span class="ss">x</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span><span class="p">;</span> <span class="ss">y</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="c1">#=&gt; &quot;a-b&quot;</span>

  <span class="c1">#  错误</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># `throw` 导致评估中止并显示错误消息。</span>
  <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="nb">throw</span> <span class="s2">&quot;foo&quot;</span><span class="p">))</span>
  <span class="c1">#=&gt; error: foo</span>

  <span class="c1"># `tryEval` 捕获抛出的错误。</span>
  <span class="p">(</span>tryEval <span class="mi">42</span><span class="p">)</span>
  <span class="c1">#=&gt; { success = true; value = 42; }</span>
  <span class="p">(</span>tryEval <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="nb">throw</span> <span class="s2">&quot;foo&quot;</span><span class="p">)))</span>
  <span class="c1">#=&gt; { success = false; value = false; }</span>

  <span class="c1"># `abort` 类似于 throw，但它是致命的；它无法被捕获。</span>
  <span class="p">(</span>tryEval <span class="p">(</span><span class="nb">abort</span> <span class="s2">&quot;foo&quot;</span><span class="p">))</span>
  <span class="c1">#=&gt; error: evaluation aborted with the following error message: ‘foo’</span>

  <span class="c1"># `assert` 如果为真，则评估为给定值；</span>
  <span class="c1"># 否则它会抛出一个可捕获的异常。</span>
  <span class="p">(</span><span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">42</span><span class="p">)</span>
  <span class="c1">#=&gt; 42</span>
  <span class="p">(</span><span class="k">assert</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">42</span><span class="p">)</span>
  <span class="c1">#=&gt; error: assertion failed at (string):1:1</span>
  <span class="p">(</span>tryEval <span class="p">(</span><span class="k">assert</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span> <span class="mi">42</span><span class="p">))</span>
  <span class="c1">#=&gt; { success = false; value = false; }</span>


  <span class="c1">#  不纯性</span>
  <span class="c1">#=========================================</span>

  <span class="c1"># 因为构建的可重复性对 Nix 包管理器至关重要，</span>
  <span class="c1"># 函数式纯度在用于描述 Nix 包的 Nix 语言中得到了强调。</span>
  <span class="c1"># 但也有一些不纯之处。</span>

  <span class="c1"># 您可以引用环境变量。</span>
  <span class="p">(</span>getEnv <span class="s2">&quot;HOME&quot;</span><span class="p">)</span>
  <span class="c1">#=&gt; &quot;/home/alice&quot;</span>

  <span class="c1"># trace函数用于调试。它将第一个参数打印到stderr，并计算第二个参数。</span>
  <span class="p">(</span>trace <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
  <span class="c1">#=&gt; trace: 1</span>
  <span class="c1">#=&gt; 2</span>

  <span class="c1"># 您可以将文件写入Nix存储。尽管不纯，但这相当安全，因为文件名是从其内容的哈希中派生的。您可以从任何地方读取文件。在此示例中，我们将文件写入存储，然后再读出。</span>
  <span class="p">(</span><span class="k">let</span> <span class="ss">filename</span> <span class="o">=</span> toFile <span class="s2">&quot;foo.txt&quot;</span> <span class="s2">&quot;hello!&quot;</span><span class="p">;</span> <span class="k">in</span>
    <span class="p">[</span>filename <span class="p">(</span>readFile filename<span class="p">)])</span>
  <span class="c1">#=&gt; [ &quot;/nix/store/ayh05aay2anx135prqp0cy34h891247x-foo.txt&quot; &quot;hello!&quot; ]</span>

  <span class="c1"># 我们还可以将文件下载到Nix存储中。</span>
  <span class="p">(</span>fetchurl <span class="s2">&quot;https://example.com/package-1.2.3.tgz&quot;</span><span class="p">)</span>
  <span class="c1">#=&gt; &quot;/nix/store/2drvlh8r57f19s9il42zg89rdr33m2rm-package-1.2.3.tgz&quot;</span>

<span class="p">]</span>
</pre></div>
<h3>进一步阅读</h3>
<ul>
<li><a href="https://nixos.org/nix/manual/#ch-expression-language">Nix Manual - Nix表达式语言</a></li>
<li><a href="https://medium.com/@MrJamesFisher/nix-by-example-a0063a1a4c55">James Fisher - Nix 示例 - Part 1: The Nix expression language</a></li>
<li><a href="https://ops.functionalalgebra.com/nix-by-example/">Susan Potter - Nix Cookbook - Nix 示例</a></li>
<li><a href="https://zero-to-nix.com/">Zero to Nix - Nix教程</a></li>
<li><a href="https://web.archive.org/web/20210121042658/https://ebzzry.io/en/nix/#nix">Rommel Martinez - Nix 家族简介</a></li>
</ul>

        <hr>
        <p>
          有建议？或者发现什么错误？在GitHub上<a href="https://github.com/adambard/learnxinyminutes-docs/issues/new">开一个issue</a>，或者发起<a href="https://github.com/adambard/learnxinyminutes-docs/edit/master/zh-cn/nix.md">pull request</a>！
        </p>
        <p class="contributed">
          原著Chris Martin，并由<a href="https://github.com/adambard/learnxinyminutes-docs/blame/master/zh-cn/nix.md">2个好心人</a>修改。
        </p>

        <footer>
          <a style="float: left" rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width: 0; width: 88px; height: 31px;" src="https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-sa.svg" /></a>
          <p>
            &copy; 2025
            <a href="http://chris-martin.org/">Chris Martin</a>,
            <a href="https://ebzzry.io">Rommel Martinez</a>,
            <a href="https://candeira.com/">Javier Candeira</a>
          </p>
        </footer>
      </div>
    </div>
  </body>
</html>